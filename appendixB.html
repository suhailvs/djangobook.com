<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Appendix B: Database API Reference</title>
    <link rel="stylesheet" href="_static/reset-min.css" type="text/css">
    <link rel="stylesheet" href="_static/grids-min.css" type="text/css">
    <link rel="stylesheet" href="_static/djangobook.css" type="text/css">
    
  </head>
  <body>
    <div id="doc" class="yui-t7">
      <div id="hd">
        <h1><a href="index.html">The Django Book</a></h1>
        <div id="global-nav">
            <a class="about" href="frontmatter.html">About</a>
        </div>
        
<div class="nav">
    
        <a href='appendixA.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='appendixC.html'>next &raquo;</a>
    
</div>

      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            
  <div id="chapter-body"><div class="section" id="appendix-b-database-api-reference">
<h1>Appendix B: Database API Reference<a class="headerlink" href="#appendix-b-database-api-reference" title="Permalink to this headline">¶</a></h1>
<p>Django’s database API is the other half of the model API discussed in Appendix
A. Once you’ve defined a model, you’ll use this API any time you need to
access the database. You’ve seen examples of this API in use throughout the
book; this appendix explains all the various options in detail.</p>
<p>Like the model APIs discussed in Appendix A, though these APIs are considered
very stable, the Django developers consistently add new shortcuts and
conveniences. It’s a good idea to always check the latest documentation online,
available at <a class="reference external" href="http://docs.djangoproject.com/">http://docs.djangoproject.com/</a>.</p>
<p>Throughout this reference, we’ll refer to the following models, which might form
a simple blog application:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Blog</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">tagline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Author</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">EmailField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">blog</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Blog</span><span class="p">)</span>
    <span class="n">headline</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">body_text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">()</span>
    <span class="n">pub_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">()</span>
    <span class="n">authors</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ManyToManyField</span><span class="p">(</span><span class="n">Author</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">headline</span>
</pre></div>
</div>
<div class="section" id="creating-objects">
<h2>Creating Objects<a class="headerlink" href="#creating-objects" title="Permalink to this headline">¶</a></h2>
<p>To create an object, instantiate it using keyword arguments to the model class, and
then call <code class="docutils literal"><span class="pre">save()</span></code> to save it to the database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Blog</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Beatles Blog&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;All the latest Beatles news.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>This performs an <code class="docutils literal"><span class="pre">INSERT</span></code> SQL statement behind the scenes. Django doesn’t hit
the database until you explicitly call <code class="docutils literal"><span class="pre">save()</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">save()</span></code> method has no return value.</p>
<p>To create an object and save it all in one step, see the <code class="docutils literal"><span class="pre">create</span></code> manager
method.</p>
<div class="section" id="what-happens-when-you-save">
<h3>What Happens When You Save?<a class="headerlink" href="#what-happens-when-you-save" title="Permalink to this headline">¶</a></h3>
<p>When you save an object, Django performs the following steps:</p>
<ol class="arabic">
<li><p class="first"><strong>Emit a pre_save signal.</strong> This provides a notification that
an object is about to be saved. You can register a listener that
will be invoked whenever this signal is emitted. Check the online
documentation for more on signals.</p>
</li>
<li><p class="first"><strong>Preprocess the data.</strong> Each field on the object is asked to
perform any automated data modification that the field may need
to perform.</p>
<p>Most fields do <em>no</em> preprocessing – the field data is kept as is.
Preprocessing is only used on fields that have special behavior,
like file fields.</p>
</li>
<li><p class="first"><strong>Prepare the data for the database.</strong> Each field is asked to provide
its current value in a data type that can be written to the database.</p>
<p>Most fields require no data preparation. Simple data types, such as
integers and strings, are “ready to write” as a Python object. However,
more complex data types often require some modification. For example,
<code class="docutils literal"><span class="pre">DateFields</span></code> use a Python <code class="docutils literal"><span class="pre">datetime</span></code> object to store data.
Databases don’t store <code class="docutils literal"><span class="pre">datetime</span></code> objects, so the field value
must be converted into an ISO-compliant date string for insertion
into the database.</p>
</li>
<li><p class="first"><strong>Insert the data into the database.</strong> The preprocessed, prepared
data is then composed into an SQL statement for insertion into the
database.</p>
</li>
<li><p class="first"><strong>Emit a post_save signal.</strong> As with the <code class="docutils literal"><span class="pre">pre_save</span></code> signal, this
is used to provide notification that an object has been successfully
saved.</p>
</li>
</ol>
</div>
<div class="section" id="autoincrementing-primary-keys">
<h3>Autoincrementing Primary Keys<a class="headerlink" href="#autoincrementing-primary-keys" title="Permalink to this headline">¶</a></h3>
<p>For convenience, each model is given an autoincrementing primary key field
named <code class="docutils literal"><span class="pre">id</span></code> unless you explicitly specify <code class="docutils literal"><span class="pre">primary_key=True</span></code> on a field (see
the section titled “AutoField” in Appendix A).</p>
<p>If your model has an <code class="docutils literal"><span class="pre">AutoField</span></code>, that autoincremented value will be
calculated and saved as an attribute on your object the first time you call
<code class="docutils literal"><span class="pre">save()</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cheddar Talk&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Thoughts on cheese.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns None, because b doesn&#39;t have an ID yet.</span>
<span class="go">None</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns the ID of your new object.</span>
<span class="go">14</span>
</pre></div>
</div>
<p>There’s no way to tell what the value of an ID will be before you call
<code class="docutils literal"><span class="pre">save()</span></code>, because that value is calculated by your database, not by Django.</p>
<p>If a model has an <code class="docutils literal"><span class="pre">AutoField</span></code> but you want to define a new object’s ID
explicitly when saving, just define it explicitly before saving, rather than
relying on the autoassignment of the ID:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cheddar Talk&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Thoughts on cheese.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>
<span class="go">3</span>
</pre></div>
</div>
<p>If you assign auto-primary-key values manually, make sure not to use an
already existing primary key value! If you create a new object with an explicit
primary key value that already exists in the database, Django will assume you’re
changing the existing record rather than creating a new one.</p>
<p>Given the preceding <code class="docutils literal"><span class="pre">'Cheddar</span> <span class="pre">Talk'</span></code> blog example, this example would override the
previous record in the database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b4</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Not Cheddar&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Anything but cheese.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b4</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># Overrides the previous blog with ID=3!</span>
</pre></div>
</div>
<p>Explicitly specifying auto-primary-key values is mostly useful for bulk-saving
objects, when you’re confident you won’t have primary key collision.</p>
</div>
</div>
<div class="section" id="saving-changes-to-objects">
<h2>Saving Changes to Objects<a class="headerlink" href="#saving-changes-to-objects" title="Permalink to this headline">¶</a></h2>
<p>To save changes to an object that’s already in the database, use <code class="docutils literal"><span class="pre">save()</span></code>.</p>
<p>Given a <code class="docutils literal"><span class="pre">Blog</span></code> instance <code class="docutils literal"><span class="pre">b5</span></code> that has already been saved to the database,
this example changes its name and updates its record in the database:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b5</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;New name&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b5</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>This performs an <code class="docutils literal"><span class="pre">UPDATE</span></code> SQL statement behind the scenes. Again, Django
doesn’t hit the database until you explicitly call <code class="docutils literal"><span class="pre">save()</span></code>.</p>
<div class="admonition-how-django-knows-when-to-update-and-when-to-insert admonition">
<p class="first admonition-title">How Django Knows When to <code class="docutils literal"><span class="pre">UPDATE</span></code> and When to <code class="docutils literal"><span class="pre">INSERT</span></code></p>
<p>You may have noticed that Django database objects use the same <code class="docutils literal"><span class="pre">save()</span></code> method
for creating and changing objects. Django abstracts the need to use
<code class="docutils literal"><span class="pre">INSERT</span></code> or <code class="docutils literal"><span class="pre">UPDATE</span></code> SQL statements. Specifically, when you call
<code class="docutils literal"><span class="pre">save()</span></code>, Django follows this algorithm:</p>
<ul class="simple">
<li>If the object’s primary key attribute is set to a value that evaluates
to <code class="docutils literal"><span class="pre">True</span></code> (i.e., a value other than <code class="docutils literal"><span class="pre">None</span></code> or the empty string),
Django executes a <code class="docutils literal"><span class="pre">SELECT</span></code> query to determine whether a record with
the given primary key already exists.</li>
<li>If the record with the given primary key does already exist, Django
executes an <code class="docutils literal"><span class="pre">UPDATE</span></code> query.</li>
<li>If the object’s primary key attribute is <em>not</em> set, or if it’s set but
a record doesn’t exist, Django executes an <code class="docutils literal"><span class="pre">INSERT</span></code>.</li>
</ul>
<p class="last">Because of this, you should be careful not to specify a primary key value
explicitly when saving new objects if you cannot guarantee the primary key
value is unused.</p>
</div>
<p>Updating <code class="docutils literal"><span class="pre">ForeignKey</span></code> fields works exactly the same way; simply assign an
object of the right type to the field in question:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">joe</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Joe&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">entry</span><span class="o">.</span><span class="n">author</span> <span class="o">=</span> <span class="n">joe</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">entry</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Django will complain if you try to assign an object of the wrong type.</p>
</div>
<div class="section" id="retrieving-objects">
<h2>Retrieving Objects<a class="headerlink" href="#retrieving-objects" title="Permalink to this headline">¶</a></h2>
<p>Throughout the book you’ve seen objects retrieved using code like the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">blogs</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">author__name__contains</span><span class="o">=</span><span class="s2">&quot;Joe&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>There are quite a few “moving parts” behind the scenes here: when you
retrieve objects from the database, you’re actually constructing a <code class="docutils literal"><span class="pre">QuerySet</span></code>
using the model’s <code class="docutils literal"><span class="pre">Manager</span></code>. This <code class="docutils literal"><span class="pre">QuerySet</span></code> knows how to execute SQL and
return the requested objects.</p>
<p>Appendix A looked at both of these objects from a model-definition point of
view; now we’ll look at how they operate.</p>
<p>A <code class="docutils literal"><span class="pre">QuerySet</span></code> represents a collection of objects from your database. It can
have zero, one, or many <em>filters</em> – criteria that narrow down the collection
based on given parameters. In SQL terms, a <code class="docutils literal"><span class="pre">QuerySet</span></code> equates to a <code class="docutils literal"><span class="pre">SELECT</span></code>
statement, and a filter is a <code class="docutils literal"><span class="pre">WHERE</span></code>.</p>
<p>You get a <code class="docutils literal"><span class="pre">QuerySet</span></code> by using your model’s <code class="docutils literal"><span class="pre">Manager</span></code>. Each model has at
least one <code class="docutils literal"><span class="pre">Manager</span></code>, and it’s called <code class="docutils literal"><span class="pre">objects</span></code> by default. Access it
directly via the model class, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span>
<span class="go">&lt;django.db.models.manager.Manager object at 0x137d00d&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Manager</span></code>s are accessible only via model classes, rather than from model
instances, to enforce a separation between “table-level” operations and
“record-level” operations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Foo&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Bar&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="o">.</span><span class="n">objects</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">AttributeError</span>: <span class="n">Manager isn&#39;t accessible via Blog instances.</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">Manager</span></code> is the main source of <code class="docutils literal"><span class="pre">QuerySet</span></code>s for a model. It acts as a
“root” <code class="docutils literal"><span class="pre">QuerySet</span></code> that describes all objects in the model’s database table.
For example, <code class="docutils literal"><span class="pre">Blog.objects</span></code> is the initial <code class="docutils literal"><span class="pre">QuerySet</span></code> that contains all
<code class="docutils literal"><span class="pre">Blog</span></code> objects in the database.</p>
</div>
<div class="section" id="caching-and-querysets">
<h2>Caching and QuerySets<a class="headerlink" href="#caching-and-querysets" title="Permalink to this headline">¶</a></h2>
<p>Each <code class="docutils literal"><span class="pre">QuerySet</span></code> contains a cache, to minimize database access. It’s important
to understand how it works, in order to write the most efficient code.</p>
<p>In a newly created <code class="docutils literal"><span class="pre">QuerySet</span></code>, the cache is empty. The first time a
<code class="docutils literal"><span class="pre">QuerySet</span></code> is evaluated – and, hence, a database query happens – Django
saves the query results in the <code class="docutils literal"><span class="pre">QuerySet</span></code>’s cache and returns the results
that have been explicitly requested (e.g., the next element, if the
<code class="docutils literal"><span class="pre">QuerySet</span></code> is being iterated over). Subsequent evaluations of the
<code class="docutils literal"><span class="pre">QuerySet</span></code> reuse the cached results.</p>
<p>Keep this caching behavior in mind, because it may bite you if you don’t use
your <code class="docutils literal"><span class="pre">QuerySet</span></code>s correctly. For example, the following will create two
<code class="docutils literal"><span class="pre">QuerySet</span></code>s, evaluate them, and throw them away:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nb">print</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">headline</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
<span class="nb">print</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">pub_date</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>
</pre></div>
</div>
<p>That means the same database query will be executed twice, effectively doubling
your database load. Also, there’s a possibility the two lists may not include
the same database records, because an <code class="docutils literal"><span class="pre">Entry</span></code> may have been added or deleted
in the split second between the two requests.</p>
<p>To avoid this problem, simply save the <code class="docutils literal"><span class="pre">QuerySet</span></code> and reuse it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">queryset</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<span class="nb">print</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">headline</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">]</span> <span class="c1"># Evaluate the query set.</span>
<span class="nb">print</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">pub_date</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">queryset</span><span class="p">]</span> <span class="c1"># Reuse the cache from the evaluation.</span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-objects">
<h2>Filtering Objects<a class="headerlink" href="#filtering-objects" title="Permalink to this headline">¶</a></h2>
<p>The simplest way to retrieve objects from a table is to get all of them.
To do this, use the <code class="docutils literal"><span class="pre">all()</span></code> method on a <code class="docutils literal"><span class="pre">Manager</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">all()</span></code> method returns a <code class="docutils literal"><span class="pre">QuerySet</span></code> of all the objects in the database.</p>
<p>Usually, though, you’ll need to select only a subset of the complete set of
objects. To create such a subset, you refine the initial <code class="docutils literal"><span class="pre">QuerySet</span></code>, adding filter
conditions. You’ll usually do this using the <code class="docutils literal"><span class="pre">filter()</span></code> and/or <code class="docutils literal"><span class="pre">exclude()</span></code>
methods:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">y2006</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2006</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">not2006</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2006</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">filter()</span></code> and <code class="docutils literal"><span class="pre">exclude()</span></code> both take <em>field lookup</em> arguments, which are
discussed in detail shortly.</p>
<div class="section" id="chaining-filters">
<h3>Chaining Filters<a class="headerlink" href="#chaining-filters" title="Permalink to this headline">¶</a></h3>
<p>The result of refining a <code class="docutils literal"><span class="pre">QuerySet</span></code> is itself a <code class="docutils literal"><span class="pre">QuerySet</span></code>, so it’s
possible to chain refinements together, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__startswith</span><span class="o">=</span><span class="s1">&#39;What&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pub_date__gte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__gte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<p>This takes the initial <code class="docutils literal"><span class="pre">QuerySet</span></code> of all entries in the database, adds a
filter, then an exclusion, and then another filter. The final result is a
<code class="docutils literal"><span class="pre">QuerySet</span></code> containing all entries with a headline that starts with “What”
that were published between January 1, 2005, and the current day.</p>
<p>It’s important to point out here that <code class="docutils literal"><span class="pre">QuerySets</span></code> are lazy – the act of creating
a <code class="docutils literal"><span class="pre">QuerySet</span></code> doesn’t involve any database activity. In fact, the three preceding lines
don’t make <em>any</em> database calls; you can chain filters together all day
long and Django won’t actually run the query until the <code class="docutils literal"><span class="pre">QuerySet</span></code> is
<em>evaluated</em>.</p>
<p>You can evaluate a <code class="docutils literal"><span class="pre">QuerySet</span></code> in any following ways:</p>
<ul>
<li><p class="first"><em>Iterating</em>: A <code class="docutils literal"><span class="pre">QuerySet</span></code> is iterable, and it executes its database query the first
time you iterate over it. For example, the following <code class="docutils literal"><span class="pre">QuerySet</span></code> isn’t evaluated
until it’s iterated over in the <code class="docutils literal"><span class="pre">for</span></code> loop:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2006</span><span class="p">)</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">qs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__icontains</span><span class="o">=</span><span class="s2">&quot;bill&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
    <span class="nb">print</span> <span class="n">e</span><span class="o">.</span><span class="n">headline</span>
</pre></div>
</div>
<p>This prints all headlines from 2006 that contain “bill” but causes
only one database hit.</p>
</li>
<li><p class="first"><em>Printing it</em>: A <code class="docutils literal"><span class="pre">QuerySet</span></code> is evaluated when you call <code class="docutils literal"><span class="pre">repr()</span></code> on it.
This is for convenience in the Python interactive interpreter, so you can
immediately see your results when using the API interactively.</p>
</li>
<li><p class="first"><em>Slicing</em>: As explained in the upcoming “Limiting QuerySets” section,
a <code class="docutils literal"><span class="pre">QuerySet</span></code> can be sliced using Python’s array-slicing syntax.
Usually slicing a <code class="docutils literal"><span class="pre">QuerySet</span></code> returns another (unevaluated)``QuerySet``,
but Django will execute the database query if you use the “step”
parameter of slice syntax.</p>
</li>
<li><p class="first"><em>Converting to a list</em>: You can force evaluation of a <code class="docutils literal"><span class="pre">QuerySet</span></code> by calling
<code class="docutils literal"><span class="pre">list()</span></code> on it, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">entry_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">())</span>
</pre></div>
</div>
<p>Be warned, though, that this could have a large memory overhead, because
Django will load each element of the list into memory. In contrast,
iterating over a <code class="docutils literal"><span class="pre">QuerySet</span></code> will take advantage of your database to load
data and instantiate objects only as you need them.</p>
</li>
</ul>
<div class="admonition-filtered-querysets-are-unique admonition">
<p class="first admonition-title">Filtered QuerySets Are Unique</p>
<p>Each time you refine a <code class="docutils literal"><span class="pre">QuerySet</span></code>, you get a brand-new <code class="docutils literal"><span class="pre">QuerySet</span></code> that
is in no way bound to the previous <code class="docutils literal"><span class="pre">QuerySet</span></code>. Each refinement creates a
separate and distinct <code class="docutils literal"><span class="pre">QuerySet</span></code> that can be stored, used, and reused:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">q1</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__startswith</span><span class="o">=</span><span class="s2">&quot;What&quot;</span><span class="p">)</span>
<span class="n">q2</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">exclude</span><span class="p">(</span><span class="n">pub_date__gte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
<span class="n">q3</span> <span class="o">=</span> <span class="n">q1</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__gte</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>
</pre></div>
</div>
<p class="last">These three <code class="docutils literal"><span class="pre">QuerySets</span></code> are separate. The first is a base <code class="docutils literal"><span class="pre">QuerySet</span></code>
containing all entries that contain a headline starting with “What”. The
second is a subset of the first, with an additional criterion that excludes
records whose <code class="docutils literal"><span class="pre">pub_date</span></code> is greater than now. The third is a subset of the
first, with an additional criterion that selects only the records whose
<code class="docutils literal"><span class="pre">pub_date</span></code> is greater than now. The initial <code class="docutils literal"><span class="pre">QuerySet</span></code> (<code class="docutils literal"><span class="pre">q1</span></code>) is
unaffected by the refinement process.</p>
</div>
</div>
<div class="section" id="limiting-querysets">
<h3>Limiting QuerySets<a class="headerlink" href="#limiting-querysets" title="Permalink to this headline">¶</a></h3>
<p>Use Python’s array-slicing syntax to limit your <code class="docutils literal"><span class="pre">QuerySet</span></code> to a certain number
of results. This is the equivalent of SQL’s <code class="docutils literal"><span class="pre">LIMIT</span></code> and <code class="docutils literal"><span class="pre">OFFSET</span></code> clauses.</p>
<p>For example, this returns the first five entries (<code class="docutils literal"><span class="pre">LIMIT</span> <span class="pre">5</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>This returns the sixth through tenth entries (<code class="docutils literal"><span class="pre">OFFSET</span> <span class="pre">5</span> <span class="pre">LIMIT</span> <span class="pre">5</span></code>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[</span><span class="mi">5</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
<p>Generally, slicing a <code class="docutils literal"><span class="pre">QuerySet</span></code> returns a new <code class="docutils literal"><span class="pre">QuerySet</span></code> – it doesn’t
evaluate the query. An exception is if you use the “step” parameter
of Python slice syntax. For example, this would actually execute the query in
order to return a list of every <em>second</em> object of the first ten:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">10</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
<p>To retrieve a <em>single</em> object rather than a list (e.g., <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">foo</span> <span class="pre">FROM</span> <span class="pre">bar</span>
<span class="pre">LIMIT</span> <span class="pre">1</span></code>), use a simple index instead of a slice. For example, this returns the
first <code class="docutils literal"><span class="pre">Entry</span></code> in the database, after ordering entries alphabetically by
headline:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;headline&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
<p>This is roughly equivalent to the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;headline&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</pre></div>
</div>
<p>Note, however, that the first of these will raise <code class="docutils literal"><span class="pre">IndexError</span></code> while the
second will raise <code class="docutils literal"><span class="pre">DoesNotExist</span></code> if no objects match the given criteria.</p>
</div>
<div class="section" id="query-methods-that-return-new-querysets">
<h3>Query Methods That Return New QuerySets<a class="headerlink" href="#query-methods-that-return-new-querysets" title="Permalink to this headline">¶</a></h3>
<p>Django provides a range of <code class="docutils literal"><span class="pre">QuerySet</span></code> refinement methods that modify either
the types of results returned by the <code class="docutils literal"><span class="pre">QuerySet</span></code> or the way its SQL query is
executed. These methods are described in the sections that follow. Some of the
methods take field lookup arguments, which are discussed in detail a bit later
on.</p>
<div class="section" id="filter-lookup">
<h4>filter(**lookup)<a class="headerlink" href="#filter-lookup" title="Permalink to this headline">¶</a></h4>
<p>Returns a new <code class="docutils literal"><span class="pre">QuerySet</span></code> containing objects that match the given lookup
parameters.</p>
</div>
<div class="section" id="exclude-lookup">
<h4>exclude(**lookup)<a class="headerlink" href="#exclude-lookup" title="Permalink to this headline">¶</a></h4>
<p>Returns a new <code class="docutils literal"><span class="pre">QuerySet</span></code> containing objects that do <em>not</em> match the given
lookup parameters.</p>
</div>
<div class="section" id="order-by-fields">
<h4>order_by(*fields)<a class="headerlink" href="#order-by-fields" title="Permalink to this headline">¶</a></h4>
<p>By default, results returned by a <code class="docutils literal"><span class="pre">QuerySet</span></code> are ordered by the ordering
tuple given by the <code class="docutils literal"><span class="pre">ordering</span></code> option in the model’s metadata (see Appendix A). You can
override this for a particular query using the <code class="docutils literal"><span class="pre">order_by()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;headline&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This result will be ordered by <code class="docutils literal"><span class="pre">pub_date</span></code> descending, then by
<code class="docutils literal"><span class="pre">headline</span></code> ascending. The negative sign in front of <code class="docutils literal"><span class="pre">&quot;-pub_date&quot;</span></code> indicates
<em>descending</em> order. Ascending order is assumed if the <code class="docutils literal"><span class="pre">-</span></code> is absent. To order
randomly, use <code class="docutils literal"><span class="pre">&quot;?&quot;</span></code>, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ordering randomly incurs a performance penalty, though, so you shouldn’t use it
for anything with heavy load.</p>
<p>If no ordering is specified in a model’s <code class="docutils literal"><span class="pre">class</span> <span class="pre">Meta</span></code> and a <code class="docutils literal"><span class="pre">QuerySet</span></code> from
that model doesn’t include <code class="docutils literal"><span class="pre">order_by()</span></code>, then ordering will be undefined and
may differ from query to query.</p>
</div>
<div class="section" id="distinct">
<h4>distinct()<a class="headerlink" href="#distinct" title="Permalink to this headline">¶</a></h4>
<p>Returns a new <code class="docutils literal"><span class="pre">QuerySet</span></code> that uses <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">DISTINCT</span></code> in its SQL query. This
eliminates duplicate rows from the query results.</p>
<p>By default, a <code class="docutils literal"><span class="pre">QuerySet</span></code> will not eliminate duplicate rows. In practice, this
is rarely a problem, because simple queries such as <code class="docutils literal"><span class="pre">Blog.objects.all()</span></code> don’t
introduce the possibility of duplicate result rows.</p>
<p>However, if your query spans multiple tables, it’s possible to get duplicate
results when a <code class="docutils literal"><span class="pre">QuerySet</span></code> is evaluated. That’s when you’d use <code class="docutils literal"><span class="pre">distinct()</span></code>.</p>
</div>
<div class="section" id="values-fields">
<h4>values(*fields)<a class="headerlink" href="#values-fields" title="Permalink to this headline">¶</a></h4>
<p>Returns a special <code class="docutils literal"><span class="pre">QuerySet</span></code> that evaluates to a list of dictionaries instead
of model-instance objects. Each of those dictionaries represents an object, with
the keys corresponding to the attribute names of model objects:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># This list contains a Blog object.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s1">&#39;Beatles&#39;</span><span class="p">)</span>
<span class="p">[</span><span class="n">Beatles</span> <span class="n">Blog</span><span class="p">]</span>

<span class="c1"># This list contains a dictionary.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__startswith</span><span class="o">=</span><span class="s1">&#39;Beatles&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="p">[{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Beatles Blog&#39;</span><span class="p">,</span> <span class="s1">&#39;tagline&#39;</span><span class="p">:</span> <span class="s1">&#39;All the latest Beatles news.&#39;</span><span class="p">}]</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">values()</span></code> takes optional positional arguments, <code class="docutils literal"><span class="pre">*fields</span></code>, which specify
field names to which the <code class="docutils literal"><span class="pre">SELECT</span></code> should be limited. If you specify the
fields, each dictionary will contain only the field keys/values for the fields
you specify. If you don’t specify the fields, each dictionary will contain a
key and value for every field in the database table:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>
<span class="go">[{&#39;id&#39;: 1, &#39;name&#39;: &#39;Beatles Blog&#39;, &#39;tagline&#39;: &#39;All the latest Beatles news.&#39;}],</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)</span>
<span class="go">[{&#39;id&#39;: 1, &#39;name&#39;: &#39;Beatles Blog&#39;}]</span>
</pre></div>
</div>
<p>This method is useful when you know you’re only going to need values from a
small number of the available fields and you won’t need the functionality of a
model instance object. It’s more efficient to select only the fields you need to
use.</p>
</div>
<div class="section" id="dates-field-kind-order">
<h4>dates(field, kind, order)<a class="headerlink" href="#dates-field-kind-order" title="Permalink to this headline">¶</a></h4>
<p>Returns a special <code class="docutils literal"><span class="pre">QuerySet</span></code> that evaluates to a list of <code class="docutils literal"><span class="pre">datetime.datetime</span></code>
objects representing all available dates of a particular kind within the
contents of the <code class="docutils literal"><span class="pre">QuerySet</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">field</span></code> argument must be the name of a <code class="docutils literal"><span class="pre">DateField</span></code> or <code class="docutils literal"><span class="pre">DateTimeField</span></code>
of your model. The <code class="docutils literal"><span class="pre">kind</span></code> argument must be either <code class="docutils literal"><span class="pre">&quot;year&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;month&quot;</span></code>, or
<code class="docutils literal"><span class="pre">&quot;day&quot;</span></code>. Each <code class="docutils literal"><span class="pre">datetime.datetime</span></code> object in the result list is “truncated”
to the given <code class="docutils literal"><span class="pre">type</span></code>:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;year&quot;</span></code> returns a list of all distinct year values for the field.</li>
<li><code class="docutils literal"><span class="pre">&quot;month&quot;</span></code> returns a list of all distinct year/month values for the field.</li>
<li><code class="docutils literal"><span class="pre">&quot;day&quot;</span></code> returns a list of all distinct year/month/day values for the field.</li>
</ul>
<p><code class="docutils literal"><span class="pre">order</span></code>, which defaults to <code class="docutils literal"><span class="pre">'ASC'</span></code>, should be either <code class="docutils literal"><span class="pre">'ASC'</span></code> or
<code class="docutils literal"><span class="pre">'DESC'</span></code>. This specifies how to order the results.</p>
<p>Here are a few examples:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">)</span>
<span class="go">[datetime.datetime(2005, 1, 1)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;month&#39;</span><span class="p">)</span>
<span class="go">[datetime.datetime(2005, 2, 1), datetime.datetime(2005, 3, 1)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span>
<span class="go">[datetime.datetime(2005, 2, 20), datetime.datetime(2005, 3, 20)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s1">&#39;DESC&#39;</span><span class="p">)</span>
<span class="go">[datetime.datetime(2005, 3, 20), datetime.datetime(2005, 2, 20)]</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dates</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">)</span>
<span class="go">[datetime.datetime(2005, 3, 20)]</span>
</pre></div>
</div>
</div>
<div class="section" id="select-related">
<h4>select_related()<a class="headerlink" href="#select-related" title="Permalink to this headline">¶</a></h4>
<p>Returns a <code class="docutils literal"><span class="pre">QuerySet</span></code> that will automatically “follow” foreign key
relationships, selecting that additional related-object data when it executes
its query. This is a performance booster that results in (sometimes much)
larger queries but means later use of foreign key relationships won’t require
database queries.</p>
<p>The following examples illustrate the difference between plain lookups and
<code class="docutils literal"><span class="pre">select_related()</span></code> lookups. Here’s standard lookup:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Hits the database.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Hits the database again to get the related Blog object.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>
</pre></div>
</div>
<p>And here’s <code class="docutils literal"><span class="pre">select_related</span></code> lookup:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Hits the database.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Doesn&#39;t hit the database, because e.blog has been prepopulated</span>
<span class="c1"># in the previous query.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">select_related()</span></code> follows foreign keys as far as possible. If you have the
following models:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">City</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">hometown</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">City</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="n">author</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>
</pre></div>
</div>
<p>then a call to <code class="docutils literal"><span class="pre">Book.objects.select_related().get(id=4)</span></code> will cache the
related <code class="docutils literal"><span class="pre">Person</span></code> <em>and</em> the related <code class="docutils literal"><span class="pre">City</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">author</span>         <span class="c1"># Doesn&#39;t hit the database.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hometown</span>       <span class="c1"># Doesn&#39;t hit the database.</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="c1"># No select_related() in this example.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">author</span>         <span class="c1"># Hits the database.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">hometown</span>       <span class="c1"># Hits the database.</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">select_related()</span></code> does not follow foreign keys that have
<code class="docutils literal"><span class="pre">null=True</span></code>.</p>
<p>Usually, using <code class="docutils literal"><span class="pre">select_related()</span></code> can vastly improve performance because your
application can avoid many database calls. However, in situations with deeply nested
sets of relationships, <code class="docutils literal"><span class="pre">select_related()</span></code> can sometimes end up following “too
many” relations and can generate queries so large that they end up being slow.</p>
</div>
</div>
<div class="section" id="queryset-methods-that-do-not-return-querysets">
<h3>QuerySet Methods That Do Not Return QuerySets<a class="headerlink" href="#queryset-methods-that-do-not-return-querysets" title="Permalink to this headline">¶</a></h3>
<p>The following <code class="docutils literal"><span class="pre">QuerySet</span></code> methods evaluate the <code class="docutils literal"><span class="pre">QuerySet</span></code> and return
something <em>other than</em> a <code class="docutils literal"><span class="pre">QuerySet</span></code> – a single object, value, and so forth.</p>
<div class="section" id="get-lookup">
<h4>get(**lookup)<a class="headerlink" href="#get-lookup" title="Permalink to this headline">¶</a></h4>
<p>Returns the object matching the given lookup parameters, which should be in the
format described in the “Field Lookups” section. This raises <code class="docutils literal"><span class="pre">AssertionError</span></code> if
more than one object was found.</p>
<p><code class="docutils literal"><span class="pre">get()</span></code> raises a <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception if an object wasn’t found for the
given parameters. The <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception is an attribute of the model
class, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s1">&#39;foo&#39;</span><span class="p">)</span> <span class="c1"># raises Entry.DoesNotExist</span>
</pre></div>
</div>
<p>The <code class="docutils literal"><span class="pre">DoesNotExist</span></code> exception inherits from
<code class="docutils literal"><span class="pre">django.core.exceptions.ObjectDoesNotExist</span></code>, so you can target multiple
<code class="docutils literal"><span class="pre">DoesNotExist</span></code> exceptions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="gp">... </span>    <span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">... </span><span class="k">except</span> <span class="n">ObjectDoesNotExist</span><span class="p">:</span>
<span class="gp">... </span>    <span class="nb">print</span> <span class="s2">&quot;Either the entry or blog doesn&#39;t exist.&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="create-kwargs">
<h4>create(**kwargs)<a class="headerlink" href="#create-kwargs" title="Permalink to this headline">¶</a></h4>
<p>This is a convenience method for creating an object and saving it all in one step.
It lets you compress two common steps:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s2">&quot;Bruce&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s2">&quot;Springsteen&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>into a single line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s2">&quot;Bruce&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s2">&quot;Springsteen&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="get-or-create-kwargs">
<h4>get_or_create(**kwargs)<a class="headerlink" href="#get-or-create-kwargs" title="Permalink to this headline">¶</a></h4>
<p>This is a convenience method for looking up an object and creating one if it doesn’t
exist. It returns a tuple of <code class="docutils literal"><span class="pre">(object,</span> <span class="pre">created)</span></code>, where <code class="docutils literal"><span class="pre">object</span></code> is the retrieved or
created object and <code class="docutils literal"><span class="pre">created</span></code> is a Boolean specifying whether a new object was
created.</p>
<p>This method is meant as a shortcut to boilerplate code and is mostly useful for
data-import scripts. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">try</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">Person</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">,</span> <span class="n">birthday</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>This pattern gets quite unwieldy as the number of fields in a model increases. The
previous example can be rewritten using <code class="docutils literal"><span class="pre">get_or_create()</span></code> like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">obj</span><span class="p">,</span> <span class="n">created</span> <span class="o">=</span> <span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="s1">&#39;John&#39;</span><span class="p">,</span>
    <span class="n">last_name</span>  <span class="o">=</span> <span class="s1">&#39;Lennon&#39;</span><span class="p">,</span>
    <span class="n">defaults</span>   <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;birthday&#39;</span><span class="p">:</span> <span class="n">date</span><span class="p">(</span><span class="mi">1940</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">9</span><span class="p">)}</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Any keyword arguments passed to <code class="docutils literal"><span class="pre">get_or_create()</span></code> – <em>except</em> an optional one
called <code class="docutils literal"><span class="pre">defaults</span></code> – will be used in a <code class="docutils literal"><span class="pre">get()</span></code> call. If an object is found,
<code class="docutils literal"><span class="pre">get_or_create()</span></code> returns a tuple of that object and <code class="docutils literal"><span class="pre">False</span></code>. If an object
is <em>not</em> found, <code class="docutils literal"><span class="pre">get_or_create()</span></code> will instantiate and save a new object,
returning a tuple of the new object and <code class="docutils literal"><span class="pre">True</span></code>. The new object will be created
according to this algorithm:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">defaults</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;defaults&#39;</span><span class="p">,</span> <span class="p">{})</span>
<span class="n">params</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;__&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">k</span><span class="p">])</span>
<span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">defaults</span><span class="p">)</span>
<span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
<span class="n">obj</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>In English, that means start with any non-<code class="docutils literal"><span class="pre">'defaults'</span></code> keyword argument that
doesn’t contain a double underscore (which would indicate a nonexact lookup).
Then add the contents of <code class="docutils literal"><span class="pre">defaults</span></code>, overriding any keys if necessary, and
use the result as the keyword arguments to the model class.</p>
<p>If you have a field named <code class="docutils literal"><span class="pre">defaults</span></code> and want to use it as an exact lookup in
<code class="docutils literal"><span class="pre">get_or_create()</span></code>, just use <code class="docutils literal"><span class="pre">'defaults__exact'</span></code> like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Foo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span>
    <span class="n">defaults__exact</span> <span class="o">=</span> <span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="n">defaults</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;defaults&#39;</span><span class="p">:</span> <span class="s1">&#39;bar&#39;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">As mentioned earlier, <code class="docutils literal"><span class="pre">get_or_create()</span></code> is mostly useful in scripts that
need to parse data and create new records if existing ones aren’t available.
But if you need to use <code class="docutils literal"><span class="pre">get_or_create()</span></code> in a view, please make sure to
use it only in <code class="docutils literal"><span class="pre">POST</span></code> requests unless you have a good reason not to.
<code class="docutils literal"><span class="pre">GET</span></code> requests shouldn’t have any effect on data; use <code class="docutils literal"><span class="pre">POST</span></code> whenever a
request to a page has a side effect on your data.</p>
</div>
</div>
<div class="section" id="count">
<h4>count()<a class="headerlink" href="#count" title="Permalink to this headline">¶</a></h4>
<p>Returns an integer representing the number of objects in the database matching
the <code class="docutils literal"><span class="pre">QuerySet</span></code>. <code class="docutils literal"><span class="pre">count()</span></code> never raises exceptions. Here’s an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Returns the total number of entries in the database.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">4</span>

<span class="c1"># Returns the number of entries whose headline contains &#39;Lennon&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="mi">1</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">count()</span></code> performs a <code class="docutils literal"><span class="pre">SELECT</span> <span class="pre">COUNT(*)</span></code> behind the scenes, so you should
always use <code class="docutils literal"><span class="pre">count()</span></code> rather than loading all of the records into Python objects
and calling <code class="docutils literal"><span class="pre">len()</span></code> on the result.</p>
<p>Depending on which database you’re using (e.g., PostgreSQL or MySQL),
<code class="docutils literal"><span class="pre">count()</span></code> may return a long integer instead of a normal Python integer. This
is an underlying implementation quirk that shouldn’t pose any real-world
problems.</p>
</div>
<div class="section" id="in-bulk-id-list">
<h4>in_bulk(id_list)<a class="headerlink" href="#in-bulk-id-list" title="Permalink to this headline">¶</a></h4>
<p>Takes a list of primary key values and returns a dictionary mapping each
primary key value to an instance of the object with the given ID, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="go">{1: Beatles Blog}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="go">{1: Beatles Blog, 2: Cheddar Talk}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">in_bulk</span><span class="p">([])</span>
<span class="go">{}</span>
</pre></div>
</div>
<p>IDs of objects that don’t exist are silently dropped from the result dictionary.
If you pass <code class="docutils literal"><span class="pre">in_bulk()</span></code> an empty list, you’ll get an empty dictionary.</p>
</div>
<div class="section" id="latest-field-name-none">
<h4>latest(field_name=None)<a class="headerlink" href="#latest-field-name-none" title="Permalink to this headline">¶</a></h4>
<p>Returns the latest object in the table, by date, using the <code class="docutils literal"><span class="pre">field_name</span></code>
provided as the date field. This example returns the latest <code class="docutils literal"><span class="pre">Entry</span></code> in the
table, according to the <code class="docutils literal"><span class="pre">pub_date</span></code> field:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">latest</span><span class="p">(</span><span class="s1">&#39;pub_date&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If your model’s <code class="docutils literal"><span class="pre">Meta</span></code> specifies <code class="docutils literal"><span class="pre">get_latest_by</span></code>, you can leave off the
<code class="docutils literal"><span class="pre">field_name</span></code> argument to <code class="docutils literal"><span class="pre">latest()</span></code>. Django will use the field specified in
<code class="docutils literal"><span class="pre">get_latest_by</span></code> by default.</p>
<p>Like <code class="docutils literal"><span class="pre">get()</span></code>, <code class="docutils literal"><span class="pre">latest()</span></code> raises <code class="docutils literal"><span class="pre">DoesNotExist</span></code> if an object doesn’t exist
with the given parameters.</p>
</div>
</div>
</div>
<div class="section" id="field-lookups">
<h2>Field Lookups<a class="headerlink" href="#field-lookups" title="Permalink to this headline">¶</a></h2>
<p>Field lookups are how you specify the meat of an SQL <code class="docutils literal"><span class="pre">WHERE</span></code> clause. They’re
specified as keyword arguments to the <code class="docutils literal"><span class="pre">QuerySet</span></code> methods <code class="docutils literal"><span class="pre">filter()</span></code>,
<code class="docutils literal"><span class="pre">exclude()</span></code>, and <code class="docutils literal"><span class="pre">get()</span></code>.</p>
<p>Basic lookup keyword arguments take the form <code class="docutils literal"><span class="pre">field__lookuptype=value</span></code>
(note the double underscore). For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__lte</span><span class="o">=</span><span class="s1">&#39;2006-01-01&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>translates (roughly) into the following SQL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="n">FROM</span> <span class="n">blog_entry</span> <span class="n">WHERE</span> <span class="n">pub_date</span> <span class="o">&lt;=</span> <span class="s1">&#39;2006-01-01&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>If you pass an invalid keyword argument, a lookup function will raise
<code class="docutils literal"><span class="pre">TypeError</span></code>.</p>
<p>The supported lookup types follow.</p>
<div class="section" id="exact">
<h3>exact<a class="headerlink" href="#exact" title="Permalink to this headline">¶</a></h3>
<p>Performs an exact match:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">headline__exact</span><span class="o">=</span><span class="s2">&quot;Man bites dog&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This matches any object with the exact headline “Man bites dog”.</p>
<p>If you don’t provide a lookup type – that is, if your keyword argument doesn’t
contain a double underscore – the lookup type is assumed to be <code class="docutils literal"><span class="pre">exact</span></code>.</p>
<p>For example, the following two statements are equivalent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id__exact</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># Explicit form</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># __exact is implied</span>
</pre></div>
</div>
<p>This is for convenience, because <code class="docutils literal"><span class="pre">exact</span></code> lookups are the common case.</p>
</div>
<div class="section" id="iexact">
<h3>iexact<a class="headerlink" href="#iexact" title="Permalink to this headline">¶</a></h3>
<p>Performs a case-insensitive exact match:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name__iexact</span><span class="o">=</span><span class="s1">&#39;beatles blog&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will match <code class="docutils literal"><span class="pre">'Beatles</span> <span class="pre">Blog'</span></code>, <code class="docutils literal"><span class="pre">'beatles</span> <span class="pre">blog'</span></code>,
<code class="docutils literal"><span class="pre">'BeAtLes</span> <span class="pre">BLoG'</span></code>, and so forth.</p>
</div>
<div class="section" id="contains">
<h3>contains<a class="headerlink" href="#contains" title="Permalink to this headline">¶</a></h3>
<p>Performs a case-sensitive containment test:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will match the headline <code class="docutils literal"><span class="pre">'Today</span> <span class="pre">Lennon</span> <span class="pre">honored'</span></code> but not
<code class="docutils literal"><span class="pre">'today</span> <span class="pre">lennon</span> <span class="pre">honored'</span></code>.</p>
<p>SQLite doesn’t support case-sensitive <code class="docutils literal"><span class="pre">LIKE</span></code> statements; when using
SQLite,``contains`` acts like <code class="docutils literal"><span class="pre">icontains</span></code>.</p>
<div class="admonition-escaping-percent-signs-and-underscores-in-like-statements admonition">
<p class="first admonition-title">Escaping Percent Signs and Underscores in LIKE Statements</p>
<p>The field lookups that equate to <code class="docutils literal"><span class="pre">LIKE</span></code> SQL statements (<code class="docutils literal"><span class="pre">iexact</span></code>,
<code class="docutils literal"><span class="pre">contains</span></code>, <code class="docutils literal"><span class="pre">icontains</span></code>, <code class="docutils literal"><span class="pre">startswith</span></code>, <code class="docutils literal"><span class="pre">istartswith</span></code>, <code class="docutils literal"><span class="pre">endswith</span></code>,
and <code class="docutils literal"><span class="pre">iendswith</span></code>) will automatically escape the two special characters used in
<code class="docutils literal"><span class="pre">LIKE</span></code> statements – the percent sign and the underscore. (In a <code class="docutils literal"><span class="pre">LIKE</span></code>
statement, the percent sign signifies a multiple-character wildcard and the
underscore signifies a single-character wildcard.)</p>
<p>This means things should work intuitively, so the abstraction doesn’t leak.
For example, to retrieve all the entries that contain a percent sign, just use
the percent sign as any other character:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;%&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Django takes care of the quoting for you. The resulting SQL will look something
like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">...</span> <span class="n">WHERE</span> <span class="n">headline</span> <span class="n">LIKE</span> <span class="s1">&#39;%\</span><span class="si">%%</span><span class="s1">&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p class="last">The same goes for underscores. Both percentage signs and underscores are handled
for you transparently.</p>
</div>
</div>
<div class="section" id="icontains">
<h3>icontains<a class="headerlink" href="#icontains" title="Permalink to this headline">¶</a></h3>
<p>Performs a case-insensitive containment test:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">headline__icontains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Unlike <code class="docutils literal"><span class="pre">contains</span></code>, <code class="docutils literal"><span class="pre">icontains</span></code> <em>will</em> match <code class="docutils literal"><span class="pre">'today</span> <span class="pre">lennon</span> <span class="pre">honored'</span></code>.</p>
</div>
<div class="section" id="gt-gte-lt-and-lte">
<h3>gt, gte, lt, and lte<a class="headerlink" href="#gt-gte-lt-and-lte" title="Permalink to this headline">¶</a></h3>
<p>These represent greater than, greater than or equal to, less than, and less
than or equal to:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__gt</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__lt</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__gte</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>These queries return any object with an ID greater than 4, an ID less than 15,
and an ID greater than or equal to 1, respectively.</p>
<p>You’ll usually use these on numeric fields. Be careful with character fields
since character order isn’t always what you’d expect (i.e., the string “4” sorts
<em>after</em> the string “10”).</p>
</div>
<div class="section" id="in">
<h3>in<a class="headerlink" href="#in" title="Permalink to this headline">¶</a></h3>
<p>Filters where a value is on a given list:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
</pre></div>
</div>
<p>This returns all objects with the ID 1, 3, or 4.</p>
</div>
<div class="section" id="startswith">
<h3>startswith<a class="headerlink" href="#startswith" title="Permalink to this headline">¶</a></h3>
<p>Performs a case-sensitive starts-with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__startswith</span><span class="o">=</span><span class="s1">&#39;Will&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return the headlines “Will he run?” and “Willbur named judge”, but not
“Who is Will?” or “will found in crypt”.</p>
</div>
<div class="section" id="istartswith">
<h3>istartswith<a class="headerlink" href="#istartswith" title="Permalink to this headline">¶</a></h3>
<p>Performs a case-insensitive starts-with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__istartswith</span><span class="o">=</span><span class="s1">&#39;will&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This will return the headlines “Will he run?”, “Willbur named judge”, and
“will found in crypt”, but not “Who is Will?”</p>
</div>
<div class="section" id="endswith-and-iendswith">
<h3>endswith and iendswith<a class="headerlink" href="#endswith-and-iendswith" title="Permalink to this headline">¶</a></h3>
<p>Perform case-sensitive and case-insensitive ends-with:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__endswith</span><span class="o">=</span><span class="s1">&#39;cats&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__iendswith</span><span class="o">=</span><span class="s1">&#39;cats&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Similar to <code class="docutils literal"><span class="pre">startswith</span></code> and <code class="docutils literal"><span class="pre">istartswith</span></code>.</p>
</div>
<div class="section" id="range">
<h3>range<a class="headerlink" href="#range" title="Permalink to this headline">¶</a></h3>
<p>Performs an inclusive range check:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">start_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">end_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__range</span><span class="o">=</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
</pre></div>
</div>
<p>You can use <code class="docutils literal"><span class="pre">range</span></code> anywhere you can use <code class="docutils literal"><span class="pre">BETWEEN</span></code> in SQL – for dates,
numbers, and even characters.</p>
</div>
<div class="section" id="year-month-and-day">
<h3>year, month, and day<a class="headerlink" href="#year-month-and-day" title="Permalink to this headline">¶</a></h3>
<p>For date/datetime fields, perform exact year, month, or day matches:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Return all entries published in 2005</span>
<span class="o">&gt;&gt;&gt;</span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span>

<span class="c1"># Return all entries published in December</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__month</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Return all entries published on the 3rd of the month</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__day</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Combination: return all entries on Christmas of any year</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__month</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">pub_date_day</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="isnull">
<h3>isnull<a class="headerlink" href="#isnull" title="Permalink to this headline">¶</a></h3>
<p>Takes either <code class="docutils literal"><span class="pre">True</span></code> or <code class="docutils literal"><span class="pre">False</span></code>, which correspond to SQL queries of
<code class="docutils literal"><span class="pre">IS</span> <span class="pre">NULL</span></code> and <code class="docutils literal"><span class="pre">IS</span> <span class="pre">NOT</span> <span class="pre">NULL</span></code>, respectively:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__isnull</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="search">
<h3>search<a class="headerlink" href="#search" title="Permalink to this headline">¶</a></h3>
<p>A Boolean full-text search that takes advantage of full-text indexing. This is like
<code class="docutils literal"><span class="pre">contains</span></code> but is significantly faster due to full-text indexing.</p>
<p>Note this is available only in MySQL and requires direct manipulation of the
database to add the full-text index.</p>
</div>
<div class="section" id="the-pk-lookup-shortcut">
<h3>The pk Lookup Shortcut<a class="headerlink" href="#the-pk-lookup-shortcut" title="Permalink to this headline">¶</a></h3>
<p>For convenience, Django provides a <code class="docutils literal"><span class="pre">pk</span></code> lookup type, which stands for
“primary_key”.</p>
<p>In the example <code class="docutils literal"><span class="pre">Blog</span></code> model, the primary key is the <code class="docutils literal"><span class="pre">id</span></code> field, so these
three statements are equivalent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">id__exact</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># Explicit form</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># __exact is implied</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span> <span class="c1"># pk implies id__exact</span>
</pre></div>
</div>
<p>The use of <code class="docutils literal"><span class="pre">pk</span></code> isn’t limited to <code class="docutils literal"><span class="pre">__exact</span></code> queries – any query term can be
combined with <code class="docutils literal"><span class="pre">pk</span></code> to perform a query on the primary key of a model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Get blogs entries  with id 1, 4, and 7</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__in</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

<span class="c1"># Get all blog entries with id &gt; 14</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk__gt</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">pk</span></code> lookups also work across joins. For example, these three statements are
equivalent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__id__exact</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># Explicit form</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># __exact is implied</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__pk</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># __pk implies __id__exact</span>
</pre></div>
</div>
<p>The point of <code class="docutils literal"><span class="pre">pk</span></code> is to give you a generic way to refer to the primary key in
cases where you’re not sure whether the model’s primary key is called <code class="docutils literal"><span class="pre">id</span></code>.</p>
</div>
</div>
<div class="section" id="complex-lookups-with-q-objects">
<h2>Complex Lookups with Q Objects<a class="headerlink" href="#complex-lookups-with-q-objects" title="Permalink to this headline">¶</a></h2>
<p>Keyword argument queries – in <code class="docutils literal"><span class="pre">filter()</span></code> and so on – are ANDed together. If
you need to execute more complex queries (e.g., queries with <code class="docutils literal"><span class="pre">OR</span></code>
statements), you can use <code class="docutils literal"><span class="pre">Q</span></code> objects.</p>
<p>A <code class="docutils literal"><span class="pre">Q</span></code> object (<code class="docutils literal"><span class="pre">django.db.models.Q</span></code>) is an object used to encapsulate a
collection of keyword arguments. These keyword arguments are specified as in
the “Field Lookups” section.</p>
<p>For example, this <code class="docutils literal"><span class="pre">Q</span></code> object encapsulates a single <code class="docutils literal"><span class="pre">LIKE</span></code> query:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Q</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;What&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">Q</span></code> objects can be combined using the <code class="docutils literal"><span class="pre">&amp;</span></code> and <code class="docutils literal"><span class="pre">|</span></code> operators. When an
operator is used on two <code class="docutils literal"><span class="pre">Q</span></code> objects, it yields a new <code class="docutils literal"><span class="pre">Q</span></code> object. For example,
this statement yields a single <code class="docutils literal"><span class="pre">Q</span></code> object that represents the
OR of two <code class="docutils literal"><span class="pre">&quot;question__startswith&quot;</span></code> queries:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Q</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;Who&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;What&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This is equivalent to the following SQL <code class="docutils literal"><span class="pre">WHERE</span></code> clause:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">WHERE</span> <span class="n">question</span> <span class="n">LIKE</span> <span class="s1">&#39;Who%&#39;</span> <span class="n">OR</span> <span class="n">question</span> <span class="n">LIKE</span> <span class="s1">&#39;What%&#39;</span>
</pre></div>
</div>
<p>You can compose statements of arbitrary complexity by combining <code class="docutils literal"><span class="pre">Q</span></code> objects
with the <code class="docutils literal"><span class="pre">&amp;</span></code> and <code class="docutils literal"><span class="pre">|</span></code> operators. You can also use parenthetical grouping.</p>
<p>Each lookup function that takes keyword arguments (e.g., <code class="docutils literal"><span class="pre">filter()</span></code>,
<code class="docutils literal"><span class="pre">exclude()</span></code>, <code class="docutils literal"><span class="pre">get()</span></code>) can also be passed one or more <code class="docutils literal"><span class="pre">Q</span></code> objects as
positional (not-named) arguments. If you provide multiple <code class="docutils literal"><span class="pre">Q</span></code> object
arguments to a lookup function, the arguments will be ANDed together, for
example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">Q</span><span class="p">(</span><span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;Who&#39;</span><span class="p">),</span>
    <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>
<p>roughly translates into the following SQL:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SELECT</span> <span class="o">*</span> <span class="kn">from</span> <span class="nn">polls</span> <span class="n">WHERE</span> <span class="n">question</span> <span class="n">LIKE</span> <span class="s1">&#39;Who%&#39;</span>
    <span class="n">AND</span> <span class="p">(</span><span class="n">pub_date</span> <span class="o">=</span> <span class="s1">&#39;2005-05-02&#39;</span> <span class="n">OR</span> <span class="n">pub_date</span> <span class="o">=</span> <span class="s1">&#39;2005-05-06&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Lookup functions can mix the use of <code class="docutils literal"><span class="pre">Q</span></code> objects and keyword arguments. All
arguments provided to a lookup function (be they keyword arguments or <code class="docutils literal"><span class="pre">Q</span></code>
objects) are ANDed together. However, if a <code class="docutils literal"><span class="pre">Q</span></code> object is provided, it must
precede the definition of any keyword arguments. For example, the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)),</span>
    <span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;Who&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>would be a valid query, equivalent to the previous example, but this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># INVALID QUERY</span>
<span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
    <span class="n">question__startswith</span><span class="o">=</span><span class="s1">&#39;Who&#39;</span><span class="p">,</span>
    <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">pub_date</span><span class="o">=</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">)))</span>
</pre></div>
</div>
<p>would not be valid.</p>
<p>You can find some examples online at <a class="reference external" href="http://www.djangoproject.com/documentation/models/or_lookups/">http://www.djangoproject.com/documentation/models/or_lookups/</a>.</p>
</div>
<div class="section" id="related-objects">
<h2>Related Objects<a class="headerlink" href="#related-objects" title="Permalink to this headline">¶</a></h2>
<p>When you define a relationship in a model (i.e., a <code class="docutils literal"><span class="pre">ForeignKey</span></code>,
<code class="docutils literal"><span class="pre">OneToOneField</span></code>, or <code class="docutils literal"><span class="pre">ManyToManyField</span></code>), instances of that model will have
a convenient API to access the related object(s).</p>
<p>For example, an <code class="docutils literal"><span class="pre">Entry</span></code> object <code class="docutils literal"><span class="pre">e</span></code> can get its associated <code class="docutils literal"><span class="pre">Blog</span></code> object by
accessing the <code class="docutils literal"><span class="pre">blog</span></code> attribute <code class="docutils literal"><span class="pre">e.blog</span></code>.</p>
<p>Django also creates API accessors for the “other” side of the relationship –
the link from the related model to the model that defines the relationship.
For example, a <code class="docutils literal"><span class="pre">Blog</span></code> object <code class="docutils literal"><span class="pre">b</span></code> has access to a list of all related
<code class="docutils literal"><span class="pre">Entry</span></code> objects via the <code class="docutils literal"><span class="pre">entry_set</span></code> attribute: <code class="docutils literal"><span class="pre">b.entry_set.all()</span></code>.</p>
<p>All examples in this section use the sample <code class="docutils literal"><span class="pre">Blog</span></code>, <code class="docutils literal"><span class="pre">Author</span></code>, and <code class="docutils literal"><span class="pre">Entry</span></code>
models defined at the start of the appendix.</p>
<div class="section" id="lookups-that-span-relationships">
<h3>Lookups That Span Relationships<a class="headerlink" href="#lookups-that-span-relationships" title="Permalink to this headline">¶</a></h3>
<p>Django offers a powerful and intuitive way to “follow” relationships in
lookups, taking care of the SQL <code class="docutils literal"><span class="pre">JOIN</span></code>s for you automatically behind the
scenes. To span a relationship, just use the field name of related fields
across models, separated by double underscores, until you get to the field you
want.</p>
<p>This example retrieves all <code class="docutils literal"><span class="pre">Entry</span></code> objects with a <code class="docutils literal"><span class="pre">Blog</span></code> whose <code class="docutils literal"><span class="pre">name</span></code>
is <code class="docutils literal"><span class="pre">'Beatles</span> <span class="pre">Blog'</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog__name__exact</span><span class="o">=</span><span class="s1">&#39;Beatles Blog&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This spanning can be as deep as you’d like.</p>
<p>It works backward, too. To refer to a “reverse” relationship, just use the
lowercase name of the model.</p>
<p>This example retrieves all <code class="docutils literal"><span class="pre">Blog</span></code> objects that have at least one <code class="docutils literal"><span class="pre">Entry</span></code>
whose <code class="docutils literal"><span class="pre">headline</span></code> contains <code class="docutils literal"><span class="pre">'Lennon'</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">entry__headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="foreign-key-relationships">
<h3>Foreign Key Relationships<a class="headerlink" href="#foreign-key-relationships" title="Permalink to this headline">¶</a></h3>
<p>If a model has a <code class="docutils literal"><span class="pre">ForeignKey</span></code>, instances of that model will have access to
the related (foreign) object via a simple attribute of the model, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">blog</span> <span class="c1"># Returns the related Blog object.</span>
</pre></div>
</div>
<p>You can get and set via a foreign key attribute. As you may expect, changes to
the foreign key aren’t saved to the database until you call <code class="docutils literal"><span class="pre">save()</span></code>, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">blog</span> <span class="o">=</span> <span class="n">some_blog</span>
<span class="n">e</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>If a <code class="docutils literal"><span class="pre">ForeignKey</span></code> field has <code class="docutils literal"><span class="pre">null=True</span></code> set (i.e., it allows <code class="docutils literal"><span class="pre">NULL</span></code>
values), you can set it to <code class="docutils literal"><span class="pre">NULL</span></code> by assigning <code class="docutils literal"><span class="pre">None</span></code> to it and saving:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">blog</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">e</span><span class="o">.</span><span class="n">save</span><span class="p">()</span> <span class="c1"># &quot;UPDATE blog_entry SET blog_id = NULL ...;&quot;</span>
</pre></div>
</div>
<p>Forward access to one-to-many relationships is cached the first time the
related object is accessed. Subsequent accesses to the foreign key on the same
object instance are cached, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>  <span class="c1"># Hits the database to retrieve the associated Blog.</span>
<span class="nb">print</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>  <span class="c1"># Doesn&#39;t hit the database; uses cached version.</span>
</pre></div>
</div>
<p>Note that the <code class="docutils literal"><span class="pre">select_related()</span></code> <code class="docutils literal"><span class="pre">QuerySet</span></code> method recursively prepopulates
the cache of all one-to-many relationships ahead of time:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">select_related</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>  <span class="c1"># Doesn&#39;t hit the database; uses cached version.</span>
<span class="nb">print</span> <span class="n">e</span><span class="o">.</span><span class="n">blog</span>  <span class="c1"># Doesn&#39;t hit the database; uses cached version.</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">select_related()</span></code> is documented in the “QuerySet Methods That Return New
QuerySets” section.</p>
</div>
<div class="section" id="reverse-foreign-key-relationships">
<h3>“Reverse” Foreign Key Relationships<a class="headerlink" href="#reverse-foreign-key-relationships" title="Permalink to this headline">¶</a></h3>
<p>Foreign key relationships are automatically symmetrical – a reverse
relationship is inferred from the presence of a <code class="docutils literal"><span class="pre">ForeignKey</span></code> pointing to
another model.</p>
<p>If a model has a <code class="docutils literal"><span class="pre">ForeignKey</span></code>, instances of the foreign key model will have
access to a <code class="docutils literal"><span class="pre">Manager</span></code> that returns all instances of the first model that
relate to that object. By default, this <code class="docutils literal"><span class="pre">Manager</span></code> is named <code class="docutils literal"><span class="pre">FOO_set</span></code>, where
<code class="docutils literal"><span class="pre">FOO</span></code> is the source model name, lowercased. This <code class="docutils literal"><span class="pre">Manager</span></code> returns
<code class="docutils literal"><span class="pre">QuerySets</span></code>, which can be filtered and manipulated as described in the
“Retrieving Objects” section.</p>
<p>Here’s an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># Returns all Entry objects related to Blog.</span>

<span class="c1"># b.entry_set is a Manager that returns QuerySets.</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p>You can override the <code class="docutils literal"><span class="pre">FOO_set</span></code> name by setting the <code class="docutils literal"><span class="pre">related_name</span></code>
parameter in the <code class="docutils literal"><span class="pre">ForeignKey()</span></code> definition. For example, if the <code class="docutils literal"><span class="pre">Entry</span></code>
model was altered to <code class="docutils literal"><span class="pre">blog</span> <span class="pre">=</span> <span class="pre">ForeignKey(Blog,</span> <span class="pre">related_name='entries')</span></code>, the
preceding example code would look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># Returns all Entry objects related to Blog.</span>

<span class="c1"># b.entries is a Manager that returns QuerySets.</span>
<span class="n">b</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">headline__contains</span><span class="o">=</span><span class="s1">&#39;Lennon&#39;</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entries</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">related_name</span></code> is particularly useful if a model has two foreign keys to the
same second model.</p>
<p>You cannot access a reverse <code class="docutils literal"><span class="pre">ForeignKey</span></code> <code class="docutils literal"><span class="pre">Manager</span></code> from the class; it must
be accessed from an instance:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Blog</span><span class="o">.</span><span class="n">entry_set</span> <span class="c1"># Raises AttributeError: &quot;Manager must be accessed via instance&quot;.</span>
</pre></div>
</div>
<p>In addition to the <code class="docutils literal"><span class="pre">QuerySet</span></code> methods defined in the “Retrieving Objects” section,
the <code class="docutils literal"><span class="pre">ForeignKey</span></code> <code class="docutils literal"><span class="pre">Manager</span></code> has these additional methods:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">add(obj1,</span> <span class="pre">obj2,</span> <span class="pre">...)</span></code>: Adds the specified model objects to the related
object set, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">234</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="c1"># Associates Entry e with Blog b.</span>
</pre></div>
</div>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">create(**kwargs)</span></code>: Creates a new object, saves it, and puts it in the
related object set. It returns the newly created object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">headline</span><span class="o">=</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="n">body_text</span><span class="o">=</span><span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># No need to call e.save() at this point -- it&#39;s already been saved.</span>
</pre></div>
</div>
<p>This is equivalent to (but much simpler than) the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">headline</span><span class="o">=</span><span class="s1">&#39;Hello&#39;</span><span class="p">,</span> <span class="n">body_text</span><span class="o">=</span><span class="s1">&#39;Hi&#39;</span><span class="p">,</span> <span class="n">pub_date</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">2005</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">e</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that there’s no need to specify the keyword argument of the model
that defines the relationship. In the preceding example, we don’t pass the
parameter <code class="docutils literal"><span class="pre">blog</span></code> to <code class="docutils literal"><span class="pre">create()</span></code>. Django figures out that the new
<code class="docutils literal"><span class="pre">Entry</span></code> object’s <code class="docutils literal"><span class="pre">blog</span></code> field should be set to <code class="docutils literal"><span class="pre">b</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">remove(obj1,</span> <span class="pre">obj2,</span> <span class="pre">...)</span></code>: Removes the specified model objects from the
related object set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">234</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="c1"># Disassociates Entry e from Blog b.</span>
</pre></div>
</div>
<p>In order to prevent database inconsistency, this method only exists on
<code class="docutils literal"><span class="pre">ForeignKey</span></code> objects where <code class="docutils literal"><span class="pre">null=True</span></code>. If the related field can’t be
set to <code class="docutils literal"><span class="pre">None</span></code> (<code class="docutils literal"><span class="pre">NULL</span></code>), then an object can’t be removed from a
relation without being added to another. In the preceding example, removing
<code class="docutils literal"><span class="pre">e</span></code> from <code class="docutils literal"><span class="pre">b.entry_set()</span></code> is equivalent to doing <code class="docutils literal"><span class="pre">e.blog</span> <span class="pre">=</span> <span class="pre">None</span></code>,
and because the <code class="docutils literal"><span class="pre">blog</span></code> <code class="docutils literal"><span class="pre">ForeignKey</span></code> doesn’t have <code class="docutils literal"><span class="pre">null=True</span></code>, this
is invalid.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">clear()</span></code>: Removes all objects from the related object set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<p>Note this doesn’t delete the related objects – it just disassociates
them.</p>
<p>Just like <code class="docutils literal"><span class="pre">remove()</span></code>, <code class="docutils literal"><span class="pre">clear()</span></code> is only available on <code class="docutils literal"><span class="pre">ForeignKey``s</span>
<span class="pre">where</span> <span class="pre">``null=True</span></code>.</p>
</li>
</ul>
<p>To assign the members of a related set in one fell swoop, just assign to it
from any iterable object, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">b</span><span class="o">.</span><span class="n">entry_set</span> <span class="o">=</span> <span class="p">[</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">]</span>
</pre></div>
</div>
<p>If the <code class="docutils literal"><span class="pre">clear()</span></code> method is available, any pre-existing objects will be
removed from the <code class="docutils literal"><span class="pre">entry_set</span></code> before all objects in the iterable (in this
case, a list) are added to the set. If the <code class="docutils literal"><span class="pre">clear()</span></code> method is <em>not</em>
available, all objects in the iterable will be added without removing any
existing elements.</p>
<p>Each “reverse” operation described in this section has an immediate effect on
the database. Every addition, creation, and deletion is immediately and
automatically saved to the database.</p>
</div>
<div class="section" id="many-to-many-relationships">
<h3>Many-to-Many Relationships<a class="headerlink" href="#many-to-many-relationships" title="Permalink to this headline">¶</a></h3>
<p>Both ends of a many-to-many relationship get automatic API access to the other
end. The API works just as a “reverse” one-to-many relationship (described
in the previous section).</p>
<p>The only difference is in the attribute naming: the model that defines the
<code class="docutils literal"><span class="pre">ManyToManyField</span></code> uses the attribute name of that field itself, whereas the
“reverse” model uses the lowercased model name of the original model, plus
<code class="docutils literal"><span class="pre">'_set'</span></code> (just like reverse one-to-many relationships).</p>
<p>An example makes this concept easier to understand:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">e</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># Returns all Author objects for this Entry.</span>
<span class="n">e</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">e</span><span class="o">.</span><span class="n">authors</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">name__contains</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">Author</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">a</span><span class="o">.</span><span class="n">entry_set</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="c1"># Returns all Entry objects for this Author.</span>
</pre></div>
</div>
<p>Like <code class="docutils literal"><span class="pre">ForeignKey</span></code>, <code class="docutils literal"><span class="pre">ManyToManyField</span></code> can specify <code class="docutils literal"><span class="pre">related_name</span></code>. In the
preceding example, if the <code class="docutils literal"><span class="pre">ManyToManyField</span></code> in <code class="docutils literal"><span class="pre">Entry</span></code> had specified
<code class="docutils literal"><span class="pre">related_name='entries'</span></code>, then each <code class="docutils literal"><span class="pre">Author</span></code> instance would have an
<code class="docutils literal"><span class="pre">entries</span></code> attribute instead of <code class="docutils literal"><span class="pre">entry_set</span></code>.</p>
<div class="admonition-how-are-the-backward-relationships-possible admonition">
<p class="first admonition-title">How Are the Backward Relationships Possible?</p>
<p>Other object-relational mappers require you to define relationships on both
sides. The Django developers believe this is a violation of the DRY (Don’t
Repeat Yourself) principle, so Django requires you to define the
relationship on only one end. But how is this possible, given that a model
class doesn’t know which other model classes are related to it until those
other model classes are loaded?</p>
<p class="last">The answer lies in the <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting. The first time any model
is loaded, Django iterates over every model in <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> and
creates the backward relationships in memory as needed. Essentially, one of
the functions of <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> is to tell Django the entire model
domain.</p>
</div>
</div>
<div class="section" id="queries-over-related-objects">
<h3>Queries Over Related Objects<a class="headerlink" href="#queries-over-related-objects" title="Permalink to this headline">¶</a></h3>
<p>Queries involving related objects follow the same rules as queries involving
normal value fields. When specifying the value for a query to match, you
may use either an object instance itself or the primary key value for the
object.</p>
<p>For example, if you have a <code class="docutils literal"><span class="pre">Blog</span></code> object <code class="docutils literal"><span class="pre">b</span></code> with <code class="docutils literal"><span class="pre">id=5</span></code>, the following
three queries would be identical:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">b</span><span class="p">)</span> <span class="c1"># Query using object instance</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="n">b</span><span class="o">.</span><span class="n">id</span><span class="p">)</span> <span class="c1"># Query using id from instance</span>
<span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">blog</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span> <span class="c1"># Query using id directly</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="deleting-objects">
<h2>Deleting Objects<a class="headerlink" href="#deleting-objects" title="Permalink to this headline">¶</a></h2>
<p>The delete method, conveniently, is named <code class="docutils literal"><span class="pre">delete()</span></code>. This method immediately
deletes the object and has no return value:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">e</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>You can also delete objects in bulk. Every <code class="docutils literal"><span class="pre">QuerySet</span></code> has a <code class="docutils literal"><span class="pre">delete()</span></code>
method, which deletes all members of that <code class="docutils literal"><span class="pre">QuerySet</span></code>. For example, this
deletes all <code class="docutils literal"><span class="pre">Entry</span></code> objects with a <code class="docutils literal"><span class="pre">pub_date</span></code> year of 2005:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pub_date__year</span><span class="o">=</span><span class="mi">2005</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>When Django deletes an object, it emulates the behavior of the SQL
constraint <code class="docutils literal"><span class="pre">ON</span> <span class="pre">DELETE</span> <span class="pre">CASCADE</span></code> – in other words, any objects that
had foreign keys pointing at the object to be deleted will be deleted
along with it, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">Blog</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># This will delete the Blog and all of its Entry objects.</span>
<span class="n">b</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">delete()</span></code> is the only <code class="docutils literal"><span class="pre">QuerySet</span></code> method that is not exposed on a
<code class="docutils literal"><span class="pre">Manager</span></code> itself. This is a safety mechanism to prevent you from accidentally
requesting <code class="docutils literal"><span class="pre">Entry.objects.delete()</span></code> and deleting <em>all</em> the entries. If you
<em>do</em> want to delete all the objects, then you have to explicitly request a
complete query set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="shortcuts">
<h2>Shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h2>
<p>As you develop views, you will discover a number of common idioms in the
way you use the database API. Django encodes some of these idioms as
shortcuts that can be used to simplify the process of writing views. These
functions are in the <code class="docutils literal"><span class="pre">django.shortcuts</span></code> module.</p>
<div class="section" id="get-object-or-404">
<h3>get_object_or_404()<a class="headerlink" href="#get-object-or-404" title="Permalink to this headline">¶</a></h3>
<p>One common idiom to use <code class="docutils literal"><span class="pre">get()</span></code> and raise <code class="docutils literal"><span class="pre">Http404</span></code> if the
object doesn’t exist. This idiom is captured by <code class="docutils literal"><span class="pre">get_object_or_404()</span></code>.
This function takes a Django model as its first argument and an
arbitrary number of keyword arguments, which it passes to the default
manager’s <code class="docutils literal"><span class="pre">get()</span></code> function. It raises <code class="docutils literal"><span class="pre">Http404</span></code> if the object doesn’t
exist, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Get the Entry with a primary key of 3</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Entry</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<p>When you provide a model to this shortcut function, the default manager
is used to execute the underlying <code class="docutils literal"><span class="pre">get()</span></code> query. If you don’t want to
use the default manager, or if you want to search a list of related objects,
you can provide <code class="docutils literal"><span class="pre">get_object_or_404()</span></code> with a <code class="docutils literal"><span class="pre">Manager</span></code> object instead:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># Get the author of blog instance e with a name of &#39;Fred&#39;</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">authors</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Fred&#39;</span><span class="p">)</span>

<span class="c1"># Use a custom manager &#39;recent_entries&#39; in the search for an</span>
<span class="c1"># entry with a primary key of 3</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">Entry</span><span class="o">.</span><span class="n">recent_entries</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="get-list-or-404">
<h3>get_list_or_404()<a class="headerlink" href="#get-list-or-404" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">get_list_or_404</span></code> behaves the same way as <code class="docutils literal"><span class="pre">get_object_or_404()</span></code>,
except that it uses <code class="docutils literal"><span class="pre">filter()</span></code> instead of <code class="docutils literal"><span class="pre">get()</span></code>. It raises
<code class="docutils literal"><span class="pre">Http404</span></code> if the list is empty.</p>
</div>
</div>
<div class="section" id="falling-back-to-raw-sql">
<h2>Falling Back to Raw SQL<a class="headerlink" href="#falling-back-to-raw-sql" title="Permalink to this headline">¶</a></h2>
<p>If you find yourself needing to write an SQL query that is too complex for
Django’s database mapper to handle, you can fall back into raw SQL statement
mode.</p>
<p>The preferred way to do this is by giving your model custom methods or custom
manager methods that execute queries. Although there’s nothing in Django that
<em>requires</em> database queries to live in the model layer, this approach keeps all
your data access logic in one place, which is smart from a code organization
standpoint. For instructions, see Appendix A.</p>
<p>Finally, it’s important to note that the Django database layer is merely an
interface to your database. You can access your database via other tools,
programming languages, or database frameworks – there’s nothing Django-specific
about your database.</p>
</div>
</div>
</div>

          </div>
        </div>
      </div>
      <div id="ft">
        
<div class="nav">
    
        <a href='appendixA.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='appendixC.html'>next &raquo;</a>
    
</div>

        Copyright Adrian Holovaty, Jacob Kaplan-Moss, et al.<br>This
        work is licensed under the <a href="license.html">GNU Free Document
        License</a>.
      </div>
    </div>
  
  </body>
</html>