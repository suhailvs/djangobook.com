<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Chapter 13: Generating Non-HTML Content</title>
    <link rel="stylesheet" href="_static/reset-min.css" type="text/css">
    <link rel="stylesheet" href="_static/grids-min.css" type="text/css">
    <link rel="stylesheet" href="_static/djangobook.css" type="text/css">
    
  </head>
  <body>
    <div id="doc" class="yui-t7">
      <div id="hd">
        <h1><a href="index.html">The Django Book</a></h1>
        <div id="global-nav">
            <a class="about" href="frontmatter.html">About</a>
        </div>
        
<div class="nav">
    
        <a href='chapter12.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter14.html'>next &raquo;</a>
    
</div>

      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            
  <div id="chapter-body"><div class="section" id="chapter-13-generating-non-html-content">
<h1>Chapter 13: Generating Non-HTML Content<a class="headerlink" href="#chapter-13-generating-non-html-content" title="Permalink to this headline">¶</a></h1>
<p>Usually when we talk about developing Web sites, we’re talking about producing
HTML. Of course, there’s a lot more to the Web than HTML; we use the Web
to distribute data in all sorts of formats: RSS, PDFs, images, and so forth.</p>
<p>So far, we’ve focused on the common case of HTML production, but in this chapter
we’ll take a detour and look at using Django to produce other types of content.</p>
<p>Django has convenient built-in tools that you can use to produce some common
non-HTML content:</p>
<ul class="simple">
<li>RSS/Atom syndication feeds</li>
<li>Sitemaps (an XML format originally developed by Google that gives hints to
search engines)</li>
</ul>
<p>We’ll examine each of those tools a little later, but first we’ll cover the
basic principles.</p>
<div class="section" id="the-basics-views-and-mime-types">
<h2>The basics: views and MIME-types<a class="headerlink" href="#the-basics-views-and-mime-types" title="Permalink to this headline">¶</a></h2>
<p>Recall from Chapter 3 that a view function is simply a Python function that
takes a Web request and returns a Web response. This response can be the HTML
contents of a Web page, or a redirect, or a 404 error, or an XML document,
or an image…or anything, really.</p>
<p>More formally, a Django view function <em>must</em></p>
<ul class="simple">
<li>Accept an <code class="docutils literal"><span class="pre">HttpRequest</span></code> instance as its first argument</li>
<li>Return an <code class="docutils literal"><span class="pre">HttpResponse</span></code> instance</li>
</ul>
<p>The key to returning non-HTML content from a view lies in the <code class="docutils literal"><span class="pre">HttpResponse</span></code>
class, specifically the <code class="docutils literal"><span class="pre">mimetype</span></code> argument. By tweaking the MIME type, we
can indicate to the browser that we’ve returned a response of a different
format.</p>
<p>For example, let’s look at a view that returns a PNG image. To
keep things simple, we’ll just read the file off the disk:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">my_image</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">image_data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/path/to/my/image.png&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">image_data</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>That’s it! If you replace the image path in the <code class="docutils literal"><span class="pre">open()</span></code> call with a path to
a real image, you can use this very simple view to serve an image, and the
browser will display it correctly.</p>
<p>The other important thing to keep in mind is that <code class="docutils literal"><span class="pre">HttpResponse</span></code> objects
implement Python’s standard “file-like object” API. This means that you can use
an <code class="docutils literal"><span class="pre">HttpResponse</span></code> instance in any place Python (or a third-party library)
expects a file.</p>
<p>For an example of how that works, let’s take a look at producing CSV with
Django.</p>
</div>
<div class="section" id="producing-csv">
<h2>Producing CSV<a class="headerlink" href="#producing-csv" title="Permalink to this headline">¶</a></h2>
<p>CSV is a simple data format usually used by spreadsheet software. It’s basically
a series of table rows, with each cell in the row separated by a comma (CSV
stands for <em>comma-separated values</em>). For example, here’s some data on “unruly”
airline passengers in CSV format:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Year</span><span class="p">,</span><span class="n">Unruly</span> <span class="n">Airline</span> <span class="n">Passengers</span>
<span class="mi">1995</span><span class="p">,</span><span class="mi">146</span>
<span class="mi">1996</span><span class="p">,</span><span class="mi">184</span>
<span class="mi">1997</span><span class="p">,</span><span class="mi">235</span>
<span class="mi">1998</span><span class="p">,</span><span class="mi">200</span>
<span class="mi">1999</span><span class="p">,</span><span class="mi">226</span>
<span class="mi">2000</span><span class="p">,</span><span class="mi">251</span>
<span class="mi">2001</span><span class="p">,</span><span class="mi">299</span>
<span class="mi">2002</span><span class="p">,</span><span class="mi">273</span>
<span class="mi">2003</span><span class="p">,</span><span class="mi">281</span>
<span class="mi">2004</span><span class="p">,</span><span class="mi">304</span>
<span class="mi">2005</span><span class="p">,</span><span class="mi">203</span>
<span class="mi">2006</span><span class="p">,</span><span class="mi">134</span>
<span class="mi">2007</span><span class="p">,</span><span class="mi">147</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The preceding listing contains real numbers! They come from the U.S.
Federal Aviation Administration.</p>
</div>
<p>Though CSV looks simple, its formatting details haven’t been universally agreed
upon. Different pieces of software produce and consume different variants of
CSV, making it a bit tricky to use. Luckily, Python comes with a standard CSV
library, <code class="docutils literal"><span class="pre">csv</span></code>, that is pretty much bulletproof.</p>
<p>Because the <code class="docutils literal"><span class="pre">csv</span></code> module operates on file-like objects, it’s a snap to use
an <code class="docutils literal"><span class="pre">HttpResponse</span></code> instead:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">csv</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>

<span class="c1"># Number of unruly passengers each year 1995 - 2005. In a real application</span>
<span class="c1"># this would likely come from a database or some other back-end data store.</span>
<span class="n">UNRULY_PASSENGERS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">146</span><span class="p">,</span><span class="mi">184</span><span class="p">,</span><span class="mi">235</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">226</span><span class="p">,</span><span class="mi">251</span><span class="p">,</span><span class="mi">299</span><span class="p">,</span><span class="mi">273</span><span class="p">,</span><span class="mi">281</span><span class="p">,</span><span class="mi">304</span><span class="p">,</span><span class="mi">203</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">unruly_passengers_csv</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Create the HttpResponse object with the appropriate CSV header.</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;text/csv&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=unruly.csv&#39;</span>

    <span class="c1"># Create the CSV writer using the HttpResponse as the &quot;file.&quot;</span>
    <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
    <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="s1">&#39;Unruly Airline Passengers&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">2006</span><span class="p">),</span> <span class="n">UNRULY_PASSENGERS</span><span class="p">):</span>
        <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="n">year</span><span class="p">,</span> <span class="n">num</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>The code and comments should be pretty clear, but a few things deserve special
mention:</p>
<ul>
<li><p class="first">The response is given the <code class="docutils literal"><span class="pre">text/csv</span></code> MIME type (instead of the default
<code class="docutils literal"><span class="pre">text/html</span></code>). This tells browsers that the document is a CSV file.</p>
</li>
<li><p class="first">The response gets an additional <code class="docutils literal"><span class="pre">Content-Disposition</span></code> header, which
contains the name of the CSV file. This header (well, the “attachment”
part) will instruct the browser to prompt for a location to save the
file instead of just displaying it. This file name is arbitrary; call
it whatever you want. It will be used by browsers in the “Save As”
dialog.</p>
<p>To assign a header on an <code class="docutils literal"><span class="pre">HttpResponse</span></code>, just treat the
<code class="docutils literal"><span class="pre">HttpResponse</span></code> as a dictionary and set a key/value.</p>
</li>
<li><p class="first">Hooking into the CSV-generation API is easy: just pass <code class="docutils literal"><span class="pre">response</span></code> as
the first argument to <code class="docutils literal"><span class="pre">csv.writer</span></code>. The <code class="docutils literal"><span class="pre">csv.writer</span></code> function
expects a file-like object, and <code class="docutils literal"><span class="pre">HttpResponse</span></code> objects fit the bill.</p>
</li>
<li><p class="first">For each row in your CSV file, call <code class="docutils literal"><span class="pre">writer.writerow</span></code>, passing it an
iterable object such as a list or tuple.</p>
</li>
<li><p class="first">The CSV module takes care of quoting for you, so you don’t have to worry
about escaping strings with quotes or commas in them. Just pass
information to <code class="docutils literal"><span class="pre">writerow()</span></code>, and it will do the right thing.</p>
</li>
</ul>
<p>This is the general pattern you’ll use any time you need to return non-HTML
content: create an <code class="docutils literal"><span class="pre">HttpResponse</span></code> response object (with a special MIME type),
pass it to something expecting a file, and then return the response.</p>
<p>Let’s look at a few more examples.</p>
</div>
<div class="section" id="generating-pdfs">
<h2>Generating PDFs<a class="headerlink" href="#generating-pdfs" title="Permalink to this headline">¶</a></h2>
<p>Portable Document Format (PDF) is a format developed by Adobe that’s used to
represent printable documents, complete with pixel-perfect formatting,
embedded fonts, and 2D vector graphics. You can think of a PDF document as the
digital equivalent of a printed document; indeed, PDFs are often used in
distributing documents for the purpose of printing them.</p>
<p>You can easily generate PDFs with Python and Django thanks to the excellent
open source ReportLab library (<a class="reference external" href="http://www.reportlab.org/rl_toolkit.html">http://www.reportlab.org/rl_toolkit.html</a>).
The advantage of generating PDF files dynamically is that you can create
customized PDFs for different purposes – say, for different users or
different pieces of content.</p>
<p>For example, your humble authors used Django and ReportLab at KUSports.com to
generate customized, printer-ready NCAA tournament brackets.</p>
<div class="section" id="installing-reportlab">
<h3>Installing ReportLab<a class="headerlink" href="#installing-reportlab" title="Permalink to this headline">¶</a></h3>
<p>Before you do any PDF generation, however, you’ll need to install ReportLab.
It’s usually simple: just download and install the library from
<a class="reference external" href="http://www.reportlab.org/downloads.html">http://www.reportlab.org/downloads.html</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If you’re using a modern Linux distribution, you might want to check your
package management utility before installing ReportLab. Most
package repositories have added ReportLab.</p>
<p class="last">For example, if you’re using Ubuntu, a simple
<code class="docutils literal"><span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">python-reportlab</span></code> will do the trick nicely.</p>
</div>
<p>The user guide (naturally available only as a PDF file) at
<a class="reference external" href="http://www.reportlab.org/rsrc/userguide.pdf">http://www.reportlab.org/rsrc/userguide.pdf</a> has additional installation
instructions.</p>
<p>Test your installation by importing it in the Python interactive interpreter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">reportlab</span>
</pre></div>
</div>
<p>If that command doesn’t raise any errors, the installation worked.</p>
</div>
<div class="section" id="writing-your-view">
<h3>Writing Your View<a class="headerlink" href="#writing-your-view" title="Permalink to this headline">¶</a></h3>
<p>Like CSV, generating PDFs dynamically with Django is easy because the ReportLab
API acts on file-like objects.</p>
<p>Here’s a “Hello World” example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">reportlab.pdfgen</span> <span class="k">import</span> <span class="n">canvas</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">hello_pdf</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Create the HttpResponse object with the appropriate PDF headers.</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=hello.pdf&#39;</span>

    <span class="c1"># Create the PDF object, using the response object as its &quot;file.&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="c1"># Draw things on the PDF. Here&#39;s where the PDF generation happens.</span>
    <span class="c1"># See the ReportLab documentation for the full list of functionality.</span>
    <span class="n">p</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Hello world.&quot;</span><span class="p">)</span>

    <span class="c1"># Close the PDF object cleanly, and we&#39;re done.</span>
    <span class="n">p</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
<p>A few notes are in order:</p>
<ul class="simple">
<li>Here we use the <code class="docutils literal"><span class="pre">application/pdf</span></code> MIME type. This tells browsers that
the document is a PDF file, rather than an HTML file. If you leave off
this information, browsers will probably interpret the response as HTML,
which will result in scary gobbledygook in the browser window.</li>
<li>Hooking into the ReportLab API is easy: just pass <code class="docutils literal"><span class="pre">response</span></code> as the
first argument to <code class="docutils literal"><span class="pre">canvas.Canvas</span></code>. The <code class="docutils literal"><span class="pre">Canvas</span></code> class expects a
file-like object, and <code class="docutils literal"><span class="pre">HttpResponse</span></code> objects fit the bill.</li>
<li>All subsequent PDF-generation methods are called on the PDF
object (in this case, <code class="docutils literal"><span class="pre">p</span></code>), not on <code class="docutils literal"><span class="pre">response</span></code>.</li>
<li>Finally, it’s important to call <code class="docutils literal"><span class="pre">showPage()</span></code> and <code class="docutils literal"><span class="pre">save()</span></code> on the PDF
file – or else, you’ll end up with a corrupted PDF file.</li>
</ul>
</div>
<div class="section" id="complex-pdfs">
<h3>Complex PDFs<a class="headerlink" href="#complex-pdfs" title="Permalink to this headline">¶</a></h3>
<p>If you’re creating a complex PDF document (or any large data blob), consider
using the <code class="docutils literal"><span class="pre">cStringIO</span></code> library as a temporary holding place for your PDF
file. The <code class="docutils literal"><span class="pre">cStringIO</span></code> library provides a file-like object interface that is
written in C for maximum efficiency.</p>
<p>Here’s the previous “Hello World” example rewritten to use <code class="docutils literal"><span class="pre">cStringIO</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">cStringIO</span> <span class="k">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">reportlab.pdfgen</span> <span class="k">import</span> <span class="n">canvas</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">hello_pdf</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Create the HttpResponse object with the appropriate PDF headers.</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">mimetype</span><span class="o">=</span><span class="s1">&#39;application/pdf&#39;</span><span class="p">)</span>
    <span class="n">response</span><span class="p">[</span><span class="s1">&#39;Content-Disposition&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;attachment; filename=hello.pdf&#39;</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>

    <span class="c1"># Create the PDF object, using the StringIO object as its &quot;file.&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">canvas</span><span class="o">.</span><span class="n">Canvas</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span>

    <span class="c1"># Draw things on the PDF. Here&#39;s where the PDF generation happens.</span>
    <span class="c1"># See the ReportLab documentation for the full list of functionality.</span>
    <span class="n">p</span><span class="o">.</span><span class="n">drawString</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;Hello world.&quot;</span><span class="p">)</span>

    <span class="c1"># Close the PDF object cleanly.</span>
    <span class="n">p</span><span class="o">.</span><span class="n">showPage</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>

    <span class="c1"># Get the value of the StringIO buffer and write it to the response.</span>
    <span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">getvalue</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">response</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="other-possibilities">
<h2>Other Possibilities<a class="headerlink" href="#other-possibilities" title="Permalink to this headline">¶</a></h2>
<p>There’s a whole host of other types of content you can generate in Python.
Here are a few more ideas and some pointers to libraries you could use to
implement them:</p>
<ul class="simple">
<li><em>ZIP files</em>: Python’s standard library ships with the
<code class="docutils literal"><span class="pre">zipfile</span></code> module, which can both read and write compressed ZIP files.
You could use it to provide on-demand archives of a bunch of files, or
perhaps compress large documents when requested. You could similarly
produce TAR files using the standard library’s <code class="docutils literal"><span class="pre">tarfile</span></code> module.</li>
<li><em>Dynamic images</em>: The Python Imaging Library
(PIL; <a class="reference external" href="http://www.pythonware.com/products/pil/">http://www.pythonware.com/products/pil/</a>) is a fantastic toolkit for
producing images (PNG, JPEG, GIF, and a whole lot more). You could use
it to automatically scale down images into thumbnails, composite
multiple images into a single frame, or even do Web-based image
processing.</li>
<li><em>Plots and charts</em>: There are a number of powerful Python plotting and
charting libraries you could use to produce on-demand maps, charts,
plots, and graphs. We can’t possibly list them all, so here are
a couple of the highlights:</li>
<li><code class="docutils literal"><span class="pre">matplotlib</span></code> (<a class="reference external" href="http://matplotlib.sourceforge.net/">http://matplotlib.sourceforge.net/</a>) can be
used to produce the type of high-quality plots usually generated
with MatLab or Mathematica.</li>
<li><code class="docutils literal"><span class="pre">pygraphviz</span></code> (<a class="reference external" href="http://networkx.lanl.gov/pygraphviz/">http://networkx.lanl.gov/pygraphviz/</a>), an
interface to the Graphviz graph layout toolkit
(<a class="reference external" href="http://graphviz.org/">http://graphviz.org/</a>), can be used for generating structured diagrams of
graphs and networks.</li>
</ul>
<p>In general, any Python library capable of writing to a file can be hooked into
Django. The possibilities are immense.</p>
<p>Now that we’ve looked at the basics of generating non-HTML content, let’s step
up a level of abstraction. Django ships with some pretty nifty built-in tools
for generating some common types of non-HTML content.</p>
</div>
<div class="section" id="the-syndication-feed-framework">
<h2>The Syndication Feed Framework<a class="headerlink" href="#the-syndication-feed-framework" title="Permalink to this headline">¶</a></h2>
<p>Django comes with a high-level syndication-feed-generating framework that
makes creating RSS and Atom feeds easy.</p>
<div class="admonition-what-s-rss-what-s-atom admonition">
<p class="first admonition-title">What’s RSS? What’s Atom?</p>
<p class="last">RSS and Atom are both XML-based formats you can use to provide
automatically updating “feeds” of your site’s content. Read more about RSS
at <a class="reference external" href="http://www.whatisrss.com/">http://www.whatisrss.com/</a>, and get information on Atom at
<a class="reference external" href="http://www.atomenabled.org/">http://www.atomenabled.org/</a>.</p>
</div>
<p>To create any syndication feed, all you have to do is write a short Python
class. You can create as many feeds as you want.</p>
<p>The high-level feed-generating framework is a view that’s hooked to <code class="docutils literal"><span class="pre">/feeds/</span></code>
by convention. Django uses the remainder of the URL (everything after
<code class="docutils literal"><span class="pre">/feeds/</span></code>) to determine which feed to return.</p>
<p>To create a feed, you’ll write a <code class="docutils literal"><span class="pre">Feed</span></code> class and point to it in your
URLconf.</p>
<div class="section" id="initialization">
<h3>Initialization<a class="headerlink" href="#initialization" title="Permalink to this headline">¶</a></h3>
<p>To activate syndication feeds on your Django site, add this URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^feeds/(?P&lt;url&gt;.*)/$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.syndication.views.feed&#39;</span><span class="p">,</span>
    <span class="p">{</span><span class="s1">&#39;feed_dict&#39;</span><span class="p">:</span> <span class="n">feeds</span><span class="p">}</span>
<span class="p">),</span>
</pre></div>
</div>
<p>This line tells Django to use the RSS framework to handle all URLs starting with
<code class="docutils literal"><span class="pre">&quot;feeds/&quot;</span></code>. (You can change that <code class="docutils literal"><span class="pre">&quot;feeds/&quot;</span></code> prefix to fit your own needs.)</p>
<p>This URLconf line has an extra argument: <code class="docutils literal"><span class="pre">{'feed_dict':</span> <span class="pre">feeds}</span></code>. Use this
extra argument to pass the syndication framework the feeds that should be
published under that URL.</p>
<p>Specifically, <code class="docutils literal"><span class="pre">feed_dict</span></code> should be a dictionary that maps a feed’s slug
(short URL label) to its <code class="docutils literal"><span class="pre">Feed</span></code> class. You can define the <code class="docutils literal"><span class="pre">feed_dict</span></code>
in the URLconf itself. Here’s a full example URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mysite.feeds</span> <span class="k">import</span> <span class="n">LatestEntries</span><span class="p">,</span> <span class="n">LatestEntriesByCategory</span>

<span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;latest&#39;</span><span class="p">:</span> <span class="n">LatestEntries</span><span class="p">,</span>
    <span class="s1">&#39;categories&#39;</span><span class="p">:</span> <span class="n">LatestEntriesByCategory</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^feeds/(?P&lt;url&gt;.*)/$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.syndication.views.feed&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;feed_dict&#39;</span><span class="p">:</span> <span class="n">feeds</span><span class="p">}),</span>
    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The preceding example registers two feeds:</p>
<ul class="simple">
<li>The feed represented by <code class="docutils literal"><span class="pre">LatestEntries</span></code> will live at
<code class="docutils literal"><span class="pre">feeds/latest/</span></code>.</li>
<li>The feed represented by <code class="docutils literal"><span class="pre">LatestEntriesByCategory</span></code> will live at
<code class="docutils literal"><span class="pre">feeds/categories/</span></code>.</li>
</ul>
<p>Once that’s set up, you’ll need to define the <code class="docutils literal"><span class="pre">Feed</span></code> classes themselves.</p>
<p>A <code class="docutils literal"><span class="pre">Feed</span></code> class is a simple Python class that represents a syndication feed.
A feed can be simple (e.g., a “site news” feed, or a basic feed displaying the
latest entries of a blog) or more complex (e.g., a feed displaying all the
blog entries in a particular category, where the category is variable).</p>
<p><code class="docutils literal"><span class="pre">Feed</span></code> classes must subclass <code class="docutils literal"><span class="pre">django.contrib.syndication.feeds.Feed</span></code>. They
can live anywhere in your code tree.</p>
</div>
<div class="section" id="a-simple-feed">
<h3>A Simple Feed<a class="headerlink" href="#a-simple-feed" title="Permalink to this headline">¶</a></h3>
<p>This simple example describes a feed of the latest five blog entries for a
given blog:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.syndication.feeds</span> <span class="k">import</span> <span class="n">Feed</span>
<span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="k">class</span> <span class="nc">LatestEntries</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My Blog&quot;</span>
    <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;/archive/&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;The latest news about stuff.&quot;</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
<p>The important things to notice here are as follows:</p>
<ul class="simple">
<li>The class subclasses <code class="docutils literal"><span class="pre">django.contrib.syndication.feeds.Feed</span></code>.</li>
<li><code class="docutils literal"><span class="pre">title</span></code>, <code class="docutils literal"><span class="pre">link</span></code>, and <code class="docutils literal"><span class="pre">description</span></code> correspond to the standard RSS
<code class="docutils literal"><span class="pre">&lt;title&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;link&gt;</span></code>, and <code class="docutils literal"><span class="pre">&lt;description&gt;</span></code> elements, respectively.</li>
<li><code class="docutils literal"><span class="pre">items()</span></code> is simply a method that returns a list of objects that
should be included in the feed as <code class="docutils literal"><span class="pre">&lt;item&gt;</span></code> elements. Although this
example returns <code class="docutils literal"><span class="pre">Entry</span></code> objects using Django’s database API,
<code class="docutils literal"><span class="pre">items()</span></code> doesn’t have to return model instances.</li>
</ul>
<p>There’s just one more step. In an RSS feed, each <code class="docutils literal"><span class="pre">&lt;item&gt;</span></code> has a <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code>,
<code class="docutils literal"><span class="pre">&lt;link&gt;</span></code>, and <code class="docutils literal"><span class="pre">&lt;description&gt;</span></code>. We need to tell the framework what data to
put into those elements.</p>
<ul>
<li><p class="first">To specify the contents of <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code> and <code class="docutils literal"><span class="pre">&lt;description&gt;</span></code>, create
Django templates called <code class="docutils literal"><span class="pre">feeds/latest_title.html</span></code> and
<code class="docutils literal"><span class="pre">feeds/latest_description.html</span></code>, where <code class="docutils literal"><span class="pre">latest</span></code> is the <code class="docutils literal"><span class="pre">slug</span></code>
specified in the URLconf for the given feed. Note that the <code class="docutils literal"><span class="pre">.html</span></code>
extension is required.</p>
<p>The RSS system renders that template for each item, passing it two
template context variables:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">obj</span></code>: The current object (one of whichever objects you
returned in <code class="docutils literal"><span class="pre">items()</span></code>).</li>
<li><code class="docutils literal"><span class="pre">site</span></code>: A <code class="docutils literal"><span class="pre">django.models.core.sites.Site</span></code> object representing the
current site. This is useful for <code class="docutils literal"><span class="pre">{{</span> <span class="pre">site.domain</span> <span class="pre">}}</span></code> or <code class="docutils literal"><span class="pre">{{</span>
<span class="pre">site.name</span> <span class="pre">}}</span></code>.</li>
</ul>
<p>If you don’t create a template for either the title or description, the
framework will use the template <code class="docutils literal"><span class="pre">&quot;{{</span> <span class="pre">obj</span> <span class="pre">}}&quot;</span></code> by default – that is,
the normal string representation of the object. (For model objects, this
will be the <code class="docutils literal"><span class="pre">__unicode__()</span></code> method.</p>
<p>You can also change the names of these two templates by specifying
<code class="docutils literal"><span class="pre">title_template</span></code> and <code class="docutils literal"><span class="pre">description_template</span></code> as attributes of your
<code class="docutils literal"><span class="pre">Feed</span></code> class.</p>
</li>
<li><p class="first">To specify the contents of <code class="docutils literal"><span class="pre">&lt;link&gt;</span></code>, you have two options. For each
item in <code class="docutils literal"><span class="pre">items()</span></code>, Django first tries executing a
<code class="docutils literal"><span class="pre">get_absolute_url()</span></code> method on that object. If that method doesn’t
exist, it tries calling a method <code class="docutils literal"><span class="pre">item_link()</span></code> in the <code class="docutils literal"><span class="pre">Feed</span></code> class,
passing it a single parameter, <code class="docutils literal"><span class="pre">item</span></code>, which is the object itself.</p>
<p>Both <code class="docutils literal"><span class="pre">get_absolute_url()</span></code> and <code class="docutils literal"><span class="pre">item_link()</span></code> should return the item’s
URL as a normal Python string.</p>
</li>
<li><p class="first">For the previous <code class="docutils literal"><span class="pre">LatestEntries</span></code> example, we could have very simple feed
templates. <code class="docutils literal"><span class="pre">latest_title.html</span></code> contains:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">obj</span><span class="o">.</span><span class="n">title</span> <span class="p">}}</span>
</pre></div>
</div>
<p>and <code class="docutils literal"><span class="pre">latest_description.html</span></code> contains:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">{{</span> <span class="n">obj</span><span class="o">.</span><span class="n">description</span> <span class="p">}}</span>
</pre></div>
</div>
<p>It’s almost <em>too</em> easy…</p>
</li>
</ul>
</div>
<div class="section" id="a-more-complex-feed">
<h3>A More Complex Feed<a class="headerlink" href="#a-more-complex-feed" title="Permalink to this headline">¶</a></h3>
<p>The framework also supports more complex feeds, via parameters.</p>
<p>For example, say your blog offers an RSS feed for every distinct “tag” you’ve
used to categorize your entries. It would be silly to create a separate
<code class="docutils literal"><span class="pre">Feed</span></code> class for each tag; that would violate the Don’t Repeat Yourself
(DRY) principle and would couple data to programming logic.</p>
<p>Instead, the syndication framework lets you make generic
feeds that return items based on information in the feed’s URL.</p>
<p>Your tag-specific feeds could use URLs like this:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">http://example.com/feeds/tags/python/</span></code>:
Returns recent entries tagged with “python”</li>
<li><code class="docutils literal"><span class="pre">http://example.com/feeds/tags/cats/</span></code>:
Returns recent entries tagged with “cats”</li>
</ul>
<p>The slug here is <code class="docutils literal"><span class="pre">&quot;tags&quot;</span></code>. The syndication framework sees the extra URL
bits after the slug – <code class="docutils literal"><span class="pre">'python'</span></code> and <code class="docutils literal"><span class="pre">'cats'</span></code> – and gives you a hook
to tell it what those URL bits mean and how they should influence which items
get published in the feed.</p>
<p>An example makes this clear. Here’s the code for these tag-specific feeds:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ObjectDoesNotExist</span>
<span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Entry</span><span class="p">,</span> <span class="n">Tag</span>

<span class="k">class</span> <span class="nc">TagFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_object</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bits</span><span class="p">):</span>
        <span class="c1"># In case of &quot;/feeds/tags/cats/dogs/mice/&quot;, or other such</span>
        <span class="c1"># clutter, check that bits has only one member.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bits</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ObjectDoesNotExist</span>
        <span class="k">return</span> <span class="n">Tag</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tag</span><span class="o">=</span><span class="n">bits</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">title</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;My Blog: Entries tagged with </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span>

    <span class="k">def</span> <span class="nf">link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">get_absolute_url</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">description</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Entries tagged with </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">obj</span><span class="o">.</span><span class="n">tag</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="n">entries</span> <span class="o">=</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">tags__id__exact</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">entries</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span>
</pre></div>
</div>
<p>Here’s the basic algorithm of the RSS framework, given this class and a
request to the URL <code class="docutils literal"><span class="pre">/feeds/tags/python/</span></code>:</p>
<ol class="arabic">
<li><p class="first">The framework gets the URL <code class="docutils literal"><span class="pre">/feeds/tags/python/</span></code> and notices there’s an
extra bit of URL after the slug. It splits that remaining string by the
slash character (<code class="docutils literal"><span class="pre">&quot;/&quot;</span></code>) and calls the <code class="docutils literal"><span class="pre">Feed</span></code> class’s
<code class="docutils literal"><span class="pre">get_object()</span></code> method, passing it the bits.</p>
<p>In this case, bits is <code class="docutils literal"><span class="pre">['python']</span></code>. For a request to
<code class="docutils literal"><span class="pre">/feeds/tags/python/django/</span></code>, bits would be <code class="docutils literal"><span class="pre">['python',</span> <span class="pre">'django']</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">get_object()</span></code> is responsible for retrieving the given <code class="docutils literal"><span class="pre">Tag</span></code> object,
from the given <code class="docutils literal"><span class="pre">bits</span></code>.</p>
<p>In this case, it uses the Django database API to
retrieve the <code class="docutils literal"><span class="pre">Tag</span></code>. Note that <code class="docutils literal"><span class="pre">get_object()</span></code> should raise
<code class="docutils literal"><span class="pre">django.core.exceptions.ObjectDoesNotExist</span></code> if given invalid
parameters. There’s no <code class="docutils literal"><span class="pre">try</span></code>/<code class="docutils literal"><span class="pre">except</span></code> around the
<code class="docutils literal"><span class="pre">Tag.objects.get()</span></code> call, because it’s not necessary. That function
raises <code class="docutils literal"><span class="pre">Tag.DoesNotExist</span></code> on failure, and <code class="docutils literal"><span class="pre">Tag.DoesNotExist</span></code> is a
subclass of <code class="docutils literal"><span class="pre">ObjectDoesNotExist</span></code>. Raising <code class="docutils literal"><span class="pre">ObjectDoesNotExist</span></code> in
<code class="docutils literal"><span class="pre">get_object()</span></code> tells Django to produce a 404 error for that request.</p>
</li>
<li><p class="first">To generate the feed’s <code class="docutils literal"><span class="pre">&lt;title&gt;</span></code>, <code class="docutils literal"><span class="pre">&lt;link&gt;</span></code>, and <code class="docutils literal"><span class="pre">&lt;description&gt;</span></code>,
Django uses the <code class="docutils literal"><span class="pre">title()</span></code>, <code class="docutils literal"><span class="pre">link()</span></code>, and <code class="docutils literal"><span class="pre">description()</span></code> methods.
In the previous example, they were simple string class attributes, but
this example illustrates that they can be either strings <em>or</em> methods.
For each of <code class="docutils literal"><span class="pre">title</span></code>, <code class="docutils literal"><span class="pre">link</span></code>, and <code class="docutils literal"><span class="pre">description</span></code>, Django follows
this algorithm:</p>
<ol class="arabic simple">
<li>It tries to call a method, passing the <code class="docutils literal"><span class="pre">obj</span></code> argument,
where <code class="docutils literal"><span class="pre">obj</span></code> is the object returned by <code class="docutils literal"><span class="pre">get_object()</span></code>.</li>
<li>Failing that, it tries to call a method with no arguments.</li>
<li>Failing that, it uses the class attribute.</li>
</ol>
</li>
<li><p class="first">Finally, note that <code class="docutils literal"><span class="pre">items()</span></code> in this example also takes the <code class="docutils literal"><span class="pre">obj</span></code>
argument. The algorithm for <code class="docutils literal"><span class="pre">items</span></code> is the same as described in the
previous step – first, it tries <code class="docutils literal"><span class="pre">items(obj)</span></code>, then <code class="docutils literal"><span class="pre">items()</span></code>, and then
finally an <code class="docutils literal"><span class="pre">items</span></code> class attribute (which should be a list).</p>
</li>
</ol>
<p>Full documentation of all the methods and attributes of the <code class="docutils literal"><span class="pre">Feed</span></code> classes is
always available from the official Django documentation
(<a class="reference external" href="http://docs.djangoproject.com/en/dev/ref/contrib/syndication/">http://docs.djangoproject.com/en/dev/ref/contrib/syndication/</a>).</p>
</div>
<div class="section" id="specifying-the-type-of-feed">
<h3>Specifying the Type of Feed<a class="headerlink" href="#specifying-the-type-of-feed" title="Permalink to this headline">¶</a></h3>
<p>By default, the syndication framework produces RSS 2.0. To change that,
add a <code class="docutils literal"><span class="pre">feed_type</span></code> attribute to your <code class="docutils literal"><span class="pre">Feed</span></code> class:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.feedgenerator</span> <span class="k">import</span> <span class="n">Atom1Feed</span>

<span class="k">class</span> <span class="nc">MyFeed</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
    <span class="n">feed_type</span> <span class="o">=</span> <span class="n">Atom1Feed</span>
</pre></div>
</div>
<p>Note that you set <code class="docutils literal"><span class="pre">feed_type</span></code> to a class object, not an instance. Currently
available feed types are shown in Table 11-1.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">Table 11-1. Feed Types</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="71%" />
<col width="29%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Feed Class</th>
<th class="head">Format</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">django.utils.feedgenerator.Rss201rev2Feed</span></code></td>
<td>RSS 2.01 (default)</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">django.utils.feedgenerator.RssUserland091Feed</span></code></td>
<td>RSS 0.91</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">django.utils.feedgenerator.Atom1Feed</span></code></td>
<td>Atom 1.0</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="enclosures">
<h3>Enclosures<a class="headerlink" href="#enclosures" title="Permalink to this headline">¶</a></h3>
<p>To specify enclosures (i.e., media resources associated with a feed item such as
MP3 podcast feeds), use the <code class="docutils literal"><span class="pre">item_enclosure_url</span></code>, <code class="docutils literal"><span class="pre">item_enclosure_length</span></code>,
and <code class="docutils literal"><span class="pre">item_enclosure_mime_type</span></code> hooks, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myproject.models</span> <span class="k">import</span> <span class="n">Song</span>

<span class="k">class</span> <span class="nc">MyFeedWithEnclosures</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Example feed with enclosures&quot;</span>
    <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;/feeds/example-with-enclosures/&quot;</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Song</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()[:</span><span class="mi">30</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">item_enclosure_url</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">song_url</span>

    <span class="k">def</span> <span class="nf">item_enclosure_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span><span class="o">.</span><span class="n">song_length</span>

    <span class="n">item_enclosure_mime_type</span> <span class="o">=</span> <span class="s2">&quot;audio/mpeg&quot;</span>
</pre></div>
</div>
<p>This assumes, of course, that you’ve created a <code class="docutils literal"><span class="pre">Song</span></code> object with <code class="docutils literal"><span class="pre">song_url</span></code>
and <code class="docutils literal"><span class="pre">song_length</span></code> (i.e., the size in bytes) fields.</p>
</div>
<div class="section" id="language">
<h3>Language<a class="headerlink" href="#language" title="Permalink to this headline">¶</a></h3>
<p>Feeds created by the syndication framework automatically include the
appropriate <code class="docutils literal"><span class="pre">&lt;language&gt;</span></code> tag (RSS 2.0) or <code class="docutils literal"><span class="pre">xml:lang</span></code> attribute (Atom).
This comes directly from your <code class="docutils literal"><span class="pre">LANGUAGE_CODE</span></code> setting.</p>
</div>
<div class="section" id="urls">
<h3>URLs<a class="headerlink" href="#urls" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal"><span class="pre">link</span></code> method/attribute can return either an absolute URL (e.g.,
<code class="docutils literal"><span class="pre">&quot;/blog/&quot;</span></code>) or a URL with the fully qualified domain and protocol (e.g.,
<code class="docutils literal"><span class="pre">&quot;http://www.example.com/blog/&quot;</span></code>). If <code class="docutils literal"><span class="pre">link</span></code> doesn’t return the domain,
the syndication framework will insert the domain of the current site,
according to your <code class="docutils literal"><span class="pre">SITE_ID</span></code> setting. (See Chapter 16 for more on <code class="docutils literal"><span class="pre">SITE_ID</span></code>
and the sites framework.)</p>
<p>Atom feeds require a <code class="docutils literal"><span class="pre">&lt;link</span> <span class="pre">rel=&quot;self&quot;&gt;</span></code> that defines the feed’s current
location. The syndication framework populates this automatically.</p>
</div>
<div class="section" id="publishing-atom-and-rss-feeds-in-tandem">
<h3>Publishing Atom and RSS Feeds in Tandem<a class="headerlink" href="#publishing-atom-and-rss-feeds-in-tandem" title="Permalink to this headline">¶</a></h3>
<p>Some developers like to make available both Atom <em>and</em> RSS versions of their
feeds. That’s easy to do with Django: just create a subclass of your <code class="docutils literal"><span class="pre">feed</span></code>
class and set the <code class="docutils literal"><span class="pre">feed_type</span></code> to something different. Then update your
URLconf to add the extra versions. Here’s a full example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.syndication.feeds</span> <span class="k">import</span> <span class="n">Feed</span>
<span class="kn">from</span> <span class="nn">django.utils.feedgenerator</span> <span class="k">import</span> <span class="n">Atom1Feed</span>
<span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="k">class</span> <span class="nc">RssLatestEntries</span><span class="p">(</span><span class="n">Feed</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;My Blog&quot;</span>
    <span class="n">link</span> <span class="o">=</span> <span class="s2">&quot;/archive/&quot;</span>
    <span class="n">description</span> <span class="o">=</span> <span class="s2">&quot;The latest news about stuff.&quot;</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-pub_date&#39;</span><span class="p">)[:</span><span class="mi">5</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">AtomLatestEntries</span><span class="p">(</span><span class="n">RssLatestEntries</span><span class="p">):</span>
    <span class="n">feed_type</span> <span class="o">=</span> <span class="n">Atom1Feed</span>
</pre></div>
</div>
<p>And here’s the accompanying URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">myproject.feeds</span> <span class="k">import</span> <span class="n">RssLatestEntries</span><span class="p">,</span> <span class="n">AtomLatestEntries</span>

<span class="n">feeds</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;rss&#39;</span><span class="p">:</span> <span class="n">RssLatestEntries</span><span class="p">,</span>
    <span class="s1">&#39;atom&#39;</span><span class="p">:</span> <span class="n">AtomLatestEntries</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="c1"># ...</span>
    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^feeds/(?P&lt;url&gt;.*)/$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.syndication.views.feed&#39;</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;feed_dict&#39;</span><span class="p">:</span> <span class="n">feeds</span><span class="p">}),</span>
    <span class="c1"># ...</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="the-sitemap-framework">
<h2>The Sitemap Framework<a class="headerlink" href="#the-sitemap-framework" title="Permalink to this headline">¶</a></h2>
<p>A <em>sitemap</em> is an XML file on your Web site that tells search engine indexers
how frequently your pages change and how “important” certain pages are in
relation to other pages on your site. This information helps search engines
index your site.</p>
<p>For example, here’s a piece of the sitemap for Django’s Web site
(<a class="reference external" href="http://www.djangoproject.com/sitemap.xml">http://www.djangoproject.com/sitemap.xml</a>):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;urlset xmlns=&quot;http://www.sitemaps.org/schemas/sitemap/0.9&quot;&gt;
  &lt;url&gt;
    &lt;loc&gt;http://www.djangoproject.com/documentation/&lt;/loc&gt;
    &lt;changefreq&gt;weekly&lt;/changefreq&gt;
    &lt;priority&gt;0.5&lt;/priority&gt;
  &lt;/url&gt;
  &lt;url&gt;
    &lt;loc&gt;http://www.djangoproject.com/documentation/0_90/&lt;/loc&gt;
    &lt;changefreq&gt;never&lt;/changefreq&gt;
    &lt;priority&gt;0.1&lt;/priority&gt;
  &lt;/url&gt;
  ...
&lt;/urlset&gt;
</pre></div>
</div>
<p>For more on sitemaps, see <a class="reference external" href="http://www.sitemaps.org/">http://www.sitemaps.org/</a>.</p>
<p>The Django sitemap framework automates the creation of this XML file by
letting you express this information in Python code. To create a sitemap,
you just need to write a <code class="docutils literal"><span class="pre">Sitemap</span></code> class and point to it in your URLconf.</p>
<div class="section" id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h3>
<p>To install the sitemap application, follow these steps:</p>
<ol class="arabic simple">
<li>Add <code class="docutils literal"><span class="pre">'django.contrib.sitemaps'</span></code> to your <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> setting.</li>
<li>Make sure
<code class="docutils literal"><span class="pre">'django.template.loaders.app_directories.load_template_source'</span></code> is
in your <code class="docutils literal"><span class="pre">TEMPLATE_LOADERS</span></code> setting. It’s in there by default, so
you’ll need to change this only if you’ve changed that setting.</li>
<li>Make sure you’ve installed the sites framework (see Chapter 16).</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The sitemap application doesn’t install any database tables. The only
reason it needs to go into <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code> is so the
<code class="docutils literal"><span class="pre">load_template_source</span></code> template loader can find the default templates.</p>
</div>
</div>
<div class="section" id="id1">
<h3>Initialization<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>To activate sitemap generation on your Django site, add this line to your
URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^sitemap\.xml$&#39;</span><span class="p">,</span> <span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">})</span>
</pre></div>
</div>
<p>This line tells Django to build a sitemap when a client accesses
<code class="docutils literal"><span class="pre">/sitemap.xml</span></code>. Note that the dot character in <code class="docutils literal"><span class="pre">sitemap.xml</span></code> is escaped
with a backslash, because dots have a special meaning in regular expressions.</p>
<p>The name of the sitemap file is not important, but the location is. Search
engines will only index links in your sitemap for the current URL level and
below. For instance, if <code class="docutils literal"><span class="pre">sitemap.xml</span></code> lives in your root directory, it may
reference any URL in your site. However, if your sitemap lives at
<code class="docutils literal"><span class="pre">/content/sitemap.xml</span></code>, it may only reference URLs that begin with
<code class="docutils literal"><span class="pre">/content/</span></code>.</p>
<p>The sitemap view takes an extra, required argument: <code class="docutils literal"><span class="pre">{'sitemaps':</span>
<span class="pre">sitemaps}</span></code>. <code class="docutils literal"><span class="pre">sitemaps</span></code> should be a dictionary that maps a short section
label (e.g., <code class="docutils literal"><span class="pre">blog</span></code> or <code class="docutils literal"><span class="pre">news</span></code>) to its <code class="docutils literal"><span class="pre">Sitemap</span></code> class (e.g.,
<code class="docutils literal"><span class="pre">BlogSitemap</span></code> or <code class="docutils literal"><span class="pre">NewsSitemap</span></code>). It may also map to an <em>instance</em> of a
<code class="docutils literal"><span class="pre">Sitemap</span></code> class (e.g., <code class="docutils literal"><span class="pre">BlogSitemap(some_var)</span></code>).</p>
</div>
<div class="section" id="sitemap-classes">
<h3>Sitemap Classes<a class="headerlink" href="#sitemap-classes" title="Permalink to this headline">¶</a></h3>
<p>A <code class="docutils literal"><span class="pre">Sitemap</span></code> class is a simple Python class that represents a “section” of
entries in your sitemap. For example, one <code class="docutils literal"><span class="pre">Sitemap</span></code> class could represent
all the entries of your weblog, while another could represent all of the
events in your events calendar.</p>
<p>In the simplest case, all these sections get lumped together into one
<code class="docutils literal"><span class="pre">sitemap.xml</span></code>, but it’s also possible to use the framework to generate a
sitemap index that references individual sitemap files, one per section
(as described shortly).</p>
<p><code class="docutils literal"><span class="pre">Sitemap</span></code> classes must subclass <code class="docutils literal"><span class="pre">django.contrib.sitemaps.Sitemap</span></code>. They
can live anywhere in your code tree.</p>
<p>For example, let’s assume you have a blog system, with an <code class="docutils literal"><span class="pre">Entry</span></code> model, and
you want your sitemap to include all the links to your individual blog
entries. Here’s how your <code class="docutils literal"><span class="pre">Sitemap</span></code> class might look:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">Sitemap</span>
<span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="k">class</span> <span class="nc">BlogSitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
    <span class="n">changefreq</span> <span class="o">=</span> <span class="s2">&quot;never&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_draft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lastmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">pub_date</span>
</pre></div>
</div>
<p>Declaring a <code class="docutils literal"><span class="pre">Sitemap</span></code> should look very similar to declaring a <code class="docutils literal"><span class="pre">Feed</span></code>.
That’s by design.</p>
<p>Like <code class="docutils literal"><span class="pre">Feed</span></code> classes, <code class="docutils literal"><span class="pre">Sitemap</span></code> members can be either methods or
attributes. See the steps in the earlier “A Complex Example” section for more
about how this works.</p>
<p>A <code class="docutils literal"><span class="pre">Sitemap</span></code> class can define the following methods/attributes:</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">items</span></code> (<strong>required</strong>): Provides list of objects. The framework
doesn’t care what <em>type</em> of objects they are; all that matters is that
these objects get passed to the <code class="docutils literal"><span class="pre">location()</span></code>, <code class="docutils literal"><span class="pre">lastmod()</span></code>,
<code class="docutils literal"><span class="pre">changefreq()</span></code>, and <code class="docutils literal"><span class="pre">priority()</span></code> methods.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">location</span></code> (optional): Gives the absolute URL for a given object.
Here, “absolute URL” means a URL that doesn’t include the protocol or
domain. Here are some examples:</p>
<ul class="simple">
<li>Good: <code class="docutils literal"><span class="pre">'/foo/bar/'</span></code></li>
<li>Bad: <code class="docutils literal"><span class="pre">'example.com/foo/bar/'</span></code></li>
<li>Bad: <code class="docutils literal"><span class="pre">'http://example.com/foo/bar/'</span></code></li>
</ul>
<p>If <code class="docutils literal"><span class="pre">location</span></code> isn’t provided, the framework will call the
<code class="docutils literal"><span class="pre">get_absolute_url()</span></code> method on each object as returned by
<code class="docutils literal"><span class="pre">items()</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">lastmod</span></code> (optional): The object’s “last modification” date, as a
Python <code class="docutils literal"><span class="pre">datetime</span></code> object.</p>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">changefreq</span></code> (optional): How often the object changes. Possible values
(as given by the Sitemaps specification) are as follows:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">'always'</span></code></li>
<li><code class="docutils literal"><span class="pre">'hourly'</span></code></li>
<li><code class="docutils literal"><span class="pre">'daily'</span></code></li>
<li><code class="docutils literal"><span class="pre">'weekly'</span></code></li>
<li><code class="docutils literal"><span class="pre">'monthly'</span></code></li>
<li><code class="docutils literal"><span class="pre">'yearly'</span></code></li>
<li><code class="docutils literal"><span class="pre">'never'</span></code></li>
</ul>
</li>
<li><p class="first"><code class="docutils literal"><span class="pre">priority</span></code> (optional): A suggested indexing priority between <code class="docutils literal"><span class="pre">0.0</span></code>
and <code class="docutils literal"><span class="pre">1.0</span></code>. The default priority of a page is <code class="docutils literal"><span class="pre">0.5</span></code>; see the
<a class="reference external" href="http://sitemaps.org/">http://sitemaps.org/</a> documentation for more about how <code class="docutils literal"><span class="pre">priority</span></code> works.</p>
</li>
</ul>
</div>
<div class="section" id="shortcuts">
<h3>Shortcuts<a class="headerlink" href="#shortcuts" title="Permalink to this headline">¶</a></h3>
<p>The sitemap framework provides a couple convenience classes for common cases. These
are described in the sections that follow.</p>
<div class="section" id="flatpagesitemap">
<h4>FlatPageSitemap<a class="headerlink" href="#flatpagesitemap" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">django.contrib.sitemaps.FlatPageSitemap</span></code> class looks at all flat pages
defined for the current site and creates an entry in the sitemap. These
entries include only the <code class="docutils literal"><span class="pre">location</span></code> attribute – not <code class="docutils literal"><span class="pre">lastmod</span></code>,
<code class="docutils literal"><span class="pre">changefreq</span></code>, or <code class="docutils literal"><span class="pre">priority</span></code>.</p>
<p>See Chapter 16 for more about flat pages.</p>
</div>
<div class="section" id="genericsitemap">
<h4>GenericSitemap<a class="headerlink" href="#genericsitemap" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">GenericSitemap</span></code> class works with any generic views (see Chapter 11) you
already have.</p>
<p>To use it, create an instance, passing in the same <code class="docutils literal"><span class="pre">info_dict</span></code> you pass to
the generic views. The only requirement is that the dictionary have a
<code class="docutils literal"><span class="pre">queryset</span></code> entry. It may also have a <code class="docutils literal"><span class="pre">date_field</span></code> entry that specifies a
date field for objects retrieved from the <code class="docutils literal"><span class="pre">queryset</span></code>. This will be used for
the <code class="docutils literal"><span class="pre">lastmod</span></code> attribute in the generated sitemap. You may also pass
<code class="docutils literal"><span class="pre">priority</span></code> and <code class="docutils literal"><span class="pre">changefreq</span></code> keyword arguments to the <code class="docutils literal"><span class="pre">GenericSitemap</span></code>
constructor to specify these attributes for all URLs.</p>
<p>Here’s an example of a URLconf using both <code class="docutils literal"><span class="pre">FlatPageSitemap</span></code> and
<code class="docutils literal"><span class="pre">GenericSiteMap</span></code> (with the hypothetical <code class="docutils literal"><span class="pre">Entry</span></code> object from earlier):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">FlatPageSitemap</span><span class="p">,</span> <span class="n">GenericSitemap</span>
<span class="kn">from</span> <span class="nn">mysite.blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;queryset&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="s1">&#39;date_field&#39;</span><span class="p">:</span> <span class="s1">&#39;pub_date&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">sitemaps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;flatpages&#39;</span><span class="p">:</span> <span class="n">FlatPageSitemap</span><span class="p">,</span>
    <span class="s1">&#39;blog&#39;</span><span class="p">:</span> <span class="n">GenericSitemap</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mf">0.6</span><span class="p">),</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="c1"># some generic view using info_dict</span>
    <span class="c1"># ...</span>

    <span class="c1"># the sitemap</span>
    <span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^sitemap\.xml$&#39;</span><span class="p">,</span>
     <span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">,</span>
     <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">})</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="creating-a-sitemap-index">
<h3>Creating a Sitemap Index<a class="headerlink" href="#creating-a-sitemap-index" title="Permalink to this headline">¶</a></h3>
<p>The sitemap framework also has the ability to create a sitemap index that
references individual sitemap files, one per each section defined in your
<code class="docutils literal"><span class="pre">sitemaps</span></code> dictionary. The only differences in usage are as follows:</p>
<ul class="simple">
<li>You use two views in your URLconf:
<code class="docutils literal"><span class="pre">django.contrib.sitemaps.views.index</span></code> and
<code class="docutils literal"><span class="pre">django.contrib.sitemaps.views.sitemap</span></code>.</li>
<li>The <code class="docutils literal"><span class="pre">django.contrib.sitemaps.views.sitemap</span></code> view should take a
<code class="docutils literal"><span class="pre">section</span></code> keyword argument.</li>
</ul>
<p>Here is what the relevant URLconf lines would look like for the previous example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^sitemap.xml$&#39;</span><span class="p">,</span>
 <span class="s1">&#39;django.contrib.sitemaps.views.index&#39;</span><span class="p">,</span>
 <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">}),</span>

<span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^sitemap-(?P&lt;section&gt;.+).xml$&#39;</span><span class="p">,</span>
 <span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">,</span>
 <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">})</span>
</pre></div>
</div>
<p>This will automatically generate a <code class="docutils literal"><span class="pre">sitemap.xml</span></code> file that references both
<code class="docutils literal"><span class="pre">sitemap-flatpages.xml</span></code> and <code class="docutils literal"><span class="pre">sitemap-blog.xml</span></code>. The <code class="docutils literal"><span class="pre">Sitemap</span></code> classes
and the <code class="docutils literal"><span class="pre">sitemaps</span></code> dictionary don’t change at all.</p>
</div>
<div class="section" id="pinging-google">
<h3>Pinging Google<a class="headerlink" href="#pinging-google" title="Permalink to this headline">¶</a></h3>
<p>You may want to “ping” Google when your sitemap changes, to let it know to
reindex your site. The framework provides a function to do just that:
<code class="docutils literal"><span class="pre">django.contrib.sitemaps.ping_google()</span></code>.</p>
<p><code class="docutils literal"><span class="pre">ping_google()</span></code> takes an optional argument, <code class="docutils literal"><span class="pre">sitemap_url</span></code>, which should be
the absolute URL of your site’s sitemap (e.g., <code class="docutils literal"><span class="pre">'/sitemap.xml'</span></code>). If this
argument isn’t provided, <code class="docutils literal"><span class="pre">ping_google()</span></code> will attempt to figure out your
sitemap by performing a reverse lookup on your URLconf.</p>
<p><code class="docutils literal"><span class="pre">ping_google()</span></code> raises the exception
<code class="docutils literal"><span class="pre">django.contrib.sitemaps.SitemapNotFound</span></code> if it cannot determine your
sitemap URL.</p>
<p>One useful way to call <code class="docutils literal"><span class="pre">ping_google()</span></code> is from a model’s <code class="docutils literal"><span class="pre">save()</span></code> method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">ping_google</span>

<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Entry</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ping_google</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Bare &#39;except&#39; because we could get a variety</span>
            <span class="c1"># of HTTP-related exceptions.</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>A more efficient solution, however, would be to call <code class="docutils literal"><span class="pre">ping_google()</span></code> from a
<code class="docutils literal"><span class="pre">cron</span></code> script or some other scheduled task. The function makes an HTTP
request to Google’s servers, so you may not want to introduce that network
overhead each time you call <code class="docutils literal"><span class="pre">save()</span></code>.</p>
<p>Finally, if <code class="docutils literal"><span class="pre">'django.contrib.sitemaps'</span></code> is in your <code class="docutils literal"><span class="pre">INSTALLED_APPS</span></code>, then
your <code class="docutils literal"><span class="pre">manage.py</span></code> will include a new command, <code class="docutils literal"><span class="pre">ping_google</span></code>. This is useful
for command-line access to pinging. For example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">ping_google</span> <span class="o">/</span><span class="n">sitemap</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>Next, we’ll continue to dig deeper into the built-in tools Django gives you.
<a class="reference external" href="chapter14.html">Chapter 14</a> looks at all the tools you need to provide user-customized
sites: sessions, users, and authentication.</p>
</div>
</div>
</div>

          </div>
        </div>
      </div>
      <div id="ft">
        
<div class="nav">
    
        <a href='chapter12.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter14.html'>next &raquo;</a>
    
</div>

        Copyright Adrian Holovaty, Jacob Kaplan-Moss, et al.<br>This
        work is licensed under the <a href="license.html">GNU Free Document
        License</a>.
      </div>
    </div>
  
  </body>
</html>