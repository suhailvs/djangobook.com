<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Appendix G: Request and Response Objects</title>
    <link rel="stylesheet" href="static/reset-min.css" type="text/css">
    <link rel="stylesheet" href="static/grids-min.css" type="text/css">
    <link rel="stylesheet" href="static/djangobook.css" type="text/css">
    
  </head>
  <body>
    <div id="doc" class="yui-t7">
      <div id="hd">
        <h1><a href="index.html">The Django Book</a></h1>
        <div id="global-nav">
            <a class="about" href="frontmatter.html">About</a>
        </div>
        
<div class="nav">
    
        <a href='appendixF.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='license.html'>next &raquo;</a>
    
</div>

      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            
  <div id="chapter-body"><div class="section" id="appendix-g-request-and-response-objects">
<h1>Appendix G: Request and Response Objects<a class="headerlink" href="#appendix-g-request-and-response-objects" title="Permalink to this headline">¶</a></h1>
<p>Django uses request and response objects to pass state through the system.</p>
<p>When a page is requested, Django creates an <code class="docutils literal"><span class="pre">HttpRequest</span></code> object that
contains metadata about the request. Then Django loads the appropriate view,
passing the <code class="docutils literal"><span class="pre">HttpRequest</span></code> as the first argument to the view function. Each
view is responsible for returning an <code class="docutils literal"><span class="pre">HttpResponse</span></code> object.</p>
<p>We’ve used these objects often throughout the book; this appendix explains the
complete APIs for <code class="docutils literal"><span class="pre">HttpRequest</span></code> and <code class="docutils literal"><span class="pre">HttpResponse</span></code> objects.</p>
<div class="section" id="httprequest">
<h2>HttpRequest<a class="headerlink" href="#httprequest" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal"><span class="pre">HttpRequest</span></code> represents a single HTTP request from some user-agent.</p>
<p>Much of the important information about the request is available as attributes
on the <code class="docutils literal"><span class="pre">HttpRequest</span></code> instance (see Table G-1). All attributes except
<code class="docutils literal"><span class="pre">session</span></code> should be considered read-only.</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Table G-1. Attributes of HttpRequest Objects</span><a class="headerlink" href="#id1" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="24%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Attribute</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">path</span></code></td>
<td>A string representing the full path to the requested
page, not including the domain – for example,
<code class="docutils literal"><span class="pre">&quot;/music/bands/the_beatles/&quot;</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">method</span></code></td>
<td><p class="first">A string representing the HTTP method used in the
request. This is guaranteed to be uppercase. For
example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
    <span class="n">do_something</span><span class="p">()</span>
<span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
    <span class="n">do_something_else</span><span class="p">()</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">encoding</span></code></td>
<td><p class="first">A string representing the current encoding used to
decode form submission data (or <code class="docutils literal"><span class="pre">None</span></code>, which means
the <code class="docutils literal"><span class="pre">DEFAULT_CHARSET</span></code> setting is used).</p>
<p class="last">You can write to this attribute to change the encoding
used when accessing the form data. Any subsequent
attribute accesses (such as reading from <code class="docutils literal"><span class="pre">GET</span></code> or
<code class="docutils literal"><span class="pre">POST</span></code>) will use the new <code class="docutils literal"><span class="pre">encoding</span></code> value.  Useful
if you know the form data is not in the
<code class="docutils literal"><span class="pre">DEFAULT_CHARSET</span></code> encoding.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">GET</span></code></td>
<td>A dictionary-like object containing all given HTTP GET
parameters. See the upcoming <code class="docutils literal"><span class="pre">QueryDict</span></code> documentation.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">POST</span></code></td>
<td><p class="first">A dictionary-like object containing all given HTTP POST
parameters. See the upcoming <code class="docutils literal"><span class="pre">QueryDict</span></code> documentation.</p>
<p>It’s possible that a request can come in via POST with
an empty <code class="docutils literal"><span class="pre">POST</span></code> dictionary – if, say, a form is
requested via the POST HTTP method but does not
include form data. Therefore, you shouldn’t use <code class="docutils literal"><span class="pre">if</span>
<span class="pre">request.POST</span></code> to check for use of the POST method;
instead, use <code class="docutils literal"><span class="pre">if</span> <span class="pre">request.method</span> <span class="pre">==</span> <span class="pre">&quot;POST&quot;</span></code> (see
the <code class="docutils literal"><span class="pre">method</span></code> entry in this table).</p>
<p class="last">Note: <code class="docutils literal"><span class="pre">POST</span></code> does <em>not</em> include file-upload
information. See <code class="docutils literal"><span class="pre">FILES</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">REQUEST</span></code></td>
<td><p class="first">For convenience, a dictionary-like object that searches
<code class="docutils literal"><span class="pre">POST</span></code> first, and then <code class="docutils literal"><span class="pre">GET</span></code>. Inspired by PHP’s
<code class="docutils literal"><span class="pre">$_REQUEST</span></code>.</p>
<p>For example, if <code class="docutils literal"><span class="pre">GET</span> <span class="pre">=</span> <span class="pre">{&quot;name&quot;:</span> <span class="pre">&quot;john&quot;}</span></code> and <code class="docutils literal"><span class="pre">POST</span>
<span class="pre">=</span> <span class="pre">{&quot;age&quot;:</span> <span class="pre">'34'}</span></code>, <code class="docutils literal"><span class="pre">REQUEST[&quot;name&quot;]</span></code> would be
<code class="docutils literal"><span class="pre">&quot;john&quot;</span></code>, and <code class="docutils literal"><span class="pre">REQUEST[&quot;age&quot;]</span></code> would be <code class="docutils literal"><span class="pre">&quot;34&quot;</span></code>.</p>
<p class="last">It’s strongly suggested that you use <code class="docutils literal"><span class="pre">GET</span></code> and
<code class="docutils literal"><span class="pre">POST</span></code> instead of <code class="docutils literal"><span class="pre">REQUEST</span></code>, because the former
are more explicit.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">COOKIES</span></code></td>
<td>A standard Python dictionary containing all cookies.
Keys and values are strings. See Chapter 14 for more
on using cookies.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">FILES</span></code></td>
<td>A dictionary-like object that maps filenames to
<code class="docutils literal"><span class="pre">UploadedFile</span></code> objects. See the Django
documentation for more.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">META</span></code></td>
<td><p class="first">A standard Python dictionary containing all available
HTTP headers. Available headers depend on the client
and server, but here are some examples:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">CONTENT_LENGTH</span></code></li>
<li><code class="docutils literal"><span class="pre">CONTENT_TYPE</span></code></li>
<li><code class="docutils literal"><span class="pre">QUERY_STRING</span></code>: The raw unparsed query string</li>
<li><code class="docutils literal"><span class="pre">REMOTE_ADDR</span></code>: The IP address of the client</li>
<li><code class="docutils literal"><span class="pre">REMOTE_HOST</span></code>: The hostname of the client</li>
<li><code class="docutils literal"><span class="pre">SERVER_NAME</span></code>: The hostname of the server.</li>
<li><code class="docutils literal"><span class="pre">SERVER_PORT</span></code>: The port of the server</li>
</ul>
<p>Any HTTP headers are available in <code class="docutils literal"><span class="pre">META</span></code> as keys
prefixed with <code class="docutils literal"><span class="pre">HTTP_</span></code>, converted to uppercase and
substituting underscores for hyphens. For example:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">HTTP_ACCEPT_ENCODING</span></code></li>
<li><code class="docutils literal"><span class="pre">HTTP_ACCEPT_LANGUAGE</span></code></li>
<li><code class="docutils literal"><span class="pre">HTTP_HOST</span></code>: The HTTP <code class="docutils literal"><span class="pre">Host</span></code> header sent by
the client</li>
<li><code class="docutils literal"><span class="pre">HTTP_REFERER</span></code>: The referring page, if any</li>
<li><code class="docutils literal"><span class="pre">HTTP_USER_AGENT</span></code>: The client’s user-agent string</li>
<li><code class="docutils literal"><span class="pre">HTTP_X_BENDER</span></code>: The value of the <code class="docutils literal"><span class="pre">X-Bender</span></code>
header, if set</li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">user</span></code></td>
<td><p class="first">A <code class="docutils literal"><span class="pre">django.contrib.auth.models.User</span></code> object
representing the currently logged-in user. If the user
isn’t currently logged in, <code class="docutils literal"><span class="pre">user</span></code> will be set to an
instance of
<code class="docutils literal"><span class="pre">django.contrib.auth.models.AnonymousUser</span></code>. You can
tell them apart with <code class="docutils literal"><span class="pre">is_authenticated()</span></code>, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
    <span class="c1"># Do something for logged-in users.</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Do something for anonymous users.</span>
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">user</span></code> is available only if your Django installation
has the <code class="docutils literal"><span class="pre">AuthenticationMiddleware</span></code> activated.</p>
<p class="last">For the complete details of authentication and users,
see Chapter 14.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">session</span></code></td>
<td>A readable and writable, dictionary-like object that
represents the current session. This is available only
if your Django installation has session support
activated. See Chapter 14.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">raw_post_data</span></code></td>
<td>The raw HTTP POST data. This is useful for advanced
processing.</td>
</tr>
</tbody>
</table>
<p>Request objects also have a few useful methods, as shown in Table G-2.</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">Table G-2. HttpRequest Methods</span><a class="headerlink" href="#id2" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__getitem__(key)</span></code></td>
<td><p class="first">Returns the GET/POST value for the given key,
checking POST first, and then GET. Raises
<code class="docutils literal"><span class="pre">KeyError</span></code> if the key doesn’t exist.</p>
<p>This lets you use dictionary-accessing syntax on
an <code class="docutils literal"><span class="pre">HttpRequest</span></code> instance.</p>
<p class="last">For example, <code class="docutils literal"><span class="pre">request[&quot;foo&quot;]</span></code> is the same as
checking <code class="docutils literal"><span class="pre">request.POST[&quot;foo&quot;]</span></code> and then
<code class="docutils literal"><span class="pre">request.GET[&quot;foo&quot;]</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">has_key()</span></code></td>
<td>Returns <code class="docutils literal"><span class="pre">True</span></code> or <code class="docutils literal"><span class="pre">False</span></code>, designating whether
<code class="docutils literal"><span class="pre">request.GET</span></code> or <code class="docutils literal"><span class="pre">request.POST</span></code> has the given
key.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">get_host()</span></code></td>
<td>Returns the originating host of the request using
information from the <code class="docutils literal"><span class="pre">HTTP_X_FORWARDED_HOST</span></code> and
<code class="docutils literal"><span class="pre">HTTP_HOST</span></code> headers (in that order). If they
don’t provide a value, the method uses a
combination of <code class="docutils literal"><span class="pre">SERVER_NAME</span></code> and
<code class="docutils literal"><span class="pre">SERVER_PORT</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">get_full_path()</span></code></td>
<td>Returns the <code class="docutils literal"><span class="pre">path</span></code>, plus an appended query
string, if applicable. For example,
<code class="docutils literal"><span class="pre">&quot;/music/bands/the_beatles/?print=true&quot;</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">is_secure()</span></code></td>
<td>Returns <code class="docutils literal"><span class="pre">True</span></code> if the request is secure; that
is, if it was made with HTTPS.</td>
</tr>
</tbody>
</table>
<div class="section" id="querydict-objects">
<h3>QueryDict Objects<a class="headerlink" href="#querydict-objects" title="Permalink to this headline">¶</a></h3>
<p>In an <code class="docutils literal"><span class="pre">HttpRequest</span></code> object, the <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code> attributes are
instances of <code class="docutils literal"><span class="pre">django.http.QueryDict</span></code>. <code class="docutils literal"><span class="pre">QueryDict</span></code> is a dictionary-like
class customized to deal with multiple values for the same key. This is
necessary because some HTML form elements, notably <code class="docutils literal"><span class="pre">&lt;select</span>
<span class="pre">multiple=&quot;multiple&quot;&gt;</span></code>, pass multiple values for the same key.</p>
<p><code class="docutils literal"><span class="pre">QueryDict</span></code> instances are immutable, unless you create a <code class="docutils literal"><span class="pre">copy()</span></code> of them.
That means you can’t change attributes of <code class="docutils literal"><span class="pre">request.POST</span></code> and <code class="docutils literal"><span class="pre">request.GET</span></code>
directly.</p>
<p><code class="docutils literal"><span class="pre">QueryDict</span></code> implements the all standard dictionary methods, because it’s a
subclass of dictionary. Exceptions are outlined in Table G-3.</p>
<table border="1" class="docutils" id="id3">
<caption><span class="caption-text">Table G-3. How QueryDicts Differ from Standard Dictionaries.</span><a class="headerlink" href="#id3" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Differences from Standard dict Implementation</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">__getitem__</span></code></td>
<td>Works just like a dictionary. However, if the key
has more than one value, <code class="docutils literal"><span class="pre">__getitem__()</span></code> returns the
last value.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">__setitem__</span></code></td>
<td>Sets the given key to <code class="docutils literal"><span class="pre">[value]</span></code> (a Python list whose
single element is <code class="docutils literal"><span class="pre">value</span></code>). Note that this, as other
dictionary functions that have side effects, can
be called only on a mutable <code class="docutils literal"><span class="pre">QueryDict</span></code> (one that was
created via <code class="docutils literal"><span class="pre">copy()</span></code>).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">get()</span></code></td>
<td>If the key has more than one value, <code class="docutils literal"><span class="pre">get()</span></code> returns
the last value just like <code class="docutils literal"><span class="pre">__getitem__</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">update()</span></code></td>
<td><p class="first">Takes either a <code class="docutils literal"><span class="pre">QueryDict</span></code> or standard dictionary.
Unlike the standard dictionary’s <code class="docutils literal"><span class="pre">update</span></code> method,
this method <em>appends</em> to the current dictionary items
rather than replacing them:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">QueryDict</span><span class="p">(</span><span class="s1">&#39;a=1&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">q</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># to make it mutable</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;a&#39;</span><span class="p">:</span> <span class="s1">&#39;2&#39;</span><span class="p">})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="go">[&#39;1&#39;, &#39;2&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span> <span class="c1"># returns the last</span>
<span class="go">[&#39;2&#39;]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">items()</span></code></td>
<td><p class="first">Just like the standard dictionary <code class="docutils literal"><span class="pre">items()</span></code> method,
except this uses the same last-value logic as
<code class="docutils literal"><span class="pre">__getitem()__</span></code>:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">QueryDict</span><span class="p">(</span><span class="s1">&#39;a=1&amp;a=2&amp;a=3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;a&#39;, &#39;3&#39;)]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">values()</span></code></td>
<td>Just like the standard dictionary <code class="docutils literal"><span class="pre">values()</span></code> method,
except this uses the same last-value logic as
<code class="docutils literal"><span class="pre">__getitem()__</span></code>.</td>
</tr>
</tbody>
</table>
<p>In addition, <code class="docutils literal"><span class="pre">QueryDict</span></code> has the methods shown in Table G-4.</p>
<table border="1" class="docutils" id="id4">
<caption><span class="caption-text">G-4. Extra (Nondictionary) QueryDict Methods</span><a class="headerlink" href="#id4" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">copy()</span></code></td>
<td>Returns a copy of the object, using
<code class="docutils literal"><span class="pre">copy.deepcopy()</span></code> from the Python standard
library. The copy will be mutable – that is,
you can change its values.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">getlist(key)</span></code></td>
<td>Returns the data with the requested key, as a
Python list. Returns an empty list if the key
doesn’t exist. It’s guaranteed to return a
list of some sort.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">setlist(key,</span> <span class="pre">list_)</span></code></td>
<td>Sets the given key to <code class="docutils literal"><span class="pre">list_</span></code> (unlike
<code class="docutils literal"><span class="pre">__setitem__()</span></code>).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">appendlist(key,</span> <span class="pre">item)</span></code></td>
<td>Appends an item to the internal list associated
with <code class="docutils literal"><span class="pre">key</span></code>.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">setlistdefault(key,</span> <span class="pre">a)</span></code></td>
<td>Just like <code class="docutils literal"><span class="pre">setdefault</span></code>, except it takes a
list of values instead of a single value.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">lists()</span></code></td>
<td><p class="first">Like <code class="docutils literal"><span class="pre">items()</span></code>, except it includes all
values, as a list, for each member of the
dictionary. For example:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">q</span> <span class="o">=</span> <span class="n">QueryDict</span><span class="p">(</span><span class="s1">&#39;a=1&amp;a=2&amp;a=3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">q</span><span class="o">.</span><span class="n">lists</span><span class="p">()</span>
<span class="go">[(&#39;a&#39;, [&#39;1&#39;, &#39;2&#39;, &#39;3&#39;])]</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">urlencode()</span></code></td>
<td>Returns a string of the data in query-string
format (e.g., <code class="docutils literal"><span class="pre">&quot;a=2&amp;b=3&amp;b=5&quot;</span></code>).</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="a-complete-example">
<h3>A Complete Example<a class="headerlink" href="#a-complete-example" title="Permalink to this headline">¶</a></h3>
<p>For example, given this HTML form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/foo/bar/&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;your_name&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;</span><span class="n">select</span> <span class="n">multiple</span><span class="o">=</span><span class="s2">&quot;multiple&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bands&quot;</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;beatles&quot;</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">Beatles</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;who&quot;</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">Who</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">option</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;zombies&quot;</span><span class="o">&gt;</span><span class="n">The</span> <span class="n">Zombies</span><span class="o">&lt;/</span><span class="n">option</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">select</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>if the user enters <code class="docutils literal"><span class="pre">&quot;John</span> <span class="pre">Smith&quot;</span></code> in the <code class="docutils literal"><span class="pre">your_name</span></code> field and selects
both “The Beatles” and “The Zombies” in the multiple select box, here’s what
Django’s request object would have:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">GET</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span>
<span class="go">{&#39;your_name&#39;: [&#39;John Smith&#39;], &#39;bands&#39;: [&#39;beatles&#39;, &#39;zombies&#39;]}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;your_name&#39;</span><span class="p">]</span>
<span class="go">&#39;John Smith&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;bands&#39;</span><span class="p">]</span>
<span class="go">&#39;zombies&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;bands&#39;</span><span class="p">)</span>
<span class="go">[&#39;beatles&#39;, &#39;zombies&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;your_name&#39;</span><span class="p">,</span> <span class="s1">&#39;Adrian&#39;</span><span class="p">)</span>
<span class="go">&#39;John Smith&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;nonexistent_field&#39;</span><span class="p">,</span> <span class="s1">&#39;Nowhere Man&#39;</span><span class="p">)</span>
<span class="go">&#39;Nowhere Man&#39;</span>
</pre></div>
</div>
<div class="admonition-implementation-note admonition">
<p class="first admonition-title">Implementation Note:</p>
<p class="last">The <code class="docutils literal"><span class="pre">GET</span></code>, <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">COOKIES</span></code>, <code class="docutils literal"><span class="pre">FILES</span></code>, <code class="docutils literal"><span class="pre">META</span></code>, <code class="docutils literal"><span class="pre">REQUEST</span></code>,
<code class="docutils literal"><span class="pre">raw_post_data</span></code>, and <code class="docutils literal"><span class="pre">user</span></code> attributes are all lazily loaded. That means
Django doesn’t spend resources calculating the values of those attributes until
your code requests them.</p>
</div>
</div>
</div>
<div class="section" id="httpresponse">
<h2>HttpResponse<a class="headerlink" href="#httpresponse" title="Permalink to this headline">¶</a></h2>
<p>In contrast to <code class="docutils literal"><span class="pre">HttpRequest</span></code> objects, which are created automatically by
Django, <code class="docutils literal"><span class="pre">HttpResponse</span></code> objects are your responsibility. Each view you write
is responsible for instantiating, populating, and returning an
<code class="docutils literal"><span class="pre">HttpResponse</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">HttpResponse</span></code> class lives at <code class="docutils literal"><span class="pre">django.http.HttpResponse</span></code>.</p>
<div class="section" id="construction-httpresponses">
<h3>Construction HttpResponses<a class="headerlink" href="#construction-httpresponses" title="Permalink to this headline">¶</a></h3>
<p>Typically, you’ll construct an <code class="docutils literal"><span class="pre">HttpResponse</span></code> to pass the contents of the
page, as a string, to the <code class="docutils literal"><span class="pre">HttpResponse</span></code> constructor:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Here&#39;s the text of the Web page.&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;Text only, please.&quot;</span><span class="p">,</span> <span class="n">mimetype</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>But if you want to add content incrementally, you can use <code class="docutils literal"><span class="pre">response</span></code> as a
filelike object:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;Here&#39;s the text of the Web page.&lt;/p&gt;&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;Here&#39;s another paragraph.&lt;/p&gt;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You can pass <code class="docutils literal"><span class="pre">HttpResponse</span></code> an iterator rather than passing it
hard-coded strings. If you use this technique, follow these guidelines:</p>
<ul class="simple">
<li>The iterator should return strings.</li>
<li>If an <code class="docutils literal"><span class="pre">HttpResponse</span></code> has been initialized with an iterator as its
content, you can’t use the <code class="docutils literal"><span class="pre">HttpResponse</span></code> instance as a filelike
object. Doing so will raise <code class="docutils literal"><span class="pre">Exception</span></code>.</li>
</ul>
<p>Finally, note that <code class="docutils literal"><span class="pre">HttpResponse</span></code> implements a <code class="docutils literal"><span class="pre">write()</span></code> method, which
makes is suitable for use anywhere that Python expects a filelike object. See
Chapter 8 for some examples of using this technique.</p>
</div>
<div class="section" id="setting-headers">
<h3>Setting Headers<a class="headerlink" href="#setting-headers" title="Permalink to this headline">¶</a></h3>
<p>You can add and delete headers using dictionary syntax:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;X-DJANGO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;It&#39;s the best.&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">response</span><span class="p">[</span><span class="s1">&#39;X-PHP&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">response</span><span class="p">[</span><span class="s1">&#39;X-DJANGO&#39;</span><span class="p">]</span>
<span class="go">&quot;It&#39;s the best.&quot;</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal"><span class="pre">has_header(header)</span></code> to check for the existence of a header.</p>
<p>Avoid setting <code class="docutils literal"><span class="pre">Cookie</span></code> headers by hand; instead, see Chapter 14 for
instructions on how cookies work in Django.</p>
</div>
<div class="section" id="httpresponse-subclasses">
<h3>HttpResponse Subclasses<a class="headerlink" href="#httpresponse-subclasses" title="Permalink to this headline">¶</a></h3>
<p>Django includes a number of <code class="docutils literal"><span class="pre">HttpResponse</span></code> subclasses that handle different
types of HTTP responses (see Table G-5). Like <code class="docutils literal"><span class="pre">HttpResponse</span></code>, these subclasses live in
<code class="docutils literal"><span class="pre">django.http</span></code>.</p>
<table border="1" class="docutils" id="id5">
<caption><span class="caption-text">Table G-5. HttpResponse Subclasses</span><a class="headerlink" href="#id5" title="Permalink to this table">¶</a></caption>
<colgroup>
<col width="46%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Class</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">HttpResponseRedirect</span></code></td>
<td>The constructor takes a single argument:
the path to redirect to. This can
be a fully qualified URL (e.g.,
<code class="docutils literal"><span class="pre">'http://search.yahoo.com/'</span></code>) or
an absolute URL with no domain (e.g.,
<code class="docutils literal"><span class="pre">'/search/'</span></code>). Note that this
returns an HTTP status code 302.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">HttpResponsePermanentRedirect</span></code></td>
<td>Like <code class="docutils literal"><span class="pre">HttpResponseRedirect</span></code>, but it
returns a permanent redirect (HTTP
status code 301) instead of a “found”
redirect (status code 302).</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">HttpResponseNotModified</span></code></td>
<td>The constructor doesn’t take any
arguments. Use this to designate that
a page hasn’t been modified since the
user’s last request.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">HttpResponseBadRequest</span></code></td>
<td>Acts just like <code class="docutils literal"><span class="pre">HttpResponse</span></code> but
uses a 400 status code.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">HttpResponseNotFound</span></code></td>
<td>Acts just like <code class="docutils literal"><span class="pre">HttpResponse</span></code> but
uses a 404 status code.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">HttpResponseForbidden</span></code></td>
<td>Acts just like <code class="docutils literal"><span class="pre">HttpResponse</span></code> but
uses a 403 status code.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">HttpResponseNotAllowed</span></code></td>
<td>Like <code class="docutils literal"><span class="pre">HttpResponse</span></code>, but uses a 405
status code. It takes a single, required
argument: a list of permitted methods
(e.g., <code class="docutils literal"><span class="pre">['GET',</span> <span class="pre">'POST']</span></code>).</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">HttpResponseGone</span></code></td>
<td>Acts just like <code class="docutils literal"><span class="pre">HttpResponse</span></code> but
uses a 410 status code.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">HttpResponseServerError</span></code></td>
<td>Acts just like <code class="docutils literal"><span class="pre">HttpResponse</span></code> but
uses a 500 status code.</td>
</tr>
</tbody>
</table>
<p>You can, of course, define your own <code class="docutils literal"><span class="pre">HttpResponse</span></code> subclass to support
different types of responses not supported out of the box.</p>
</div>
<div class="section" id="returning-errors">
<h3>Returning Errors<a class="headerlink" href="#returning-errors" title="Permalink to this headline">¶</a></h3>
<p>Returning HTTP error codes in Django is easy. We’ve already mentioned the
<code class="docutils literal"><span class="pre">HttpResponseNotFound</span></code>, <code class="docutils literal"><span class="pre">HttpResponseForbidden</span></code>,
<code class="docutils literal"><span class="pre">HttpResponseServerError</span></code>, and other subclasses. Just return an instance of one
of those subclasses instead of a normal <code class="docutils literal"><span class="pre">HttpResponse</span></code> in order to signify
an error, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">if</span> <span class="n">foo</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponseNotFound</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Page not found&lt;/h1&gt;&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Page was found&lt;/h1&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Because a 404 error is by far the most common HTTP error, there’s an easier
way to handle it.</p>
<p>When you return an error such as <code class="docutils literal"><span class="pre">HttpResponseNotFound</span></code>, you’re responsible
for defining the HTML of the resulting error page:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">HttpResponseNotFound</span><span class="p">(</span><span class="s1">&#39;&lt;h1&gt;Page not found&lt;/h1&gt;&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>For convenience, and because it’s a good idea to have a consistent 404 error page
across your site, Django provides an <code class="docutils literal"><span class="pre">Http404</span></code> exception. If you raise
<code class="docutils literal"><span class="pre">Http404</span></code> at any point in a view function, Django will catch it and return the
standard error page for your application, along with an HTTP error code 404.</p>
<p>Here’s an example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">Http404</span>

<span class="k">def</span> <span class="nf">detail</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">poll_id</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">Poll</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">poll_id</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">Poll</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;polls/detail.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;poll&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
</pre></div>
</div>
<p>In order to use the <code class="docutils literal"><span class="pre">Http404</span></code> exception to its fullest, you should create a
template that is displayed when a 404 error is raised. This template should be
called <code class="docutils literal"><span class="pre">404.html</span></code>, and it should be located in the top level of your template tree.</p>
</div>
<div class="section" id="customizing-the-404-not-found-view">
<h3>Customizing the 404 (Not Found) View<a class="headerlink" href="#customizing-the-404-not-found-view" title="Permalink to this headline">¶</a></h3>
<p>When you raise an <code class="docutils literal"><span class="pre">Http404</span></code> exception, Django loads a special view devoted
to handling 404 errors. By default, it’s the view
<code class="docutils literal"><span class="pre">django.views.defaults.page_not_found</span></code>, which loads and renders the template
<code class="docutils literal"><span class="pre">404.html</span></code>.</p>
<p>This means you need to define a <code class="docutils literal"><span class="pre">404.html</span></code> template in your root template
directory. This template will be used for all 404 errors.</p>
<p>This <code class="docutils literal"><span class="pre">page_not_found</span></code> view should suffice for 99% of Web applications, but
if you want to override the 404 view, you can specify <code class="docutils literal"><span class="pre">handler404</span></code> in your
URLconf, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="n">handler404</span> <span class="o">=</span> <span class="s1">&#39;mysite.views.my_custom_404_view&#39;</span>
</pre></div>
</div>
<p>Behind the scenes, Django determines the 404 view by looking for
<code class="docutils literal"><span class="pre">handler404</span></code>. By default, URLconfs contain the following line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>
</pre></div>
</div>
<p>That takes care of setting <code class="docutils literal"><span class="pre">handler404</span></code> in the current module. As you can
see in <code class="docutils literal"><span class="pre">django/conf/urls/defaults.py</span></code>, <code class="docutils literal"><span class="pre">handler404</span></code> is set to
<code class="docutils literal"><span class="pre">'django.views.defaults.page_not_found'</span></code> by default.</p>
<p>There are three things to note about 404 views:</p>
<ul class="simple">
<li>The 404 view is also called if Django doesn’t find a match after checking
every regular expression in the URLconf.</li>
<li>If you don’t define your own 404 view – and simply use the default,
which is recommended – you still have one obligation: to create a
<code class="docutils literal"><span class="pre">404.html</span></code> template in the root of your template directory. The default
404 view will use that template for all 404 errors.</li>
<li>If <code class="docutils literal"><span class="pre">DEBUG</span></code> is set to <code class="docutils literal"><span class="pre">True</span></code> (in your settings module), then your 404
view will never be used, and the traceback will be displayed instead.</li>
</ul>
</div>
<div class="section" id="customizing-the-500-server-error-view">
<h3>Customizing the 500 (Server Error) View<a class="headerlink" href="#customizing-the-500-server-error-view" title="Permalink to this headline">¶</a></h3>
<p>Similarly, Django executes special-case behavior in the case of runtime errors
in view code. If a view results in an exception, Django will, by default, call
the view <code class="docutils literal"><span class="pre">django.views.defaults.server_error</span></code>, which loads and renders the
template <code class="docutils literal"><span class="pre">500.html</span></code>.</p>
<p>This means you need to define a <code class="docutils literal"><span class="pre">500.html</span></code> template in your root template
directory. This template will be used for all server errors.</p>
<p>This <code class="docutils literal"><span class="pre">server_error</span></code> view should suffice for 99% of Web applications, but if
you want to override the view, you can specify <code class="docutils literal"><span class="pre">handler500</span></code> in your
URLconf, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>

<span class="n">handler500</span> <span class="o">=</span> <span class="s1">&#39;mysite.views.my_custom_error_view&#39;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

          </div>
        </div>
      </div>
      <div id="ft">
        
<div class="nav">
    
        <a href='appendixF.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='license.html'>next &raquo;</a>
    
</div>

        Copyright Adrian Holovaty, Jacob Kaplan-Moss, et al.<br>This
        work is licensed under the <a href="license.html">GNU Free Document
        License</a>.
      </div>
    </div>
  
  </body>
</html>