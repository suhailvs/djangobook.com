<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Chapter 8: Advanced Views and URLconfs</title>
    <link rel="stylesheet" href="_static/reset-min.css" type="text/css">
    <link rel="stylesheet" href="_static/grids-min.css" type="text/css">
    <link rel="stylesheet" href="_static/djangobook.css" type="text/css">
    
  </head>
  <body>
    <div id="doc" class="yui-t7">
      <div id="hd">
        <h1><a href="index.html">The Django Book</a></h1>
        <div id="global-nav">
            <a class="about" href="frontmatter.html">About</a>
        </div>
        
<div class="nav">
    
        <a href='chapter07.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter09.html'>next &raquo;</a>
    
</div>

      </div>
      <div id="bd">
        <div id="yui-main">
          <div class="yui-b">
            
  <div id="chapter-body"><div class="section" id="chapter-8-advanced-views-and-urlconfs">
<h1>Chapter 8: Advanced Views and URLconfs<a class="headerlink" href="#chapter-8-advanced-views-and-urlconfs" title="Permalink to this headline">¶</a></h1>
<p>In <a class="reference external" href="chapter03.html">Chapter 3</a>, we explained the basics of Django view functions and URLconfs.
This chapter goes into more detail about advanced functionality in those two
pieces of the framework.</p>
<div class="section" id="urlconf-tricks">
<h2>URLconf Tricks<a class="headerlink" href="#urlconf-tricks" title="Permalink to this headline">¶</a></h2>
<p>There’s nothing “special” about URLconfs – like anything else in Django,
they’re just Python code. You can take advantage of this in several ways, as
described in the sections that follow.</p>
<div class="section" id="streamlining-function-imports">
<h3>Streamlining Function Imports<a class="headerlink" href="#streamlining-function-imports" title="Permalink to this headline">¶</a></h3>
<p>Consider this URLconf, which builds on the example in Chapter 3:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite.views</span> <span class="k">import</span> <span class="n">hello</span><span class="p">,</span> <span class="n">current_datetime</span><span class="p">,</span> <span class="n">hours_ahead</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^hello/$&#39;</span><span class="p">,</span> <span class="n">hello</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^time/$&#39;</span><span class="p">,</span> <span class="n">current_datetime</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^time/plus/(\d{1,2})/$&#39;</span><span class="p">,</span> <span class="n">hours_ahead</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As explained in Chapter 3, each entry in the URLconf includes its associated
view function, passed directly as a function object. This means it’s necessary
to import the view functions at the top of the module.</p>
<p>But as a Django application grows in complexity, its URLconf grows, too, and
keeping those imports can be tedious to manage. (For each new view function,
you have to remember to import it, and the import statement tends to get
overly long if you use this approach.) It’s possible to avoid that tedium by
importing the <code class="docutils literal"><span class="pre">views</span></code> module itself. This example URLconf is equivalent to
the previous one:</p>
<pre class="literal-block">
from django.conf.urls import url
<strong>from mysite import views</strong>

urlpatterns = [
    url(r'^hello/$', <strong>views.hello</strong>),
    url(r'^time/$', <strong>views.current_datetime</strong>),
    url(r'^time/plus/(d{1,2})/$', <strong>views.hours_ahead</strong>),
]
</pre>
</div>
<div class="section" id="special-casing-urls-in-debug-mode">
<h3>Special-Casing URLs in Debug Mode<a class="headerlink" href="#special-casing-urls-in-debug-mode" title="Permalink to this headline">¶</a></h3>
<p>Speaking of constructing <code class="docutils literal"><span class="pre">urlpatterns</span></code> dynamically, you might want to take
advantage of this technique to alter your URLconf’s behavior while in Django’s
debug mode. To do this, just check the value of the <code class="docutils literal"><span class="pre">DEBUG</span></code> setting at
runtime, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="k">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">homepage</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d</span><span class="si">{4}</span><span class="s1">)/([a-z]</span><span class="si">{3}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">archive_month</span><span class="p">),</span>
<span class="p">]</span>

<span class="k">if</span> <span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">:</span>
    <span class="n">urlpatterns</span> <span class="o">+=</span> <span class="p">[</span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^debuginfo/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">debug</span><span class="p">),]</span>
</pre></div>
</div>
<p>In this example, the URL <code class="docutils literal"><span class="pre">/debuginfo/</span></code> will only be available if your
<code class="docutils literal"><span class="pre">DEBUG</span></code> setting is set to <code class="docutils literal"><span class="pre">True</span></code>.</p>
</div>
<div class="section" id="using-named-groups">
<h3>Using Named Groups<a class="headerlink" href="#using-named-groups" title="Permalink to this headline">¶</a></h3>
<p>In all of our URLconf examples so far, we’ve used simple, <em>non-named</em>
regular expression groups – that is, we put parentheses around parts of the URL
we wanted to capture, and Django passes that captured text to the view
function as a positional argument. In more advanced usage, it’s possible to use
<em>named</em> regular expression groups to capture URL bits and pass them as
<em>keyword</em> arguments to a view.</p>
<div class="admonition-keyword-arguments-vs-positional-arguments admonition">
<p class="first admonition-title">Keyword Arguments vs. Positional Arguments</p>
<p>A Python function can be called using keyword arguments or positional
arguments – and, in some cases, both at the same time. In a keyword
argument call, you specify the names of the arguments along with the values
you’re passing. In a positional argument call, you simply pass the
arguments without explicitly specifying which argument matches which value;
the association is implicit in the arguments’ order.</p>
<p>For example, consider this simple function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sell</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot;Selling </span><span class="si">%s</span><span class="s2"> unit(s) of </span><span class="si">%s</span><span class="s2"> at </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">quantity</span><span class="p">,</span> <span class="n">item</span><span class="p">,</span> <span class="n">price</span><span class="p">)</span>
</pre></div>
</div>
<p>To call it with positional arguments, you specify the arguments in the
order in which they’re listed in the function definition:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sell</span><span class="p">(</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
</pre></div>
</div>
<p>To call it with keyword arguments, you specify the names of the arguments
along with the values. The following statements are equivalent:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sell</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="s1">&#39;Socks&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, you can mix keyword and positional arguments, as long as all
positional arguments are listed before keyword arguments. The following
statements are equivalent to the previous examples:</p>
<div class="last highlight-default"><div class="highlight"><pre><span></span><span class="n">sell</span><span class="p">(</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">sell</span><span class="p">(</span><span class="s1">&#39;Socks&#39;</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">price</span><span class="o">=</span><span class="s1">&#39;$2.50&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>In Python regular expressions, the syntax for named regular expression groups
is <code class="docutils literal"><span class="pre">(?P&lt;name&gt;pattern)</span></code>, where <code class="docutils literal"><span class="pre">name</span></code> is the name of the group and
<code class="docutils literal"><span class="pre">pattern</span></code> is some pattern to match.</p>
<p>Here’s an example URLconf that uses non-named groups:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(\d</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(\d</span><span class="si">{4}</span><span class="s1">)/(\d</span><span class="si">{2}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">month_archive</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Here’s the same URLconf, rewritten to use named groups:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;\d</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;\d</span><span class="si">{4}</span><span class="s1">)/(?P&lt;month&gt;\d</span><span class="si">{2}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">month_archive</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This accomplishes exactly the same thing as the previous example, with one
subtle difference: the captured values are passed to view functions as keyword
arguments rather than positional arguments.</p>
<p>For example, with non-named groups, a request to <code class="docutils literal"><span class="pre">/articles/2006/03/</span></code> would
result in a function call equivalent to this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">month_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;2006&#39;</span><span class="p">,</span> <span class="s1">&#39;03&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With named groups, though, the same request would result in this function call:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">month_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="s1">&#39;2006&#39;</span><span class="p">,</span> <span class="n">month</span><span class="o">=</span><span class="s1">&#39;03&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In practice, using named groups makes your URLconfs slightly more explicit and
less prone to argument-order bugs – and you can reorder the arguments in your
views’ function definitions. Following the preceding example, if we wanted to
change the URLs to include the month <em>before</em> the year, and we were using
non-named groups, we’d have to remember to change the order of arguments in the
<code class="docutils literal"><span class="pre">month_archive</span></code> view. If we were using named groups, changing the order of
the captured parameters in the URL would have no effect on the view.</p>
<p>Of course, the benefits of named groups come at the cost of brevity; some
developers find the named-group syntax ugly and too verbose. Still, another
advantage of named groups is readability, especially by those who aren’t
intimately familiar with regular expressions or your particular Django
application. It’s easier to see what’s happening, at a glance, in a
URLconf that uses named groups.</p>
</div>
<div class="section" id="understanding-the-matching-grouping-algorithm">
<h3>Understanding the Matching/Grouping Algorithm<a class="headerlink" href="#understanding-the-matching-grouping-algorithm" title="Permalink to this headline">¶</a></h3>
<p>A caveat with using named groups in a URLconf is that a single URLconf pattern
cannot contain both named and non-named groups. If you do this, Django won’t
throw any errors, but you’ll probably find that your URLs aren’t matching as
you expect. Specifically, here’s the algorithm the URLconf parser follows, with
respect to named groups vs. non-named groups in a regular expression:</p>
<ul class="simple">
<li>If there are any named arguments, it will use those, ignoring non-named
arguments.</li>
<li>Otherwise, it will pass all non-named arguments as positional arguments.</li>
<li>In both cases, it will pass any extra options as keyword arguments. See
the next section for more information.</li>
</ul>
</div>
<div class="section" id="passing-extra-options-to-view-functions">
<h3>Passing Extra Options to View Functions<a class="headerlink" href="#passing-extra-options-to-view-functions" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you’ll find yourself writing view functions that are quite similar,
with only a few small differences. For example, say you have two views whose
contents are identical except for the template they use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^foo/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">foo_view</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^bar/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">bar_view</span><span class="p">),</span>
<span class="p">)</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">mysite.models</span> <span class="k">import</span> <span class="n">MyModel</span>

<span class="k">def</span> <span class="nf">foo_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">m_list</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_new</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;template1.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;m_list&#39;</span><span class="p">:</span> <span class="n">m_list</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">bar_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">m_list</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_new</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;template2.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;m_list&#39;</span><span class="p">:</span> <span class="n">m_list</span><span class="p">})</span>
</pre></div>
</div>
<p>We’re repeating ourselves in this code, and that’s inelegant. At first, you
may think to remove the redundancy by using the same view for both URLs,
putting parentheses around the URL to capture it, and checking the URL within
the view to determine the template, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(foo)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">foobar_view</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(bar)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">foobar_view</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">mysite.models</span> <span class="k">import</span> <span class="n">MyModel</span>

<span class="k">def</span> <span class="nf">foobar_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
    <span class="n">m_list</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_new</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;foo&#39;</span><span class="p">:</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;template1.html&#39;</span>
    <span class="k">elif</span> <span class="n">url</span> <span class="o">==</span> <span class="s1">&#39;bar&#39;</span><span class="p">:</span>
        <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;template2.html&#39;</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;m_list&#39;</span><span class="p">:</span> <span class="n">m_list</span><span class="p">})</span>
</pre></div>
</div>
<p>The problem with that solution, though, is that it couples your URLs to your
code. If you decide to rename <code class="docutils literal"><span class="pre">/foo/</span></code> to <code class="docutils literal"><span class="pre">/fooey/</span></code>, you’ll have to remember
to change the view code.</p>
<p>The elegant solution involves an optional URLconf parameter. Each pattern in a
URLconf may include a third item: a dictionary of keyword arguments to pass
to the view function.</p>
<p>With this in mind, we can rewrite our ongoing example like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^foo/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">foobar_view</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;template1.html&#39;</span><span class="p">}),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^bar/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">foobar_view</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;template2.html&#39;</span><span class="p">}),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">mysite.models</span> <span class="k">import</span> <span class="n">MyModel</span>

<span class="k">def</span> <span class="nf">foobar_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
    <span class="n">m_list</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_new</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;m_list&#39;</span><span class="p">:</span> <span class="n">m_list</span><span class="p">})</span>
</pre></div>
</div>
<p>As you can see, the URLconf in this example specifies <code class="docutils literal"><span class="pre">template_name</span></code> in the
URLconf. The view function treats it as just another parameter.</p>
<p>This extra URLconf options technique is a nice way of sending additional
information to your view functions with minimal fuss. As such, it’s used by a
couple of Django’s bundled applications, most notably its generic views system,
which we cover in Chapter 11.</p>
<p>The following sections contain a couple of ideas on how you can use the extra
URLconf options technique in your own projects.</p>
<div class="section" id="faking-captured-urlconf-values">
<h4>Faking Captured URLconf Values<a class="headerlink" href="#faking-captured-urlconf-values" title="Permalink to this headline">¶</a></h4>
<p>Say you have a set of views that match a pattern, along with another URL that
doesn’t fit the pattern but whose view logic is the same. In this case, you can
“fake” the capturing of URL values by using extra URLconf options to handle
that extra URL with the same view.</p>
<p>For example, you might have an application that displays some data for a
particular day, with URLs such as these:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">mydata</span><span class="o">/</span><span class="n">jan</span><span class="o">/</span><span class="mi">01</span><span class="o">/</span>
<span class="o">/</span><span class="n">mydata</span><span class="o">/</span><span class="n">jan</span><span class="o">/</span><span class="mi">02</span><span class="o">/</span>
<span class="o">/</span><span class="n">mydata</span><span class="o">/</span><span class="n">jan</span><span class="o">/</span><span class="mi">03</span><span class="o">/</span>
<span class="c1"># ...</span>
<span class="o">/</span><span class="n">mydata</span><span class="o">/</span><span class="n">dec</span><span class="o">/</span><span class="mi">30</span><span class="o">/</span>
<span class="o">/</span><span class="n">mydata</span><span class="o">/</span><span class="n">dec</span><span class="o">/</span><span class="mi">31</span><span class="o">/</span>
</pre></div>
</div>
<p>This is simple enough to deal with – you can capture those in a URLconf like
this (using named group syntax):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^mydata/(?P&lt;month&gt;\w</span><span class="si">{3}</span><span class="s1">)/(?P&lt;day&gt;\d\d)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">my_view</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>And the view function signature would look like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="c1"># ....</span>
</pre></div>
</div>
<p>This approach is straightforward – it’s nothing you haven’t seen before. The trick comes
in when you want to add another URL that uses <code class="docutils literal"><span class="pre">my_view</span></code> but whose URL doesn’t
include a <code class="docutils literal"><span class="pre">month</span></code> and/or <code class="docutils literal"><span class="pre">day</span></code>.</p>
<p>For example, you might want to add another URL, <code class="docutils literal"><span class="pre">/mydata/birthday/</span></code>, which
would be equivalent to <code class="docutils literal"><span class="pre">/mydata/jan/06/</span></code>. You can take advantage of extra
URLconf options like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^mydata/birthday/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">my_view</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="s1">&#39;jan&#39;</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="s1">&#39;06&#39;</span><span class="p">}),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^mydata/(?P&lt;month&gt;\w</span><span class="si">{3}</span><span class="s1">)/(?P&lt;day&gt;\d\d)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">my_view</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>The cool thing here is that you don’t have to change your view function at all.
The view function only cares that it <em>gets</em> <code class="docutils literal"><span class="pre">month</span></code> and <code class="docutils literal"><span class="pre">day</span></code> parameters –
it doesn’t matter whether they come from the URL capturing itself or extra
parameters.</p>
</div>
<div class="section" id="making-a-view-generic">
<h4>Making a View Generic<a class="headerlink" href="#making-a-view-generic" title="Permalink to this headline">¶</a></h4>
<p>It’s good programming practice to “factor out” commonalities in code. For
example, with these two Python functions:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">say_hello</span><span class="p">(</span><span class="n">person_name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;Hello, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">person_name</span>

<span class="k">def</span> <span class="nf">say_goodbye</span><span class="p">(</span><span class="n">person_name</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;Goodbye, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">person_name</span>
</pre></div>
</div>
<p>we can factor out the greeting to make it a parameter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">greet</span><span class="p">(</span><span class="n">person_name</span><span class="p">,</span> <span class="n">greeting</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="n">person_name</span><span class="p">)</span>
</pre></div>
</div>
<p>You can apply this same philosophy to your Django views by using extra URLconf
parameters.</p>
<p>With this in mind, you can start making higher-level abstractions of your
views. Instead of thinking to yourself, “This view displays a list of <code class="docutils literal"><span class="pre">Event</span></code>
objects,” and “That view displays a list of <code class="docutils literal"><span class="pre">BlogEntry</span></code> objects,” realize
they’re both specific cases of “A view that displays a list of objects, where
the type of object is variable.”</p>
<p>Take this code, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^events/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">event_list</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/entries/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">entry_list</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>
<span class="kn">from</span> <span class="nn">mysite.models</span> <span class="k">import</span> <span class="n">Event</span><span class="p">,</span> <span class="n">BlogEntry</span>

<span class="k">def</span> <span class="nf">event_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">obj_list</span> <span class="o">=</span> <span class="n">Event</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;mysite/event_list.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;event_list&#39;</span><span class="p">:</span> <span class="n">obj_list</span><span class="p">})</span>

<span class="k">def</span> <span class="nf">entry_list</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">obj_list</span> <span class="o">=</span> <span class="n">BlogEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;mysite/blogentry_list.html&#39;</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;entry_list&#39;</span><span class="p">:</span> <span class="n">obj_list</span><span class="p">})</span>
</pre></div>
</div>
<p>The two views do essentially the same thing: they display a list of objects. So
let’s factor out the type of object they’re displaying:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^events/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">Event</span><span class="p">}),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/entries/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">object_list</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">models</span><span class="o">.</span><span class="n">BlogEntry</span><span class="p">}),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">object_list</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
    <span class="n">obj_list</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">template_name</span> <span class="o">=</span> <span class="s1">&#39;mysite/</span><span class="si">%s</span><span class="s1">_list.html&#39;</span> <span class="o">%</span> <span class="n">model</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;object_list&#39;</span><span class="p">:</span> <span class="n">obj_list</span><span class="p">})</span>
</pre></div>
</div>
<p>With those small changes, we suddenly have a reusable, model-agnostic view!
From now on, anytime we need a view that lists a set of objects, we can simply
reuse this <code class="docutils literal"><span class="pre">object_list</span></code> view rather than writing view code. Here are a
couple of notes about what we did:</p>
<ul class="simple">
<li>We’re passing the model classes directly, as the <code class="docutils literal"><span class="pre">model</span></code> parameter. The
dictionary of extra URLconf options can pass any type of Python object –
not just strings.</li>
<li>The <code class="docutils literal"><span class="pre">model.objects.all()</span></code> line is an example of <em>duck typing</em>: “If it
walks like a duck and talks like a duck, we can treat it like a duck.”
Note the code doesn’t know what type of object <code class="docutils literal"><span class="pre">model</span></code> is; the only
requirement is that <code class="docutils literal"><span class="pre">model</span></code> have an <code class="docutils literal"><span class="pre">objects</span></code> attribute, which in
turn has an <code class="docutils literal"><span class="pre">all()</span></code> method.</li>
<li>We’re using <code class="docutils literal"><span class="pre">model.__name__.lower()</span></code> in determining the template name.
Every Python class has a <code class="docutils literal"><span class="pre">__name__</span></code> attribute that returns the class
name. This feature is useful at times like this, when we don’t know the
type of class until runtime. For example, the <code class="docutils literal"><span class="pre">BlogEntry</span></code> class’s
<code class="docutils literal"><span class="pre">__name__</span></code> is the string <code class="docutils literal"><span class="pre">'BlogEntry'</span></code>.</li>
<li>In a slight difference between this example and the previous example,
we’re passing the generic variable name <code class="docutils literal"><span class="pre">object_list</span></code> to the template.
We could easily change this variable name to be <code class="docutils literal"><span class="pre">blogentry_list</span></code> or
<code class="docutils literal"><span class="pre">event_list</span></code>, but we’ve left that as an exercise for the reader.</li>
</ul>
<p>Because database-driven Web sites have several common patterns, Django comes
with a set of “generic views” that use this exact technique to save you time.
We cover Django’s built-in generic views in Chapter 11.</p>
</div>
<div class="section" id="giving-a-view-configuration-options">
<h4>Giving a View Configuration Options<a class="headerlink" href="#giving-a-view-configuration-options" title="Permalink to this headline">¶</a></h4>
<p>If you’re distributing a Django application, chances are that your users will
want some degree of configuration. In this case, it’s a good idea to add hooks
to your views for any configuration options you think people may want to
change. You can use extra URLconf parameters for this purpose.</p>
<p>A common bit of an application to make configurable is the template name:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">do_something</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="understanding-precedence-of-captured-values-vs-extra-options">
<h4>Understanding Precedence of Captured Values vs. Extra Options<a class="headerlink" href="#understanding-precedence-of-captured-values-vs-extra-options" title="Permalink to this headline">¶</a></h4>
<p>When there’s a conflict, extra URLconf parameters get precedence over captured
parameters. In other words, if your URLconf captures a named-group variable and
an extra URLconf parameter includes a variable with the same name, the extra
URLconf parameter value will be used.</p>
<p>For example, consider this URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^mydata/(?P&lt;id&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">my_view</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Here, both the regular expression and the extra dictionary include an <code class="docutils literal"><span class="pre">id</span></code>.
The hard-coded <code class="docutils literal"><span class="pre">id</span></code> gets precedence. That means any request (e.g.,
<code class="docutils literal"><span class="pre">/mydata/2/</span></code> or <code class="docutils literal"><span class="pre">/mydata/432432/</span></code>) will be treated as if <code class="docutils literal"><span class="pre">id</span></code> is set
to <code class="docutils literal"><span class="pre">3</span></code>, regardless of the value captured in the URL.</p>
<p>Astute readers will note that in this case, it’s a waste of time and typing to
capture the <code class="docutils literal"><span class="pre">id</span></code> in the regular expression, because its value will always be
overridden by the dictionary’s value. That’s correct; we bring this up only to
help you avoid making the mistake.</p>
</div>
</div>
<div class="section" id="using-default-view-arguments">
<h3>Using Default View Arguments<a class="headerlink" href="#using-default-view-arguments" title="Permalink to this headline">¶</a></h3>
<p>Another convenient trick is to specify default parameters for a view’s
arguments. This tells the view which value to use for a parameter by default if
none is specified.</p>
<p>An example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">page</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/page(?P&lt;num&gt;\d+)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">page</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="k">def</span> <span class="nf">page</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">):</span>
    <span class="c1"># Output the appropriate page of blog entries, according to num.</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>Here, both URL patterns point to the same view – <code class="docutils literal"><span class="pre">views.page</span></code> – but the
first pattern doesn’t capture anything from the URL. If the first pattern
matches, the <code class="docutils literal"><span class="pre">page()</span></code> function will use its default argument for <code class="docutils literal"><span class="pre">num</span></code>,
<code class="docutils literal"><span class="pre">'1'</span></code>. If the second pattern matches, <code class="docutils literal"><span class="pre">page()</span></code> will use whatever <code class="docutils literal"><span class="pre">num</span></code>
value was captured by the regular expression.</p>
<p>(Note that we’ve been careful to set the default argument’s value to the
<em>string</em> <code class="docutils literal"><span class="pre">'1'</span></code>, not the integer <code class="docutils literal"><span class="pre">1</span></code>. That’s for consistency, because
any captured value for <code class="docutils literal"><span class="pre">num</span></code> will always be a string.)</p>
<p>It’s common to use this technique in conjunction with configuration options,
as explained earlier. This example makes a slight improvement to the example in
the “Giving a View Configuration Options” section by providing a default
value for <code class="docutils literal"><span class="pre">template_name</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;mysite/my_view.html&#39;</span><span class="p">):</span>
    <span class="n">var</span> <span class="o">=</span> <span class="n">do_something</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;var&#39;</span><span class="p">:</span> <span class="n">var</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="section" id="special-casing-views">
<h3>Special-Casing Views<a class="headerlink" href="#special-casing-views" title="Permalink to this headline">¶</a></h3>
<p>Sometimes you’ll have a pattern in your URLconf that handles a large set of
URLs, but you’ll need to special-case one of them. In this case, take advantage
of the linear way a URLconf is processed and put the special case first.</p>
<p>For example, you can think of the “add an object” pages in Django’s admin site
as represented by a URLpattern like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^([^/]+)/([^/]+)/add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_stage</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This matches URLs such as <code class="docutils literal"><span class="pre">/myblog/entries/add/</span></code> and <code class="docutils literal"><span class="pre">/auth/groups/add/</span></code>.
However, the “add” page for a user object (<code class="docutils literal"><span class="pre">/auth/user/add/</span></code>) is a special
case – it doesn’t display all of the form fields, it displays two password
fields, and so forth. We <em>could</em> solve this problem by special-casing in the
view, like so:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_stage</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">app_label</span><span class="p">,</span> <span class="n">model_name</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">app_label</span> <span class="o">==</span> <span class="s1">&#39;auth&#39;</span> <span class="ow">and</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;user&#39;</span><span class="p">:</span>
        <span class="c1"># do special-case code</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># do normal code</span>
</pre></div>
</div>
<p>but that’s inelegant for a reason we’ve touched on multiple times in this
chapter: it puts URL logic in the view. As a more elegant solution, we can take
advantage of the fact that URLconfs are processed in order from top to bottom:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^auth/user/add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">user_add_stage</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="s1">&#39;^([^/]+)/([^/]+)/add/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">add_stage</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>With this in place, a request to <code class="docutils literal"><span class="pre">/auth/user/add/</span></code> will be handled by the
<code class="docutils literal"><span class="pre">user_add_stage</span></code> view. Although that URL matches the second pattern, it
matches the top one first. (This is short-circuit logic.)</p>
</div>
<div class="section" id="capturing-text-in-urls">
<h3>Capturing Text in URLs<a class="headerlink" href="#capturing-text-in-urls" title="Permalink to this headline">¶</a></h3>
<p>Each captured argument is sent to the view as a plain Python Unicode string,
regardless of what sort of match the regular expression makes. For example, in
this URLconf line:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(?P&lt;year&gt;\d</span><span class="si">{4}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">year_archive</span><span class="p">),</span>
</pre></div>
</div>
<p>the <code class="docutils literal"><span class="pre">year</span></code> argument to <code class="docutils literal"><span class="pre">views.year_archive()</span></code> will be a string, not
an integer, even though <code class="docutils literal"><span class="pre">\d{4}</span></code> will only match integer strings.</p>
<p>This is important to keep in mind when you’re writing view code. Many built-in
Python functions are fussy (and rightfully so) about accepting only objects of
a certain type. A common error is to attempt to create a <code class="docutils literal"><span class="pre">datetime.date</span></code>
object with string values instead of integer values:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="s1">&#39;1993&#39;</span><span class="p">,</span> <span class="s1">&#39;7&#39;</span><span class="p">,</span> <span class="s1">&#39;9&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="gr">TypeError</span>: <span class="n">an integer is required</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="mi">1993</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">datetime.date(1993, 7, 9)</span>
</pre></div>
</div>
<p>Translated to a URLconf and view, the error looks like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^articles/(\d</span><span class="si">{4}</span><span class="s1">)/(\d</span><span class="si">{2}</span><span class="s1">)/(\d</span><span class="si">{2}</span><span class="s1">)/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">day_archive</span><span class="p">),</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">import</span> <span class="nn">datetime</span>

<span class="k">def</span> <span class="nf">day_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="c1"># The following statement raises a TypeError!</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
</pre></div>
</div>
<p>Instead, <code class="docutils literal"><span class="pre">day_archive()</span></code> can be written correctly like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">day_archive</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">day</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that <code class="docutils literal"><span class="pre">int()</span></code> itself raises a <code class="docutils literal"><span class="pre">ValueError</span></code> when you pass it a string
that is not composed solely of digits, but we’re avoiding that error in this
case because the regular expression in our URLconf has ensured that only
strings containing digits are passed to the view function.</p>
</div>
<div class="section" id="determining-what-the-urlconf-searches-against">
<h3>Determining What the URLconf Searches Against<a class="headerlink" href="#determining-what-the-urlconf-searches-against" title="Permalink to this headline">¶</a></h3>
<p>When a request comes in, Django tries to match the URLconf patterns against the
requested URL, as a Python string. This does not include <code class="docutils literal"><span class="pre">GET</span></code> or <code class="docutils literal"><span class="pre">POST</span></code>
parameters, or the domain name. It also does not include the leading slash,
because every URL has a leading slash.</p>
<p>For example, in a request to <code class="docutils literal"><span class="pre">http://www.example.com/myapp/</span></code>, Django will try
to match <code class="docutils literal"><span class="pre">myapp/</span></code>. In a request to <code class="docutils literal"><span class="pre">http://www.example.com/myapp/?page=3</span></code>,
Django will try to match <code class="docutils literal"><span class="pre">myapp/</span></code>.</p>
<p>The request method (e.g., <code class="docutils literal"><span class="pre">POST</span></code>, <code class="docutils literal"><span class="pre">GET</span></code>) is <em>not</em> taken into account when
traversing the URLconf. In other words, all request methods will be routed to
the same function for the same URL. It’s the responsibility of a view function
to perform branching based on request method.</p>
</div>
<div class="section" id="higher-level-abstractions-of-view-functions">
<h3>Higher-Level Abstractions of View Functions<a class="headerlink" href="#higher-level-abstractions-of-view-functions" title="Permalink to this headline">¶</a></h3>
<p>And speaking of branching based on request method, let’s take a look at how we
might build a nice way of doing that. Consider this URLconf/view layout:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^somepage/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">some_page</span><span class="p">),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>

<span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">some_page</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">do_something_for_post</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/someurl/&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span><span class="p">:</span>
        <span class="n">do_something_for_get</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;page.html&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">Http404</span><span class="p">()</span>
</pre></div>
</div>
<p>In this example, the <code class="docutils literal"><span class="pre">some_page()</span></code> view’s handling of <code class="docutils literal"><span class="pre">POST</span></code> vs. <code class="docutils literal"><span class="pre">GET</span></code>
requests is quite different. The only thing they have in common is a shared
URL: <code class="docutils literal"><span class="pre">/somepage/</span></code>. As such, it’s kind of inelegant to deal with both <code class="docutils literal"><span class="pre">POST</span></code>
and <code class="docutils literal"><span class="pre">GET</span></code> in the same view function. It would be nice if we could have two
separate view functions – one handling <code class="docutils literal"><span class="pre">GET</span></code> requests and the other handling
<code class="docutils literal"><span class="pre">POST</span></code> – and ensuring each one was only called when appropriate.</p>
<p>We can do that by writing a view function that delegates to other views,
either before or after executing some custom logic. Here’s an example of how
this technique could help simplify our <code class="docutils literal"><span class="pre">some_page()</span></code> view:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># views.py</span>

<span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">Http404</span><span class="p">,</span> <span class="n">HttpResponseRedirect</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">method_splitter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">GET</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">POST</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">and</span> <span class="n">GET</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">GET</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">POST</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">POST</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">Http404</span>

<span class="k">def</span> <span class="nf">some_page_get</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span>
    <span class="n">do_something_for_get</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;page.html&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">some_page_post</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span>
    <span class="n">do_something_for_post</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/someurl/&#39;</span><span class="p">)</span>

<span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># ...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^somepage/$&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">method_splitter</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;GET&#39;</span><span class="p">:</span> <span class="n">views</span><span class="o">.</span><span class="n">some_page_get</span><span class="p">,</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span> <span class="n">views</span><span class="o">.</span><span class="n">some_page_post</span><span class="p">}),</span>
    <span class="c1"># ...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Let’s go through what this does:</p>
<ul>
<li><p class="first">We’ve written a new view, <code class="docutils literal"><span class="pre">method_splitter()</span></code>, that delegates to other
views based on <code class="docutils literal"><span class="pre">request.method</span></code>. It looks for two keyword arguments,
<code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code>, which should be <em>view functions</em>. If
<code class="docutils literal"><span class="pre">request.method</span></code> is <code class="docutils literal"><span class="pre">'GET'</span></code>, then it calls the <code class="docutils literal"><span class="pre">GET</span></code> view. If
<code class="docutils literal"><span class="pre">request.method</span></code> is <code class="docutils literal"><span class="pre">'POST'</span></code>, then it calls the <code class="docutils literal"><span class="pre">POST</span></code> view. If
<code class="docutils literal"><span class="pre">request.method</span></code> is something else (<code class="docutils literal"><span class="pre">HEAD</span></code>, etc.), or if <code class="docutils literal"><span class="pre">GET</span></code> or
<code class="docutils literal"><span class="pre">POST</span></code> were not supplied to the function, then it raises an
<code class="docutils literal"><span class="pre">Http404</span></code>.</p>
</li>
<li><p class="first">In the URLconf, we point <code class="docutils literal"><span class="pre">/somepage/</span></code> at <code class="docutils literal"><span class="pre">method_splitter()</span></code> and pass
it extra arguments – the view functions to use for <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code>,
respectively.</p>
</li>
<li><p class="first">Finally, we’ve split the <code class="docutils literal"><span class="pre">some_page()</span></code> view into two view functions –
<code class="docutils literal"><span class="pre">some_page_get()</span></code> and <code class="docutils literal"><span class="pre">some_page_post()</span></code>. This is much nicer than
shoving all of that logic into a single view.</p>
<p>Note that these view functions technically no longer have to check
<code class="docutils literal"><span class="pre">request.method</span></code>, because <code class="docutils literal"><span class="pre">method_splitter()</span></code> does that. (By the time
<code class="docutils literal"><span class="pre">some_page_post()</span></code> is called, for example, we can be confident
<code class="docutils literal"><span class="pre">request.method</span></code> is <code class="docutils literal"><span class="pre">'post'</span></code>.) Still, just to be safe, and also to
serve as documentation, we stuck in an <code class="docutils literal"><span class="pre">assert</span></code> that makes sure
<code class="docutils literal"><span class="pre">request.method</span></code> is what we expect it to be.</p>
</li>
</ul>
<p>Now we have ourselves a nice, generic view function that encapsulates the logic
of delegating a view by <code class="docutils literal"><span class="pre">request.method</span></code>. Nothing about <code class="docutils literal"><span class="pre">method_splitter()</span></code>
is tied to our specific application, of course, so we can reuse it in other
projects.</p>
<p>But, while we’re at it, there’s one way to improve on <code class="docutils literal"><span class="pre">method_splitter()</span></code>.
As it’s written, it assumes that the <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code> views take no
arguments other than <code class="docutils literal"><span class="pre">request</span></code>. What if we wanted to use
<code class="docutils literal"><span class="pre">method_splitter()</span></code> with views that, for example, capture text from URLs,
or take optional keyword arguments themselves?</p>
<p>To do that, we can use a nice Python feature: variable arguments with
asterisks. We’ll show the example first, then explain it:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">method_splitter</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">get_view</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="n">post_view</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;GET&#39;</span> <span class="ow">and</span> <span class="n">get_view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">get_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span> <span class="ow">and</span> <span class="n">post_view</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">post_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">Http404</span>
</pre></div>
</div>
<p>Here, we’ve refactored <code class="docutils literal"><span class="pre">method_splitter()</span></code> to remove the <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code>
keyword arguments, in favor of <code class="docutils literal"><span class="pre">*args</span></code> and <code class="docutils literal"><span class="pre">**kwargs</span></code> (note the asterisks).
This is a Python feature that allows a function to accept a dynamic, arbitrary
number of arguments whose names aren’t known until runtime. If you put a single
asterisk in front of a parameter in a function definition, any <em>positional</em>
arguments to that function will be rolled up into a single tuple. If you put
two asterisks in front of a parameter in a function definition, any <em>keyword</em>
arguments to that function will be rolled up into a single dictionary.</p>
<p>For example, with this function:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">foo</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="nb">print</span> <span class="s2">&quot;Positional arguments are:&quot;</span>
    <span class="nb">print</span> <span class="n">args</span>
    <span class="nb">print</span> <span class="s2">&quot;Keyword arguments are:&quot;</span>
    <span class="nb">print</span> <span class="n">kwargs</span>
</pre></div>
</div>
<p>Here’s how it would work:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">Positional arguments are:</span>
<span class="go">(1, 2, 3)</span>
<span class="go">Keyword arguments are:</span>
<span class="go">{}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Adrian&#39;</span><span class="p">,</span> <span class="n">framework</span><span class="o">=</span><span class="s1">&#39;Django&#39;</span><span class="p">)</span>
<span class="go">Positional arguments are:</span>
<span class="go">(1, 2)</span>
<span class="go">Keyword arguments are:</span>
<span class="go">{&#39;framework&#39;: &#39;Django&#39;, &#39;name&#39;: &#39;Adrian&#39;}</span>
</pre></div>
</div>
<p>Bringing this back to <code class="docutils literal"><span class="pre">method_splitter()</span></code>, you can see we’re using <code class="docutils literal"><span class="pre">*args</span></code>
and <code class="docutils literal"><span class="pre">**kwargs</span></code> to accept <em>any</em> arguments to the function and pass them along
to the appropriate view. But before we do that, we make two calls to
<code class="docutils literal"><span class="pre">kwargs.pop()</span></code> to get the <code class="docutils literal"><span class="pre">GET</span></code> and <code class="docutils literal"><span class="pre">POST</span></code> arguments, if they’re
available. (We’re using <code class="docutils literal"><span class="pre">pop()</span></code> with a default value of <code class="docutils literal"><span class="pre">None</span></code> to avoid
<code class="docutils literal"><span class="pre">KeyError</span></code> if one or the other isn’t defined.)</p>
</div>
<div class="section" id="wrapping-view-functions">
<h3>Wrapping View Functions<a class="headerlink" href="#wrapping-view-functions" title="Permalink to this headline">¶</a></h3>
<p>Our final view trick takes advantage of an advanced Python technique. Say you
find yourself repeating a bunch of code throughout various views, as in this
example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view1</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/accounts/login/&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;template1.html&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_view2</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/accounts/login/&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;template2.html&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">my_view3</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
        <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/accounts/login/&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
    <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;template3.html&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here, each view starts by checking that <code class="docutils literal"><span class="pre">request.user</span></code> is authenticated
– that is, the current user has successfully logged into the site – and
redirects to <code class="docutils literal"><span class="pre">/accounts/login/</span></code> if not. (Note that we haven’t yet covered
<code class="docutils literal"><span class="pre">request.user</span></code> – Chapter 14 does – but, as you might imagine,
<code class="docutils literal"><span class="pre">request.user</span></code> represents the current user, either logged-in or anonymous.)</p>
<p>It would be nice if we could remove that bit of repetitive code from each of
these views and just mark them as requiring authentication. We can do that by
making a view wrapper. Take a moment to study this:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">requires_login</span><span class="p">(</span><span class="n">view</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">new_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">HttpResponseRedirect</span><span class="p">(</span><span class="s1">&#39;/accounts/login/&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_view</span>
</pre></div>
</div>
<p>This function, <code class="docutils literal"><span class="pre">requires_login</span></code>, takes a view function (<code class="docutils literal"><span class="pre">view</span></code>) and returns
a new view function (<code class="docutils literal"><span class="pre">new_view</span></code>). The new function, <code class="docutils literal"><span class="pre">new_view</span></code> is defined
<em>within</em> <code class="docutils literal"><span class="pre">requires_login</span></code> and handles the logic of checking
<code class="docutils literal"><span class="pre">request.user.is_authenticated()</span></code> and delegating to the original view
(<code class="docutils literal"><span class="pre">view</span></code>).</p>
<p>Now, we can remove the <code class="docutils literal"><span class="pre">if</span> <span class="pre">not</span> <span class="pre">request.user.is_authenticated()</span></code> checks from
our views and simply wrap them with <code class="docutils literal"><span class="pre">requires_login</span></code> in our URLconf:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite.views</span> <span class="k">import</span> <span class="n">requires_login</span><span class="p">,</span> <span class="n">my_view1</span><span class="p">,</span> <span class="n">my_view2</span><span class="p">,</span> <span class="n">my_view3</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^view1/$&#39;</span><span class="p">,</span> <span class="n">requires_login</span><span class="p">(</span><span class="n">my_view1</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^view2/$&#39;</span><span class="p">,</span> <span class="n">requires_login</span><span class="p">(</span><span class="n">my_view2</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^view3/$&#39;</span><span class="p">,</span> <span class="n">requires_login</span><span class="p">(</span><span class="n">my_view3</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This has the same effect as before, but with less code redundancy. Now we’ve
created a nice, generic function – <code class="docutils literal"><span class="pre">requires_login()</span></code> that we can wrap
around any view in order to make it require login.</p>
</div>
</div>
<div class="section" id="including-other-urlconfs">
<h2>Including Other URLconfs<a class="headerlink" href="#including-other-urlconfs" title="Permalink to this headline">¶</a></h2>
<p>If you intend your code to be used on multiple Django-based sites, you should
consider arranging your URLconfs in such a way that allows for “including.”</p>
<p>At any point, your URLconf can “include” other URLconf modules. This
essentially “roots” a set of URLs below other ones. For example, this
URLconf includes other URLconfs:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span><span class="p">,</span><span class="n">include</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">about_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^weblog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;mysite.blog.urls&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^photos/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;mysite.photos.urls&#39;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">about_views</span><span class="o">.</span><span class="n">about</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>(We saw this before in Chapter 6, when we introduced the Django admin site. The
admin site has its own URLconf that you merely <code class="docutils literal"><span class="pre">include()</span></code> within yours.)</p>
<p>There’s an important gotcha here: the regular expressions in this example that
point to an <code class="docutils literal"><span class="pre">include()</span></code> do <em>not</em> have a <code class="docutils literal"><span class="pre">$</span></code> (end-of-string match character)
but <em>do</em> include a trailing slash. Whenever Django encounters <code class="docutils literal"><span class="pre">include()</span></code>, it
chops off whatever part of the URL matched up to that point and sends the
remaining string to the included URLconf for further processing.</p>
<p>Continuing this example, here’s the URLconf <code class="docutils literal"><span class="pre">mysite.blog.urls</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite.blog</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">date_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d\d\d\d)/$&#39;</span><span class="p">,</span> <span class="n">date_views</span><span class="o">.</span><span class="n">year_detail</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(\d\d\d\d)/(\d\d)/$&#39;</span><span class="p">,</span> <span class="n">date_views</span><span class="o">.</span><span class="n">month_detail</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>With these two URLconfs, here’s how a few sample requests would be handled:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">/weblog/2007/</span></code>: In the first URLconf, the pattern <code class="docutils literal"><span class="pre">r'^weblog/'</span></code>
matches. Because it is an <code class="docutils literal"><span class="pre">include()</span></code>, Django strips all the matching
text, which is <code class="docutils literal"><span class="pre">'weblog/'</span></code> in this case. The remaining part of the URL
is <code class="docutils literal"><span class="pre">2007/</span></code>, which matches the first line in the <code class="docutils literal"><span class="pre">mysite.blog.urls</span></code>
URLconf.</li>
<li><code class="docutils literal"><span class="pre">/weblog//2007/</span></code> (with two slashes): In the first URLconf, the pattern
<code class="docutils literal"><span class="pre">r'^weblog/'</span></code> matches. Because it is an <code class="docutils literal"><span class="pre">include()</span></code>, Django strips
all the matching text, which is <code class="docutils literal"><span class="pre">'weblog/'</span></code> in this case. The remaining
part of the URL is <code class="docutils literal"><span class="pre">/2007/</span></code> (with a leading slash), which does not
match any of the lines in the <code class="docutils literal"><span class="pre">mysite.blog.urls</span></code> URLconf.</li>
<li><code class="docutils literal"><span class="pre">/about/</span></code>: This matches the view <code class="docutils literal"><span class="pre">mysite.views.about</span></code> in the first
URLconf, demonstrating that you can mix <code class="docutils literal"><span class="pre">include()</span></code> patterns with
non-<code class="docutils literal"><span class="pre">include()</span></code> patterns.</li>
</ul>
<div class="section" id="how-captured-parameters-work-with-include">
<h3>How Captured Parameters Work with include()<a class="headerlink" href="#how-captured-parameters-work-with-include" title="Permalink to this headline">¶</a></h3>
<p>An included URLconf receives any captured parameters from parent URLconfs, for
example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># root urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">include</span><span class="p">,</span><span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^(?P&lt;username&gt;\w+)/blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;foo.urls.blog&#39;</span><span class="p">)),</span>
<span class="p">]</span>

<span class="c1"># foo/urls/blog.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">include</span><span class="p">,</span><span class="n">url</span>
<span class="kn">from</span> <span class="nn">foo</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">blog_view</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^$&#39;</span><span class="p">,</span> <span class="n">blog_view</span><span class="o">.</span><span class="n">blog_index</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^archive/$&#39;</span><span class="p">,</span><span class="n">blog_view</span><span class="o">.</span><span class="n">blog_archive</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>In this example, the captured <code class="docutils literal"><span class="pre">username</span></code> variable is passed to the
included URLconf and, hence, to <em>every</em> view function within that URLconf.</p>
<p>Note that the captured parameters will <em>always</em> be passed to <em>every</em> line in
the included URLconf, regardless of whether the line’s view actually accepts
those parameters as valid. For this reason, this technique is useful only if
you’re certain that every view in the included URLconf accepts the
parameters you’re passing.</p>
</div>
<div class="section" id="how-extra-urlconf-options-work-with-include">
<h3>How Extra URLconf Options Work with include()<a class="headerlink" href="#how-extra-urlconf-options-work-with-include" title="Permalink to this headline">¶</a></h3>
<p>Similarly, you can pass extra URLconf options to <code class="docutils literal"><span class="pre">include()</span></code>, just as you can
pass extra URLconf options to a normal view – as a dictionary. When you do
this, <em>each</em> line in the included URLconf will be passed the extra options.</p>
<p>For example, the following two URLconf sets are functionally identical.</p>
<p>Set one:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">include</span><span class="p">,</span><span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;inner&#39;</span><span class="p">),</span> <span class="p">{</span><span class="s1">&#39;blogid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
<span class="p">]</span>

<span class="c1"># inner.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">my_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^archive/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">archive</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">about</span><span class="p">),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^rss/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">rss</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Set two:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># urls.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">include</span><span class="p">,</span><span class="n">url</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^blog/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;inner&#39;</span><span class="p">)),</span>
<span class="p">]</span>

<span class="c1"># inner.py</span>

<span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="k">import</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">mysite</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">my_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^archive/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">archive</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;blogid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^about/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;blogid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^rss/$&#39;</span><span class="p">,</span> <span class="n">my_views</span><span class="o">.</span><span class="n">rss</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;blogid&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>As is the case with captured parameters (explained in the previous section),
extra options will <em>always</em> be passed to <em>every</em> line in the included
URLconf, regardless of whether the line’s view actually accepts those options
as valid. For this reason, this technique is useful only if you’re certain that
every view in the included URLconf accepts the extra options you’re passing.</p>
</div>
</div>
<div class="section" id="what-s-next">
<h2>What’s Next?<a class="headerlink" href="#what-s-next" title="Permalink to this headline">¶</a></h2>
<p>This chapter has provided many advanced tips and tricks for views and URLconfs.
Next, in <a class="reference external" href="chapter09.html">Chapter 9</a>, we’ll give this advanced treatment to Django’s template
system.</p>
</div>
</div>
</div>

          </div>
        </div>
      </div>
      <div id="ft">
        
<div class="nav">
    
        <a href='chapter07.html'>&laquo; previous</a> &loz;
    
    <a href="index.html">table of contents</a>
    
        &loz; <a href='chapter09.html'>next &raquo;</a>
    
</div>

        Copyright Adrian Holovaty, Jacob Kaplan-Moss, et al.<br>This
        work is licensed under the <a href="license.html">GNU Free Document
        License</a>.
      </div>
    </div>
  
  </body>
</html>